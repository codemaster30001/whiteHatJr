/*! For license information please see 110.066160ff.chunk.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[110],{1017:function(e,t,n){e.exports={default:n(2076),__esModule:!0}},1018:function(e,t,n){e.exports={default:n(2081),__esModule:!0}},1019:function(e,t,n){var r,i;!function(s,a){"use strict";void 0===(i="function"==typeof(r=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"];function i(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function a(r){return"debug"===r&&(r="log"),typeof console!==t&&("trace"===r&&n?s:void 0!==console[r]?i(console,r):void 0!==console.log?i(console,"log"):e)}function o(t,n){for(var i=0;i<r.length;i++){var s=r[i];this[s]=i<t?e:this.methodFactory(s,t,n)}this.log=this.debug}function u(e,n,r){return function(){typeof console!==t&&(o.call(this,n,r),this[e].apply(this,arguments))}}function c(e,t,n){return a(e)||u.apply(this,arguments)}function l(e,n,i){var s,a=this,u="loglevel";function l(e){var n=(r[e]||"silent").toUpperCase();if(typeof window!==t&&u){try{return void(window.localStorage[u]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(u)+"="+n+";"}catch(e){}}}function d(){var e;if(typeof window!==t&&u){try{e=window.localStorage[u]}catch(e){}if(typeof e===t)try{var n=window.document.cookie,r=n.indexOf(encodeURIComponent(u)+"=");-1!==r&&(e=/^([^;]+)/.exec(n.slice(r))[1])}catch(e){}return void 0===a.levels[e]&&(e=void 0),e}}"string"==typeof e?u+=":"+e:"symbol"==typeof e&&(u=void 0),a.name=e,a.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},a.methodFactory=i||c,a.getLevel=function(){return s},a.setLevel=function(n,r){if("string"==typeof n&&void 0!==a.levels[n.toUpperCase()]&&(n=a.levels[n.toUpperCase()]),!("number"==typeof n&&n>=0&&n<=a.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(s=n,!1!==r&&l(n),o.call(a,n,e),typeof console===t&&n<a.levels.SILENT)return"No console available for logging"},a.setDefaultLevel=function(e){d()||a.setLevel(e,!1)},a.enableAll=function(e){a.setLevel(a.levels.TRACE,e)},a.disableAll=function(e){a.setLevel(a.levels.SILENT,e)};var f=d();null==f&&(f=null==n?"WARN":n),a.setLevel(f,!1)}var d=new l,f={};d.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=f[e];return t||(t=f[e]=new l(e,d.getLevel(),d.methodFactory)),t};var h=typeof window!==t?window.log:void 0;return d.noConflict=function(){return typeof window!==t&&window.log===d&&(window.log=h),d},d.getLoggers=function(){return f},d.default=d,d})?r.call(t,n,t,e):r)||(e.exports=i)}()},1020:function(e,t,n){"use strict";var r=o(n(816)),i=o(n(1230)),s=o(n(935)),a=o(n(1236));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.pureObject=t.nonNegativeInteger=t.nonEmptyString=t.stringifyReceivedType=t.custom=t.literal=t.type=t.asyncTypeCheck=t.typeCheck=t.runtimeTypeCheck=void 0;var u=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return{mode:"type",checks:t}};t.type=u;t.literal=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return{mode:"literal",checks:t}};var c=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return{mode:"custom",checks:t}};t.custom=c;var l=c((function(e){return["string"==typeof e&&e.length>0,"a non-empty string"]}));t.nonEmptyString=l;var d=c((function(e){return[(0,a.default)(e)&&e>=0,"a non-negative integer"]}));t.nonNegativeInteger=d;var f=c((function(e){return["object"===(void 0===e?"undefined":(0,s.default)(e))&&null!==e&&!Array.isArray(e),"a pure object (non-null and non-array)"]}));t.pureObject=f;var h=function(e,t,n){if(t.length>e.length)throw new Error("Expected at most "+e.length+" argument(s), but got "+t.length);for(;t.length<e.length;)t.push(void 0);t.forEach((function(t,r){var a=e[r],o=[],u=void 0,c=!1;if(a.forEach((function(e){switch(e.mode){case"type":e.checks.forEach((function(e){if("string"==typeof e)return c=c||(void 0===t?"undefined":(0,s.default)(t))===e,void o.push("of type "+e);c=c||t instanceof e,o.push("an instance of "+e.name)}));break;case"literal":e.checks.forEach((function(e){c=c||t===e,o.push("string"==typeof e?'"'+e+'"':""+e)}));break;case"custom":e.checks.forEach((function(e){var n=e(t),r=(0,i.default)(n,3),s=r[0],a=r[1],l=r[2];c=c||s,!u&&l&&(u=l),o.push(a)}))}})),!c){var l=u||p(t),d=n?" of "+n:"",f=o.length-1,h=f>0?o.slice(0,f).join(", ")+" or "+o[f]:o.join(", ");throw new Error("Argument "+(r+1)+d+" is expected to be "+h+(f>1?";":",")+" but got "+l)}}))};t.runtimeTypeCheck=h;var p=function(e){var t,n=void 0;["undefined","boolean","number","bigint","string"].includes(void 0===e?"undefined":(0,s.default)(e))&&(n="string"==typeof e?'"'+e+'"':""+e);var r=null===(t=null==e?void 0:e.constructor)||void 0===t?void 0:t.name;return"object"===(void 0===e?"undefined":(0,s.default)(e))&&"Object"!==r&&(n=null===e?"null":"instance of "+r),n||(n=void 0===e?"undefined":(0,s.default)(e)),n};t.stringifyReceivedType=p;t.typeCheck=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=v(t);return function(e,t,n){if("function"!=typeof n.value)throw new Error("The typeCheck decorator can only be applied to methods");var i=n.value;n.value=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return h(r,t,i.name),i.apply(this,arguments)}}};t.asyncTypeCheck=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=v(t);return function(e,t,n){if("function"!=typeof n.value)throw new Error("The asyncTypeCheck decorator can only be applied to methods");var s=n.value;n.value=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];try{h(i,t,s.name)}catch(e){return r.default.reject(e)}return s.apply(this,arguments)}}};var v=function(e){var t=[];return e.forEach((function(e){var n=[];(Array.isArray(e)?e:[e]).forEach((function(e){["string","function"].includes(void 0===e?"undefined":(0,s.default)(e))?n.push(u(e)):n.push(e)})),t.push(n)})),t}},1021:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2101);t.TwilsockClient=r.TwilsockClient,t.Twilsock=r.TwilsockClient;var i=n(878);t.TwilsockError=i.TwilsockError;var s=n(1495);t.TransportUnavailableError=s.TransportUnavailableError},1022:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validateId=t.validatePageSize=t.validateMandatoryTtl=t.validateOptionalTtl=t.deepClone=void 0;var r=n(905);function i(e,t){if(!t||void 0!==e){var n,i=typeof e;if("number"!==i||!(s(n=e)&&n>=0)){var a="object"===i?"object":"'".concat(e,"' of type '").concat(i,"'");throw new r.default("Invalid TTL, expected a positive integer of type number, was ".concat(a),400,54011)}}}function s(e){return!isNaN(parseInt(e))&&isFinite(e)}t.deepClone=function(e){return JSON.parse(JSON.stringify(e))},t.validateId=function(e){if(void 0!==e){var t=typeof e;if("string"!==t)throw new Error("Invalid ID type, expected a string, got '".concat(t,"'"))}},t.validateOptionalTtl=function(e){i(e,!0)},t.validateMandatoryTtl=function(e){i(e,!1)},t.validatePageSize=function(e){var t;if(!(void 0===e||s(t=e)&&t>0))throw new r.default("Invalid pageSize parameter. Expected a positive integer, was '".concat(e,"'."),400,54455)}},1023:function(e,t,n){"use strict";var r=n(474),i=n(475);function s(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){u=!0,s=e},f:function(){try{o||null==n.return||n.return()}finally{if(u)throw s}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object.defineProperty(t,"__esModule",{value:!0}),t.SyncEntity=void 0;var o=function(){function e(t,n){r(this,e),this.services=t,this.removalHandler=n,this.subscriptionState="none",this._attachedListeners=new Map}return i(e,[{key:"_advanceLastEventId",value:function(e,t){}},{key:"reportFailure",value:function(e){404===e.status?this.onRemoved(!1):this.broadcastEventToListeners("failure",e)}},{key:"_subscribe",value:function(){this.services.router.subscribe(this.sid,this)}},{key:"_unsubscribe",value:function(){this.services.router.unsubscribe(this.sid)}},{key:"_setSubscriptionState",value:function(e){this.subscriptionState=e,this.broadcastEventToListeners("_subscriptionStateChanged",e)}},{key:"close",value:function(){this._unsubscribe(),null!=this.removalHandler&&this.removalHandler(this.type,this.sid,this.uniqueName)}},{key:"attach",value:function(e){var t=e.listenerUuid;this._attachedListeners.get(t)||(this._attachedListeners.size||this._subscribe(),this._attachedListeners.set(t,e))}},{key:"detach",value:function(e){this._attachedListeners.delete(e),this._attachedListeners.size||this.close()}},{key:"broadcastEventToListeners",value:function(e,t){var n,r=s(this._attachedListeners.values());try{for(r.s();!(n=r.n()).done;){n.value.emit(e,t)}}catch(e){r.e(e)}finally{r.f()}}}]),e}();t.SyncEntity=o,t.default=o},1024:function(e,t,n){"use strict";var r=n(474),i=n(475),s=n(783),a=n(781),o=n(784);Object.defineProperty(t,"__esModule",{value:!0}),t.Closeable=void 0;var u=n(324),c=n(1500),l=function(e){function t(){var e;return r(this,t),(e=s(this,a(t).call(this))).closed=!1,e.uuid=c(),e}return o(t,e),i(t,[{key:"close",value:function(){this.removeAllListeners(),this.closed=!0}},{key:"ensureNotClosed",value:function(){if(this.closed)throw new Error("Invalid operation on closed object")}},{key:"listenerUuid",get:function(){return this.uuid}}]),t}(u.EventEmitter);t.Closeable=l,t.default=l},1074:function(e,t,n){var r=n(496);e.exports=function(e){return r(e,5)}},1113:function(e,t,n){e.exports={default:n(2056),__esModule:!0}},1114:function(e,t,n){var r=n(1107),i=n(834)("toStringTag"),s="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,n,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?n:s?r(t):"Object"==(a=r(t))&&"function"==typeof t.callee?"Arguments":a}},1115:function(e,t,n){var r=n(985);e.exports=function(e,t,n){for(var i in t)n&&e[i]?e[i]=t[i]:r(e,i,t[i]);return e}},1116:function(e,t){e.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},1117:function(e,t,n){"use strict";var r=a(n(816)),i=a(n(787)),s=a(n(790));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.RestPaginator=void 0;var o=function(){function e(t,n,r,s){(0,i.default)(this,e),this.state={prevToken:r,nextToken:s,source:n,items:t}}return(0,s.default)(e,[{key:"nextPage",value:function(){return this.hasNextPage?this.state.source(this.state.nextToken):r.default.reject(new Error("No next page"))}},{key:"prevPage",value:function(){return this.hasPrevPage?this.state.source(this.state.prevToken):r.default.reject(new Error("No previous page"))}},{key:"hasNextPage",get:function(){return!!this.state.nextToken}},{key:"hasPrevPage",get:function(){return!!this.state.prevToken}},{key:"items",get:function(){return this.state.items}}]),e}();t.RestPaginator=o},1118:function(e,t,n){"use strict";var r=n(474),i=n(475);Object.defineProperty(t,"__esModule",{value:!0}),t.UriBuilder=void 0;var s=function(){function e(t){r(this,e),this.base=t,this.args=new Array,this.paths=new Array}return i(e,[{key:"pathSegment",value:function(e){return this.paths.push(encodeURIComponent(e)),this}},{key:"queryParam",value:function(e,t){return void 0!==t&&this.args.push(encodeURIComponent(e)+"="+encodeURIComponent(t)),this}},{key:"build",value:function(){var e=this.base;return this.paths.length&&(e+="/"+this.paths.join("/")),this.args.length&&(e+="?"+this.args.join("&")),e}}]),e}();t.UriBuilder=s},1229:function(e,t,n){var r=n(1114),i=n(834)("iterator"),s=n(1057);e.exports=n(795).getIteratorMethod=function(e){if(null!=e)return e[i]||e["@@iterator"]||s[r(e)]}},1230:function(e,t,n){"use strict";t.__esModule=!0;var r=s(n(2058)),i=s(n(1113));function s(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if(Array.isArray(e))return e;if((0,r.default)(Object(e)))return function(e,t){var n=[],r=!0,s=!1,a=void 0;try{for(var o,u=(0,i.default)(e);!(r=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){s=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(s)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}},1231:function(e,t,n){"use strict";var r=n(824),i=n(813),s=n(1086),a=n(986),o=n(985),u=n(1115),c=n(978),l=n(1116),d=n(825),f=n(1138),h=n(885).f,p=n(1232)(0),v=n(902);e.exports=function(e,t,n,y,m,g){var b=r[e],k=b,w=m?"set":"add",x=k&&k.prototype,_={};return v&&"function"==typeof k&&(g||x.forEach&&!a((function(){(new k).entries().next()})))?(k=t((function(t,n){l(t,k,e,"_c"),t._c=new b,null!=n&&c(n,m,t[w],t)})),p("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),(function(e){var t="add"==e||"set"==e;!(e in x)||g&&"clear"==e||o(k.prototype,e,(function(n,r){if(l(this,k,e),!t&&g&&!d(n))return"get"==e&&void 0;var i=this._c[e](0===n?0:n,r);return t?this:i}))})),g||h(k.prototype,"size",{get:function(){return this._c.size}})):(k=y.getConstructor(t,e,m,w),u(k.prototype,n),s.NEED=!0),f(k,e),_[e]=k,i(i.G+i.W+i.F,_),g||y.setStrong(k,e,m),k}},1232:function(e,t,n){var r=n(901),i=n(1456),s=n(1001),a=n(1203),o=n(2062);e.exports=function(e,t){var n=1==e,u=2==e,c=3==e,l=4==e,d=6==e,f=5==e||d,h=t||o;return function(t,o,p){for(var v,y,m=s(t),g=i(m),b=r(o,p,3),k=a(g.length),w=0,x=n?h(t,k):u?h(t,0):void 0;k>w;w++)if((f||w in g)&&(y=b(v=g[w],w,m),e))if(n)x[w]=y;else if(y)switch(e){case 3:return!0;case 5:return v;case 6:return w;case 2:x.push(v)}else if(l)return!1;return d?-1:c||l?l:x}}},1233:function(e,t,n){"use strict";var r=n(920);function i(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=r(t),this.reject=r(n)}e.exports.f=function(e){return new i(e)}},1234:function(e,t,n){e.exports={default:n(2083),__esModule:!0}},1235:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clone=t.objectType=t.hasOwnProperty=void 0,t.hasOwnProperty=Object.prototype.hasOwnProperty,t.objectType=function(e){return void 0===e?"undefined":null===e?"null":Array.isArray(e)?"array":typeof e},t.clone=function e(n){if(null==n||"object"!=typeof n)return n;if(n.constructor==Array){for(var r=n.length,i=new Array(r),s=0;s<r;s++)i[s]=e(n[s]);return i}var a={};for(var o in n)t.hasOwnProperty.call(n,o)&&(a[o]=e(n[o]));return a}},1236:function(e,t,n){e.exports={default:n(2091),__esModule:!0}},1237:function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,r)}e.exports=n},1238:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2106);t.Init=r.Init;var i=n(2109);t.InitReply=i.InitReply;var s=n(2110);t.Update=s.Update;var a=n(2111);t.Message=a.Message;var o=n(2112);t.Reply=o.Reply;var u=n(2113);t.Close=u.Close;var c=n(1492);t.Telemetry=c.Telemetry},1239:function(e,t,n){var r=n(2107),i=n(2108),s=i;s.v1=r,s.v4=i,e.exports=s},1240:function(e,t,n){var r=n(781),i=n(1237),s=n(2114),a=n(2115);function o(t){var n="function"==typeof Map?new Map:void 0;return e.exports=o=function(e){if(null===e||!s(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return a(e,arguments,r(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i(t,e)},o(t)}e.exports=o},1241:function(e,t,n){(function(e,r){var i;(function(){"use strict";var s={function:!0,object:!0},a=s[typeof window]&&window||this,o=s[typeof t]&&t,u=s[typeof e]&&e&&!e.nodeType&&e,c=o&&u&&"object"==typeof r&&r;!c||c.global!==c&&c.window!==c&&c.self!==c||(a=c);var l=Math.pow(2,53)-1,d=/\bOpera/,f=Object.prototype,h=f.hasOwnProperty,p=f.toString;function v(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function y(e){return e=w(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:v(e)}function m(e,t){for(var n in e)h.call(e,n)&&t(e[n],n,e)}function g(e){return null==e?v(e):p.call(e).slice(8,-1)}function b(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function k(e,t){var n=null;return function(e,t){var n=-1,r=e?e.length:0;if("number"==typeof r&&r>-1&&r<=l)for(;++n<r;)t(e[n],n,e);else m(e,t)}(e,(function(r,i){n=t(n,r,i,e)})),n}function w(e){return String(e).replace(/^ +| +$/g,"")}var x=function e(t){var n=a,r=t&&"object"==typeof t&&"String"!=g(t);r&&(n=t,t=null);var i=n.navigator||{},s=i.userAgent||"";t||(t=s);var o,u,c,l,f,h=r?!!i.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(p.toString()),v="Object",x=r?v:"ScriptBridgingProxyObject",_=r?v:"Environment",S=r&&n.java?"JavaPackage":g(n.java),C=r?v:"RuntimeObject",T=/\bJava/.test(S)&&n.java,E=T&&g(n.environment)==_,I=T?"a":"α",M=T?"b":"β",P=n.document||{},R=n.operamini||n.opera,O=d.test(O=r&&R?R["[[Class]]"]:g(R))?O:R=null,N=t,U=[],j=null,A=t==s,D=A&&R&&"function"==typeof R.version&&R.version(),L=k([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"],(function(e,n){return e||RegExp("\\b"+(n.pattern||b(n))+"\\b","i").exec(t)&&(n.label||n)})),F=function(e){return k(e,(function(e,n){return e||RegExp("\\b"+(n.pattern||b(n))+"\\b","i").exec(t)&&(n.label||n)}))}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),q=z([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),B=function(e){return k(e,(function(e,n,r){return e||(n[q]||n[/^[a-z]+(?: +[a-z]+\b)*/i.exec(q)]||RegExp("\\b"+b(r)+"(?:\\b|\\w*\\d)","i").exec(t))&&r}))}({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),W=function(e){return k(e,(function(e,n){var r=n.pattern||b(n);return!e&&(e=RegExp("\\b"+r+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(e=function(e,t,n){var r={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&n&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(r=r[/[\d.]+$/.exec(e)])&&(e="Windows "+r),e=String(e),t&&n&&(e=e.replace(RegExp(t,"i"),n)),y(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(e,r,n.label||n)),e}))}(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function z(e){return k(e,(function(e,n){var r=n.pattern||b(n);return!e&&(e=RegExp("\\b"+r+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+r+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+r+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((e=String(n.label&&!RegExp(r,"i").test(n.label)?n.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),n=n.label||n,e=y(e[0].replace(RegExp(r,"i"),n).replace(RegExp("; *(?:"+n+"[_-])?","i")," ").replace(RegExp("("+n+")[-_.]?(\\w)","i"),"$1 $2"))),e}))}function H(e){return k(e,(function(e,n){return e||(RegExp(n+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null}))}if(L&&(L=[L]),/\bAndroid\b/.test(W)&&!q&&(o=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(t))&&(q=w(o[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),B&&!q?q=z([B]):B&&q&&(q=q.replace(RegExp("^("+b(B)+")[-_.\\s]","i"),B+" ").replace(RegExp("^("+b(B)+")[-_.]?(\\w)","i"),B+" $2")),(o=/\bGoogle TV\b/.exec(q))&&(q=o[0]),/\bSimulator\b/i.test(t)&&(q=(q?q+" ":"")+"Simulator"),"Opera Mini"==F&&/\bOPiOS\b/.test(t)&&U.push("running in Turbo/Uncompressed mode"),"IE"==F&&/\blike iPhone OS\b/.test(t)?(B=(o=e(t.replace(/like iPhone OS/,""))).manufacturer,q=o.product):/^iP/.test(q)?(F||(F="Safari"),W="iOS"+((o=/ OS ([\d_]+)/i.exec(t))?" "+o[1].replace(/_/g,"."):"")):"Konqueror"==F&&/^Linux\b/i.test(W)?W="Kubuntu":B&&"Google"!=B&&(/Chrome/.test(F)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(q))||/\bAndroid\b/.test(W)&&/^Chrome/.test(F)&&/\bVersion\//i.test(t)?(F="Android Browser",W=/\bAndroid\b/.test(W)?W:"Android"):"Silk"==F?(/\bMobi/i.test(t)||(W="Android",U.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&U.unshift("accelerated")):"UC Browser"==F&&/\bUCWEB\b/.test(t)?U.push("speed mode"):"PaleMoon"==F&&(o=/\bFirefox\/([\d.]+)\b/.exec(t))?U.push("identifying as Firefox "+o[1]):"Firefox"==F&&(o=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(W||(W="Firefox OS"),q||(q=o[1])):!F||(o=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(F))?(F&&!q&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(o+"/")+8))&&(F=null),(o=q||B||W)&&(q||B||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(W))&&(F=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(W)?W:o)+" Browser")):"Electron"==F&&(o=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&U.push("Chromium "+o),D||(D=H(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",b(F),"(?:Firefox|Minefield|NetFront)"])),(o=("iCab"==L&&parseFloat(D)>3?"WebKit":/\bOpera\b/.test(F)&&(/\bOPR\b/.test(t)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(L)&&"WebKit"||!L&&/\bMSIE\b/i.test(t)&&("Mac OS"==W?"Tasman":"Trident")||"WebKit"==L&&/\bPlayStation\b(?! Vita\b)/i.test(F)&&"NetFront")&&(L=[o]),"IE"==F&&(o=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(F+=" Mobile",W="Windows Phone "+(/\+$/.test(o)?o:o+".x"),U.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(F="IE Mobile",W="Windows Phone 8.x",U.unshift("desktop mode"),D||(D=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=F&&"Trident"==L&&(o=/\brv:([\d.]+)/.exec(t))&&(F&&U.push("identifying as "+F+(D?" "+D:"")),F="IE",D=o[1]),A){if(l="global",f=null!=(c=n)?typeof c[l]:"number",/^(?:boolean|number|string|undefined)$/.test(f)||"object"==f&&!c[l])g(o=n.runtime)==x?(F="Adobe AIR",W=o.flash.system.Capabilities.os):g(o=n.phantom)==C?(F="PhantomJS",D=(o=o.version||null)&&o.major+"."+o.minor+"."+o.patch):"number"==typeof P.documentMode&&(o=/\bTrident\/(\d+)/i.exec(t))?(D=[D,P.documentMode],(o=+o[1]+4)!=D[1]&&(U.push("IE "+D[1]+" mode"),L&&(L[1]=""),D[1]=o),D="IE"==F?String(D[1].toFixed(1)):D[0]):"number"==typeof P.documentMode&&/^(?:Chrome|Firefox)\b/.test(F)&&(U.push("masking as "+F+" "+D),F="IE",D="11.0",L=["Trident"],W="Windows");else if(T&&(N=(o=T.lang.System).getProperty("os.arch"),W=W||o.getProperty("os.name")+" "+o.getProperty("os.version")),E){try{D=n.require("ringo/engine").version.join("."),F="RingoJS"}catch(e){(o=n.system)&&o.global.system==n.system&&(F="Narwhal",W||(W=o[0].os||null))}F||(F="Rhino")}else"object"==typeof n.process&&!n.process.browser&&(o=n.process)&&("object"==typeof o.versions&&("string"==typeof o.versions.electron?(U.push("Node "+o.versions.node),F="Electron",D=o.versions.electron):"string"==typeof o.versions.nw&&(U.push("Chromium "+D,"Node "+o.versions.node),F="NW.js",D=o.versions.nw)),F||(F="Node.js",N=o.arch,W=o.platform,D=(D=/[\d.]+/.exec(o.version))?D[0]:null));W=W&&y(W)}if(D&&(o=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(D)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(A&&i.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(j=/b/i.test(o)?"beta":"alpha",D=D.replace(RegExp(o+"\\+?$"),"")+("beta"==j?M:I)+(/\d+\+?/.exec(o)||"")),"Fennec"==F||"Firefox"==F&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(W))F="Firefox Mobile";else if("Maxthon"==F&&D)D=D.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(q))"Xbox 360"==q&&(W=null),"Xbox 360"==q&&/\bIEMobile\b/.test(t)&&U.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(F)&&(!F||q||/Browser|Mobi/.test(F))||"Windows CE"!=W&&!/Mobi/i.test(t))if("IE"==F&&A)try{null===n.external&&U.unshift("platform preview")}catch(e){U.unshift("embedded")}else(/\bBlackBerry\b/.test(q)||/\bBB10\b/.test(t))&&(o=(RegExp(q.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||D)?(W=((o=[o,/BB10/.test(t)])[1]?(q=null,B="BlackBerry"):"Device Software")+" "+o[0],D=null):this!=m&&"Wii"!=q&&(A&&R||/Opera/.test(F)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==F&&/\bOS X (?:\d+\.){2,}/.test(W)||"IE"==F&&(W&&!/^Win/.test(W)&&D>5.5||/\bWindows XP\b/.test(W)&&D>8||8==D&&!/\bTrident\b/.test(t)))&&!d.test(o=e.call(m,t.replace(d,"")+";"))&&o.name&&(o="ing as "+o.name+((o=o.version)?" "+o:""),d.test(F)?(/\bIE\b/.test(o)&&"Mac OS"==W&&(W=null),o="identify"+o):(o="mask"+o,F=O?y(O.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(o)&&(W=null),A||(D=null)),L=["Presto"],U.push(o));else F+=" Mobile";(o=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(o=[parseFloat(o.replace(/\.(\d)$/,".0$1")),o],"Safari"==F&&"+"==o[1].slice(-1)?(F="WebKit Nightly",j="alpha",D=o[1].slice(0,-1)):D!=o[1]&&D!=(o[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(D=null),o[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(t)||0)[1],537.36==o[0]&&537.36==o[2]&&parseFloat(o[1])>=28&&"WebKit"==L&&(L=["Blink"]),A&&(h||o[1])?(L&&(L[1]="like Chrome"),o=o[1]||((o=o[0])<530?1:o<532?2:o<532.05?3:o<533?4:o<534.03?5:o<534.07?6:o<534.1?7:o<534.13?8:o<534.16?9:o<534.24?10:o<534.3?11:o<535.01?12:o<535.02?"13+":o<535.07?15:o<535.11?16:o<535.19?17:o<536.05?18:o<536.1?19:o<537.01?20:o<537.11?"21+":o<537.13?23:o<537.18?24:o<537.24?25:o<537.36?26:"Blink"!=L?"27":"28")):(L&&(L[1]="like Safari"),o=(o=o[0])<400?1:o<500?2:o<526?3:o<533?4:o<534?"4+":o<535?5:o<537?6:o<538?7:o<601?8:o<602?9:o<604?10:o<606?11:o<608?12:"12"),L&&(L[1]+=" "+(o+="number"==typeof o?".x":/[.+]/.test(o)?"":"+")),"Safari"==F&&(!D||parseInt(D)>45)?D=o:"Chrome"==F&&/\bHeadlessChrome/i.test(t)&&U.unshift("headless")),"Opera"==F&&(o=/\bzbov|zvav$/.exec(W))?(F+=" ",U.unshift("desktop mode"),"zvav"==o?(F+="Mini",D=null):F+="Mobile",W=W.replace(RegExp(" *"+o+"$"),"")):"Safari"==F&&/\bChrome\b/.exec(L&&L[1])?(U.unshift("desktop mode"),F="Chrome Mobile",D=null,/\bOS X\b/.test(W)?(B="Apple",W="iOS 4.3+"):W=null):/\bSRWare Iron\b/.test(F)&&!D&&(D=H("Chrome")),D&&0==D.indexOf(o=/[\d.]+$/.exec(W))&&t.indexOf("/"+o+"-")>-1&&(W=w(W.replace(o,""))),W&&-1!=W.indexOf(F)&&!RegExp(F+" OS").test(W)&&(W=W.replace(RegExp(" *"+b(F)+" *"),"")),L&&!/\b(?:Avant|Nook)\b/.test(F)&&(/Browser|Lunascape|Maxthon/.test(F)||"Safari"!=F&&/^iOS/.test(W)&&/\bSafari\b/.test(L[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(F)&&L[1])&&(o=L[L.length-1])&&U.push(o),U.length&&(U=["("+U.join("; ")+")"]),B&&q&&q.indexOf(B)<0&&U.push("on "+B),q&&U.push((/^on /.test(U[U.length-1])?"":"on ")+q),W&&(o=/ ([\d.+]+)$/.exec(W),u=o&&"/"==W.charAt(W.length-o[0].length-1),W={architecture:32,family:o&&!u?W.replace(o[0],""):W,version:o?o[1]:null,toString:function(){var e=this.version;return this.family+(e&&!u?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(o=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(N))&&!/\bi686\b/i.test(N)?(W&&(W.architecture=64,W.family=W.family.replace(RegExp(" *"+o),"")),F&&(/\bWOW64\b/i.test(t)||A&&/\w(?:86|32)$/.test(i.cpuClass||i.platform)&&!/\bWin64; x64\b/i.test(t))&&U.unshift("32-bit")):W&&/^OS X/.test(W.family)&&"Chrome"==F&&parseFloat(D)>=39&&(W.architecture=64),t||(t=null);var J={};return J.description=t,J.layout=L&&L[0],J.manufacturer=B,J.name=F,J.prerelease=j,J.product=q,J.ua=t,J.version=F&&D,J.os=W||{architecture:null,family:null,version:null,toString:function(){return"null"}},J.parse=e,J.toString=function(){return this.description||""},J.version&&U.unshift(D),J.name&&U.unshift(F),W&&F&&(W!=String(W).split(" ")[0]||W!=F.split(" ")[0]&&!q)&&U.push(q?"("+W+")":"on "+W),U.length&&(J.description=U.join(" ")),J}();a.platform=x,void 0===(i=function(){return x}.call(t,n,t,e))||(e.exports=i)}).call(this)}).call(this,n(182)(e),n(54))},1242:function(e,t,n){"use strict";var r=n(474),i=n(475);Object.defineProperty(t,"__esModule",{value:!0}),t.log=t.Logger=void 0;var s=n(1019);function a(e,t){return["".concat((new Date).toISOString()," Notifications ").concat(e,":")].concat(Array.from(t))}var o=function(){function e(){r(this,e),this.prefix=""}return i(e,[{key:"setLevel",value:function(e){s.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];s.debug.apply(null,a("T"+this.prefix,t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];s.debug.apply(null,a("D"+this.prefix,t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];s.info.apply(null,a("I"+this.prefix,t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];s.warn.apply(null,a("W"+this.prefix,t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];s.error.apply(null,a("E"+this.prefix,t))}}],[{key:"scope",value:function(){return new e}}]),e}();t.Logger=o;var u=o.scope();t.log=u},1243:function(e,t,n){"use strict";var r=n(3),i=n(800),s=n(474),a=n(475);Object.defineProperty(t,"__esModule",{value:!0}),t.NamespacedMergingQueue=t.MergingQueue=void 0;var o=function(){function e(t){s(this,e),this.queuedRequests=[],this.isRequestInFlight=!1,this.inputMergingFunction=t}return a(e,[{key:"add",value:function(e,t){var n=this,r=new Promise((function(r,i){return n.queuedRequests.push({input:e,requestFunction:t,resolve:r,reject:i})}));return this.wakeupQueue(),r}},{key:"squashAndAdd",value:function(e,t){var n,r=this.queuedRequests;this.queuedRequests=[],r.length>0?(n=r.map((function(e){return e.input})).reduce(this.inputMergingFunction),n=this.inputMergingFunction(n,e)):n=e;var i=this.add(n,t);return r.forEach((function(e){return i.then(e.resolve,e.reject)})),i}},{key:"isEmpty",value:function(){return 0===this.queuedRequests.length&&!this.isRequestInFlight}},{key:"wakeupQueue",value:function(){var e=this;if(0!==this.queuedRequests.length&&!this.isRequestInFlight){var t=this.queuedRequests.shift();this.isRequestInFlight=!0,t.requestFunction(t.input).then(t.resolve,t.reject).then((function(t){e.isRequestInFlight=!1,e.wakeupQueue()}))}}}]),e}();t.MergingQueue=o;var u=function(){function e(t){s(this,e),this.queueByNamespaceKey=new Map,this.inputReducer=t}var t,n,u;return a(e,[{key:"add",value:(u=i(r.mark((function e(t,n,i){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.invokeQueueMethod(t,(function(e){return e.add(n,i)})));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return u.apply(this,arguments)})},{key:"squashAndAdd",value:(n=i(r.mark((function e(t,n,i){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.invokeQueueMethod(t,(function(e){return e.squashAndAdd(n,i)})));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"invokeQueueMethod",value:(t=i(r.mark((function e(t,n){var i,s;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.queueByNamespaceKey.has(t)||this.queueByNamespaceKey.set(t,new o(this.inputReducer)),i=this.queueByNamespaceKey.get(t),s=n(i),this.queueByNamespaceKey.get(t).isEmpty()&&this.queueByNamespaceKey.delete(t),e.abrupt("return",s);case 5:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),e}();t.NamespacedMergingQueue=u},1244:function(e,t,n){"use strict";var r=n(489),i=n(474),s=n(475);function a(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw s}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object.defineProperty(t,"__esModule",{value:!0}),t.Cache=void 0;var u=n(2144),c=function(){function e(t,n){i(this,e),this.value=t,this.revision=n||0}return s(e,[{key:"isValid",get:function(){return!0}}]),e}(),l=function(){function e(t){i(this,e),this.revision=t}return s(e,[{key:"isValid",get:function(){return!1}}]),e}(),d=function(){function e(){i(this,e),this.items=new u.TreeMap}return s(e,[{key:"store",value:function(e,t,n){var r=this.items.get(e);return r&&r.revision>n?r.isValid?r.value:null:(this.items.set(e,new c(t,n)),t)}},{key:"delete",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.items.get(e);(!r||r.revision<t||r&&!0===n)&&this.items.set(e,new l(t))}},{key:"isKnown",value:function(e,t){var n=this.items.get(e);return n&&n.revision>=t}},{key:"get",value:function(e){var t=this.items.get(e);return t&&t.isValid?t.value:null}},{key:"has",value:function(e){var t=this.items.get(e);return t&&t.isValid}},{key:"forEach",value:function(e){if(this.items){var t,n=a(this.items);try{for(n.s();!(t=n.n()).done;){var i=r(t.value,2),s=i[0],o=i[1];o.isValid&&e(s,o.value)}}catch(e){n.e(e)}finally{n.f()}}}}]),e}();t.Cache=d,t.default=d},1471:function(e,t,n){"use strict";var r=n(1472),i=n(979),s="Map";e.exports=n(1231)(s,(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(e){var t=r.getEntry(i(this,s),e);return t&&t.v},set:function(e,t){return r.def(i(this,s),0===e?0:e,t)}},r,!0)},1472:function(e,t,n){"use strict";var r=n(885).f,i=n(1137),s=n(1115),a=n(901),o=n(1116),u=n(978),c=n(1457),l=n(1713),d=n(1475),f=n(902),h=n(1086).fastKey,p=n(979),v=f?"_s":"size",y=function(e,t){var n,r=h(t);if("F"!==r)return e._i[r];for(n=e._f;n;n=n.n)if(n.k==t)return n};e.exports={getConstructor:function(e,t,n,c){var l=e((function(e,r){o(e,l,t,"_i"),e._t=t,e._i=i(null),e._f=void 0,e._l=void 0,e[v]=0,null!=r&&u(r,n,e[c],e)}));return s(l.prototype,{clear:function(){for(var e=p(this,t),n=e._i,r=e._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];e._f=e._l=void 0,e[v]=0},delete:function(e){var n=p(this,t),r=y(n,e);if(r){var i=r.n,s=r.p;delete n._i[r.i],r.r=!0,s&&(s.n=i),i&&(i.p=s),n._f==r&&(n._f=i),n._l==r&&(n._l=s),n[v]--}return!!r},forEach:function(e){p(this,t);for(var n,r=a(e,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(e){return!!y(p(this,t),e)}}),f&&r(l.prototype,"size",{get:function(){return p(this,t)[v]}}),l},def:function(e,t,n){var r,i,s=y(e,t);return s?s.v=n:(e._l=s={i:i=h(t,!0),k:t,v:n,p:r=e._l,n:void 0,r:!1},e._f||(e._f=s),r&&(r.n=s),e[v]++,"F"!==i&&(e._i[i]=s)),e},getEntry:y,setStrong:function(e,t,n){c(e,t,(function(e,n){this._t=p(e,t),this._k=n,this._l=void 0}),(function(){for(var e=this,t=e._k,n=e._l;n&&n.r;)n=n.p;return e._t&&(e._l=n=n?n.n:e._t._f)?l(0,"keys"==t?n.k:"values"==t?n.v:[n.k,n.v]):(e._t=void 0,l(1))}),n?"entries":"values",!n,!0),d(t)}}},1473:function(e,t,n){var r=n(849);e.exports=function(e,t,n,i){try{return i?t(r(n)[0],n[1]):t(n)}catch(t){var s=e.return;throw void 0!==s&&r(s.call(e)),t}}},1474:function(e,t,n){var r=n(1057),i=n(834)("iterator"),s=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||s[i]===e)}},1475:function(e,t,n){"use strict";var r=n(824),i=n(795),s=n(885),a=n(902),o=n(834)("species");e.exports=function(e){var t="function"==typeof i[e]?i[e]:r[e];a&&t&&!t[o]&&s.f(t,o,{configurable:!0,get:function(){return this}})}},1476:function(e,t,n){var r=n(1114),i=n(2065);e.exports=function(e){return function(){if(r(this)!=e)throw TypeError(e+"#toJSON isn't generic");return i(this)}}},1477:function(e,t,n){"use strict";var r=n(813);e.exports=function(e){r(r.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},1478:function(e,t,n){"use strict";var r=n(813),i=n(920),s=n(901),a=n(978);e.exports=function(e){r(r.S,e,{from:function(e){var t,n,r,o,u=arguments[1];return i(this),(t=void 0!==u)&&i(u),null==e?new this:(n=[],t?(r=0,o=s(u,arguments[2],2),a(e,!1,(function(e){n.push(o(e,r++))}))):a(e,!1,n.push,n),new this(n))}})}},1479:function(e,t,n){var r=n(849),i=n(920),s=n(834)("species");e.exports=function(e,t){var n,a=r(e).constructor;return void 0===a||null==(n=r(a)[s])?t:i(n)}},1480:function(e,t,n){var r,i,s,a=n(901),o=n(1481),u=n(1712),c=n(1455),l=n(824),d=l.process,f=l.setImmediate,h=l.clearImmediate,p=l.MessageChannel,v=l.Dispatch,y=0,m={},g="onreadystatechange",b=function(){var e=+this;if(m.hasOwnProperty(e)){var t=m[e];delete m[e],t()}},k=function(e){b.call(e.data)};f&&h||(f=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return m[++y]=function(){o("function"==typeof e?e:Function(e),t)},r(y),y},h=function(e){delete m[e]},"process"==n(1107)(d)?r=function(e){d.nextTick(a(b,e,1))}:v&&v.now?r=function(e){v.now(a(b,e,1))}:p?(s=(i=new p).port2,i.port1.onmessage=k,r=a(s.postMessage,s,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(r=function(e){l.postMessage(e+"","*")},l.addEventListener("message",k,!1)):r=g in c("script")?function(e){u.appendChild(c("script")).onreadystatechange=function(){u.removeChild(this),b.call(e)}}:function(e){setTimeout(a(b,e,1),0)}),e.exports={set:f,clear:h}},1481:function(e,t){e.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},1482:function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},1483:function(e,t,n){var r=n(849),i=n(825),s=n(1233);e.exports=function(e,t){if(r(e),i(t)&&t.constructor===e)return t;var n=s.f(e);return(0,n.resolve)(t),n.promise}},1484:function(e,t,n){var r=n(834)("iterator"),i=!1;try{var s=[7][r]();s.return=function(){i=!0},Array.from(s,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var s=[7],a=s[r]();a.next=function(){return{done:n=!0}},s[r]=function(){return a},e(s)}catch(e){}return n}},1485:function(e,t,n){"use strict";var r=y(n(938)),i=y(n(814)),s=y(n(815)),a=y(n(816)),o=y(n(856)),u=y(n(787)),c=y(n(790)),l=y(n(857)),d=y(n(858)),f=y(n(1017)),h=y(n(1002)),p=y(n(935)),v=y(n(1018));function y(e){return e&&e.__esModule?e:{default:e}}var m=function(e,t,n,r){var i,s=arguments.length,a=s<3?t:null===r?r=(0,v.default)(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,p.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&(0,h.default)(t,n,a),a},g=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":(0,p.default)(Reflect))&&"function"==typeof f.default)return(0,f.default)(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.User=void 0;var b=n(324),k=n(838),w=n(839),x=n(1020),_=k.Logger.scope("User"),S=function(e){function t(e,n,r){(0,u.default)(this,t);var i=(0,l.default)(this,(t.__proto__||(0,o.default)(t)).call(this));return i.subscribed="initializing",i.setMaxListeners(0),i.services=r,i.state={identity:e,entityName:n,friendlyName:null,attributes:{},online:null,notifiable:null},i}var n,f,h,p;return(0,d.default)(t,e),(0,c.default)(t,[{key:"_update",value:function(e,t){var n=[];switch(_.debug("User for",this.state.identity,"updated:",e,t),e){case"friendlyName":this.state.friendlyName!==t.value&&(n.push("friendlyName"),this.state.friendlyName=t.value);break;case"attributes":var r=w.parseAttributes(t.value,"Retrieved malformed attributes from the server for user: "+this.state.identity,_);w.isDeepEqual(this.state.attributes,r)||(this.state.attributes=r,n.push("attributes"));break;case"reachability":this.state.online!==t.online&&(this.state.online=t.online,n.push("online")),this.state.notifiable!==t.notifiable&&(this.state.notifiable=t.notifiable,n.push("notifiable"));break;default:return}n.length>0&&this.emit("updated",{user:this,updateReasons:n})}},{key:"_updateReachabilityInfo",value:function(e,t){var n=this;return this.services.session.reachabilityEnabled?e.get("reachability").then(t).catch((function(e){_.warn("Failed to get reachability info for ",n.state.identity,e)})):a.default.resolve()}},{key:"_fetch",value:(p=(0,s.default)(i.default.mark((function e(){var t=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.entityName){e.next=2;break}return e.abrupt("return",this);case 2:return this.promiseToFetch=this.services.syncClient.map({id:this.state.entityName,mode:"open_existing",includeItems:!0}).then((function(e){return t.entity=e,e.on("itemUpdated",(function(e){return _.debug(t.state.entityName+" ("+t.state.identity+") itemUpdated: "+e.item.key),t._update(e.item.key,e.item.value)})),a.default.all([e.get("friendlyName").then((function(e){return t._update(e.key,e.value)})),e.get("attributes").then((function(e){return t._update(e.key,e.value)})),t._updateReachabilityInfo(e,(function(e){return t._update(e.key,e.value)}))])})).then((function(){return _.debug("Fetched for",t.identity),t.subscribed="subscribed",t.emit("userSubscribed",t),t})).catch((function(e){throw t.promiseToFetch=null,e})),e.abrupt("return",this.promiseToFetch);case 4:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"_ensureFetched",value:function(){return this.promiseToFetch||this._fetch()}},{key:"updateAttributes",value:(h=(0,s.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("unsubscribed"!=this.subscribed){e.next=2;break}throw new Error("Can't modify unsubscribed object");case 2:return e.next=4,this.services.session.addCommand("editUserAttributes",{username:this.state.identity,attributes:(0,r.default)(t)});case 4:return e.abrupt("return",this);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"updateFriendlyName",value:(f=(0,s.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("unsubscribed"!=this.subscribed){e.next=2;break}throw new Error("Can't modify unsubscribed object");case 2:return e.next=4,this.services.session.addCommand("editUserFriendlyName",{username:this.state.identity,friendlyName:t});case 4:return e.abrupt("return",this);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"unsubscribe",value:(n=(0,s.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.promiseToFetch){e.next=7;break}return e.next=3,this.promiseToFetch;case 3:this.entity.close(),this.promiseToFetch=null,this.subscribed="unsubscribed",this.emit("userUnsubscribed",this);case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"identity",get:function(){return this.state.identity},set:function(e){this.state.identity=e}},{key:"entityName",set:function(e){this.state.entityName=e}},{key:"attributes",get:function(){return this.state.attributes}},{key:"friendlyName",get:function(){return this.state.friendlyName}},{key:"online",get:function(){return this.state.online}},{key:"notifiable",get:function(){return this.state.notifiable}},{key:"isSubscribed",get:function(){return"subscribed"==this.subscribed}}]),t}(b.EventEmitter);m([x.asyncTypeCheck(["string","number","boolean","object",x.literal(null)]),g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype",a.default)],S.prototype,"updateAttributes",null),m([x.asyncTypeCheck(["string",x.literal(null)]),g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype",a.default)],S.prototype,"updateFriendlyName",null),t.User=S},1486:function(e,t,n){"use strict";function r(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function i(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}Object.defineProperty(t,"__esModule",{value:!0}),t.Pointer=void 0;var s=function(){function e(e){void 0===e&&(e=[""]),this.tokens=e}return e.fromJSON=function(t){var n=t.split("/").map(r);if(""!==n[0])throw new Error("Invalid JSON Pointer: "+t);return new e(n)},e.prototype.toString=function(){return this.tokens.map(i).join("/")},e.prototype.evaluate=function(e){for(var t=null,n="",r=e,i=1,s=this.tokens.length;i<s;i++)r=((t=r)||{})[n=this.tokens[i]];return{parent:t,key:n,value:r}},e.prototype.get=function(e){return this.evaluate(e).value},e.prototype.set=function(e,t){for(var n=e,r=1,i=this.tokens.length-1,s=this.tokens[r];r<i;r++)n=(n||{})[s];n&&(n[this.tokens[this.tokens.length-1]]=t)},e.prototype.push=function(e){this.tokens.push(e)},e.prototype.add=function(t){return new e(this.tokens.concat(String(t)))},e}();t.Pointer=s},1487:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.compare=void 0;var r=n(1235);function i(e,t){if(e===t)return!0;var n=r.objectType(e),s=r.objectType(t);return"array"==n&&"array"==s?function(e,t){var n=e.length;if(n!==t.length)return!1;for(var r=0;r<n;r++)if(!i(e[r],t[r]))return!1;return!0}(e,t):"object"==n&&"object"==s&&function(e,t){var n=Object.keys(e),s=Object.keys(t),a=n.length;if(a!==s.length)return!1;for(var o=0;o<a;o++){var u=n[o];if(!r.hasOwnProperty.call(t,u)||!i(e[u],t[u]))return!1}return!0}(e,t)}t.compare=i},1488:function(e,t,n){"use strict";var r=s(n(787)),i=s(n(790));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelDescriptor=void 0;var a=n(838),o=n(839),u=a.Logger.scope("ChannelDescriptor"),c=function(){function e(t,n){(0,r.default)(this,e),this.client=t,this.descriptor=n,n.sid?(this.sid=n.sid,this.channel=n.sid+".channel"):(this.sid=n.channel_sid,this.channel=n.channel_sid+".channel"),this.uniqueName=n.unique_name,this.friendlyName=n.friendly_name,this.attributes=o.parseAttributes(n.attributes,"Failed to parse channel attributes",u),this.createdBy=n.created_by,this.dateCreated=o.parseTime(n.date_created),this.dateUpdated=o.parseTime(n.date_updated),this.messagesCount=n.messages_count,this.membersCount=n.members_count,this.type=n.type,this.isPrivate="private"==n.type,this.lastConsumedMessageIndex=n.last_consumed_message_index,n.notification_level&&(this.notificationLevel=n.notification_level),n.status?this.status=n.status:this.status="unknown"}return(0,i.default)(e,[{key:"getChannel",value:function(){return this.client.getChannelBySid(this.sid)}}]),e}();t.ChannelDescriptor=c},1489:function(e,t,n){"use strict";var r,i=n(787),s=(r=i)&&r.__esModule?r:{default:r};Object.defineProperty(t,"__esModule",{value:!0}),t.NotificationTypes=void 0;var a=function e(){(0,s.default)(this,e)};t.NotificationTypes=a,a.TYPING_INDICATOR="twilio.ipmsg.typing_indicator",a.NEW_MESSAGE="twilio.channel.new_message",a.ADDED_TO_CHANNEL="twilio.channel.added_to_channel",a.INVITED_TO_CHANNEL="twilio.channel.invited_to_channel",a.REMOVED_FROM_CHANNEL="twilio.channel.removed_from_channel",a.CONSUMPTION_UPDATE="twilio.channel.consumption_update"},1490:function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);e.exports=function(){return n(r),r}}else{var i=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}},1491:function(e,t){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0,i=n;return[i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]]].join("")}},1492:function(e,t,n){"use strict";var r=n(783),i=n(781),s=n(784),a=n(474);Object.defineProperty(t,"__esModule",{value:!0});var o=n(940);t.TelemetryEvent=function e(t,n,r,i,s,o){a(this,e),this.start=t,this.end=n,this.title=r,this.details=i,this.id=s,this.type=o};var u=function(e){function t(e){var n;return a(this,t),(n=r(this,i(t).call(this))).method="telemetry.v1",n.events=e,n}return s(t,e),t}(o.AbstractMessage);t.Telemetry=u},1493:function(e,t,n){"use strict";var r=n(474),i=n(475);Object.defineProperty(t,"__esModule",{value:!0});var s=n(904);function a(e){return encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode("0x"+t)})).length}function o(e){var t=encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode("0x"+t)})),n=new Uint8Array(t.length);return Array.prototype.forEach.call(t,(function(e,t){n[t]=e.charCodeAt(0)})),n}function u(e){var t=Array.prototype.map.call(e,(function(e){return String.fromCharCode(e)})).join("").replace(/(.)/g,(function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}));return decodeURIComponent(t)}function c(e){return JSON.parse(u(e))}var l=function(){function e(){r(this,e)}return i(e,null,[{key:"parse",value:function(e){var t=new Uint8Array(e),n=function(e){for(var t="",n=0;n<e.length;++n){var r=String.fromCharCode(e[n]);if(t+=r,"\r"===r){n+=2;break}}var i=t.split(" ");return{size:n,protocol:i[0],version:i[1],headerSize:Number(i[2])}}(t);if("TWILSOCK"===n.protocol&&"V3.0"===n.version){var r=null;try{r=c(t.subarray(n.size,n.size+n.headerSize))}catch(t){return void s.log.error("failed to parse message header",t,e)}s.log.debug("message received: ",r.method),s.log.trace("message received: ",r);var i=null;if(r.payload_size>0){var a=2+n.size+n.headerSize,o=r.payload_size;if(r.hasOwnProperty("payload_type")&&0!==r.payload_type.indexOf("application/json"))0===r.payload_type.indexOf("text/plain")&&(i=u(t.subarray(a,a+o)));else try{i=c(t.subarray(a,a+o))}catch(t){return void s.log.error("failed to parse message body",t,e)}}return{method:r.method,header:r,payload:i}}s.log.error("unsupported protocol: ".concat(n.protocol," ver ").concat(n.version))}},{key:"createPacket",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e.payload_size=a(t);var n=JSON.stringify(e)+"\r\n",r="TWILSOCK V3.0 "+(a(n)-2)+"\r\n";s.log.debug("send request:",r+n+t);var i=o(r+n+t);return i.buffer}}]),e}();t.Parser=l},1494:function(e,t,n){"use strict";var r=n(474),i=n(783),s=n(781),a=n(784);Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(e,n){var a;return r(this,t),(a=i(this,s(t).call(this,e))).reply=n,a}return a(t,e),t}(n(878).TwilsockError);t.TwilsockReplyError=o},1495:function(e,t,n){"use strict";var r=n(474),i=n(783),s=n(781),a=n(784);Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(e){return r(this,t),i(this,s(t).call(this,e))}return a(t,e),t}(n(878).TwilsockError);t.TransportUnavailableError=o},1496:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Notifications=void 0;var r=n(2128);Object.defineProperty(t,"Notifications",{enumerable:!0,get:function(){return r.Client}})},1497:function(e,t,n){"use strict";var r=n(489),i=n(3),s=n(800),a=n(783),o=n(781),u=n(784),c=n(358),l=n(474),d=n(475);Object.defineProperty(t,"__esModule",{value:!0}),t.Connector=t.RegistrationState=void 0;var f=n(324),h=n(1242),p=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set;l(this,e),this.token=t,this.notificationId=n,this.messageTypes=r}return d(e,[{key:"clone",value:function(){return new e(this.token,this.notificationId,new Set(this.messageTypes))}}]),e}();function v(e,t){var n=new Set;return e.notificationId!==t.notificationId&&n.add("notificationId"),e.token!==t.token&&n.add("token"),function(e,t){return[].concat(c(c(e).filter((function(e){return!t.has(e)}))),c(c(t).filter((function(t){return!e.has(t)}))))}(e.messageTypes,t.messageTypes).length>0&&n.add("messageType"),[n.size>0,n]}t.RegistrationState=p;var y=function(e){function t(e){var n;return l(this,t),(n=a(this,o(t).call(this))).config=e,n.desiredState=new p,n.currentState=new p,n.hasActiveAttempt=!1,n}var n,c,f;return u(t,e),d(t,[{key:"subscribe",value:(f=s(i.mark((function e(t){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.desiredState.messageTypes.has(t)){e.next=3;break}return h.log.debug("message type already registered ",t),e.abrupt("return");case 3:return this.desiredState.messageTypes.add(t),e.next=6,this.persistRegistration();case 6:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"unsubscribe",value:(c=s(i.mark((function e(t){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.desiredState.messageTypes.has(t)){e.next=2;break}return e.abrupt("return");case 2:return this.desiredState.messageTypes.delete(t),e.next=5,this.persistRegistration();case 5:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"updateToken",value:function(e){this.desiredState.token=e,this.persistRegistration()}},{key:"persistRegistration",value:(n=s(i.mark((function e(){var t,n,s,a,o,u,c=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.config.token&&0!==this.config.token.length){e.next=3;break}return h.log.trace("Can't persist registration: token is not set"),e.abrupt("return");case 3:if(!this.hasActiveAttempt){e.next=6;break}return h.log.trace("One registration attempt is already in progress"),e.abrupt("return");case 6:if(t=v(this.desiredState,this.currentState),n=r(t,2),s=n[0],a=n[1],s){e.next=9;break}return e.abrupt("return");case 9:if(this.currentState.notificationId||a.delete("notificationId"),h.log.trace("Persisting registration",a,this.desiredState),e.prev=11,this.hasActiveAttempt=!0,!((o=this.desiredState.clone()).messageTypes.size>0)){e.next=24;break}return e.next=17,this.updateRegistration(o,a);case 17:u=e.sent,this.currentState.token=u.token,this.currentState.notificationId=u.notificationId,this.currentState.messageTypes=u.messageTypes,this.emit("stateChanged","registered"),e.next=30;break;case 24:return e.next=26,this.removeRegistration();case 26:this.currentState.token=o.token,this.currentState.notificationId=o.notificationId,this.currentState.messageTypes.clear(),this.emit("stateChanged","unregistered");case 30:return e.prev=30,this.hasActiveAttempt=!1,setTimeout((function(){return c.persistRegistration()}),0),e.finish(30);case 34:case"end":return e.stop()}}),e,this,[[11,,30,34]])}))),function(){return n.apply(this,arguments)})},{key:"setNotificationId",value:function(e){this.desiredState.notificationId=e,this.persistRegistration()}}]),t}(f.EventEmitter);t.Connector=y},1498:function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);e.exports=function(){return n(r),r}}else{var i=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}},1499:function(e,t){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0,i=n;return[i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]]].join("")}},1500:function(e,t,n){var r=n(2142),i=n(2143),s=i;s.v1=r,s.v4=i,e.exports=s},1501:function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);e.exports=function(){return n(r),r}}else{var i=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}},1502:function(e,t){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0,i=n;return[i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]]].join("")}},1503:function(e,t,n){"use strict";var r=n(981),i=n(939),s=n(3),a=n(800),o=n(474),u=n(475),c=n(783),l=n(781),d=n(784);Object.defineProperty(t,"__esModule",{value:!0}),t.SyncDocumentImpl=t.SyncDocument=void 0;var f=n(905),h=n(1022),p=n(906),v=n(1023),y=n(1243),m=n(1024),g=function(e){function t(e,n,r){var i;o(this,t),(i=c(this,l(t).call(this,e,r))).isDeleted=!1;return i.updateMergingQueue=new y.MergingQueue((function(e,t){return"number"==typeof t.ttl?{ttl:t.ttl}:e})),i.descriptor=n,i.descriptor.data=i.descriptor.data||{},i.descriptor.date_updated=new Date(i.descriptor.date_updated),i}var n,r,i,v,m,g,b,k,w;return d(t,e),u(t,[{key:"_update",value:function(e){switch(e.date_created=new Date(e.date_created),e.type){case"document_updated":e.id>this.lastEventId?(this.descriptor.last_event_id=e.id,this.descriptor.revision=e.document_revision,this.descriptor.date_updated=e.date_created,this.descriptor.data=e.document_data,this.broadcastEventToListeners("updated",{value:e.document_data,isLocal:!1}),this.services.storage.update(this.type,this.sid,this.uniqueName,{last_event_id:e.id,revision:e.document_revision,date_updated:e.date_created,data:e.document_data})):p.default.trace("Document update skipped, current:",this.lastEventId,", remote:",e.id);break;case"document_removed":this.onRemoved(!1)}}},{key:"set",value:(w=a(s.mark((function e(t,n){var r,i=this;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n||{},h.validateOptionalTtl(r.ttl),e.abrupt("return",this.updateMergingQueue.squashAndAdd(r,(function(e){return i._setUnconditionally(t,e.ttl)})));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return w.apply(this,arguments)})},{key:"mutate",value:(k=a(s.mark((function e(t,n){var r,i=this;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n||{},h.validateOptionalTtl(r.ttl),e.abrupt("return",this.updateMergingQueue.add(r,(function(e){return i._setWithIfMatch(t,e.ttl)})));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return k.apply(this,arguments)})},{key:"update",value:(b=a(s.mark((function e(t,n){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mutate((function(e){return Object.assign(e,t)}),n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return b.apply(this,arguments)})},{key:"setTtl",value:(g=a(s.mark((function e(t){var n;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h.validateMandatoryTtl(t),e.next=3,this._postUpdateToServer({ttl:t});case 3:n=e.sent,this.descriptor.date_expires=n.date_expires;case 5:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"_setUnconditionally",value:(m=a(s.mark((function e(t,n){var r;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._postUpdateToServer({data:t,revision:void 0,ttl:n});case 2:return r=e.sent,this._handleSuccessfulUpdateResult(r),e.abrupt("return",this.value);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return m.apply(this,arguments)})},{key:"_setWithIfMatch",value:(v=a(s.mark((function e(t,n){var r,i,a;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=t(h.deepClone(this.value)))){e.next=22;break}return i=this.revision,e.prev=3,e.next=6,this._postUpdateToServer({data:r,revision:i,ttl:n});case 6:return a=e.sent,this._handleSuccessfulUpdateResult(a),e.abrupt("return",this.value);case 11:if(e.prev=11,e.t0=e.catch(3),412!==e.t0.status){e.next=19;break}return e.next=16,this._softSync();case 16:return e.abrupt("return",this._setWithIfMatch(t));case 19:throw e.t0;case 20:e.next=23;break;case 22:return e.abrupt("return",this.value);case 23:case"end":return e.stop()}}),e,this,[[3,11]])}))),function(e,t){return v.apply(this,arguments)})},{key:"_handleSuccessfulUpdateResult",value:function(e){e.last_event_id>this.descriptor.last_event_id&&(this.descriptor.revision=e.revision,this.descriptor.data=e.data,this.descriptor.last_event_id=e.last_event_id,this.descriptor.date_expires=e.date_expires,this.descriptor.date_updated=new Date(e.date_updated),this.services.storage.update(this.type,this.sid,this.uniqueName,{last_event_id:e.last_event_id,revision:e.revision,date_updated:e.date_updated,data:e.data}),this.broadcastEventToListeners("updated",{value:this.value,isLocal:!0}))}},{key:"_postUpdateToServer",value:(i=a(s.mark((function e(t){var n,r,i;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDeleted){e.next=17;break}return n={data:t.data},void 0!==t.ttl&&(n.ttl=t.ttl),r=t.revision,e.prev=4,e.next=7,this.services.network.post(this.uri,n,r);case 7:return i=e.sent,e.abrupt("return",{revision:i.body.revision,data:t.data,last_event_id:i.body.last_event_id,date_updated:i.body.date_updated,date_expires:i.body.date_expires});case 11:throw e.prev=11,e.t0=e.catch(4),404===e.t0.status&&this.onRemoved(!1),e.t0;case 15:e.next=18;break;case 17:return e.abrupt("return",Promise.reject(new f.SyncError("The Document has been removed",404,54100)));case 18:case"end":return e.stop()}}),e,this,[[4,11]])}))),function(e){return i.apply(this,arguments)})},{key:"_softSync",value:(r=a(s.mark((function e(){var t=this;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.network.get(this.uri).then((function(e){var n={type:"document_updated",id:e.body.last_event_id,document_revision:e.body.revision,document_data:e.body.data,date_created:e.body.date_updated};return t._update(n),t})).catch((function(e){404===e.status?t.onRemoved(!1):p.default.error("Can't get updates for ".concat(t.sid,":"),e)})));case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"onRemoved",value:function(e){this.isDeleted||(this.isDeleted=!0,this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e}))}},{key:"removeDocument",value:(n=a(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDeleted){e.next=6;break}return e.next=3,this.services.network.delete(this.uri);case 3:this.onRemoved(!0),e.next=7;break;case 6:return e.abrupt("return",Promise.reject(new f.SyncError("The Document has been removed",404,54100)));case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"document"}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"value",get:function(){return this.descriptor.data}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}}],[{key:"type",get:function(){return"document"}}]),t}(v.SyncEntity);t.SyncDocumentImpl=g;var b=function(e){function t(e){var n;return o(this,t),(n=c(this,l(t).call(this))).syncDocumentImpl=e,n.syncDocumentImpl.attach(i(i(n))),n}var n,f,h,p,v;return d(t,e),u(t,[{key:"set",value:(v=a(s.mark((function e(t,n){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncDocumentImpl.set(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return v.apply(this,arguments)})},{key:"mutate",value:(p=a(s.mark((function e(t,n){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncDocumentImpl.mutate(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return p.apply(this,arguments)})},{key:"update",value:(h=a(s.mark((function e(t,n){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncDocumentImpl.update(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return h.apply(this,arguments)})},{key:"setTtl",value:(f=a(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncDocumentImpl.setTtl(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"removeDocument",value:(n=a(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncDocumentImpl.removeDocument());case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"close",value:function(){r(l(t.prototype),"close",this).call(this),this.syncDocumentImpl.detach(this.listenerUuid)}},{key:"uri",get:function(){return this.syncDocumentImpl.uri}},{key:"revision",get:function(){return this.syncDocumentImpl.revision}},{key:"lastEventId",get:function(){return this.syncDocumentImpl.lastEventId}},{key:"dateExpires",get:function(){return this.syncDocumentImpl.dateExpires}},{key:"type",get:function(){return g.type}},{key:"sid",get:function(){return this.syncDocumentImpl.sid}},{key:"value",get:function(){return this.syncDocumentImpl.value}},{key:"dateUpdated",get:function(){return this.syncDocumentImpl.dateUpdated}},{key:"uniqueName",get:function(){return this.syncDocumentImpl.uniqueName}}],[{key:"type",get:function(){return g.type}}]),t}(m.default);t.SyncDocument=b,t.default=b},1504:function(e,t,n){"use strict";var r=n(981),i=n(939),s=n(3),a=n(800),o=n(474),u=n(475),c=n(783),l=n(781),d=n(784);Object.defineProperty(t,"__esModule",{value:!0}),t.SyncListImpl=t.SyncList=void 0;var f=n(1022),h=n(1118),p=n(905),v=n(906),y=n(1023),m=n(1505),g=n(1506),b=n(1244),k=n(1243),w=n(1024),x=function(e){function t(e,n,r){var i;o(this,t);return(i=c(this,l(t).call(this,e,r))).updateMergingQueue=new k.NamespacedMergingQueue((function(e,t){return"number"==typeof t.ttl?{ttl:t.ttl}:e})),i.cache=new b.Cache,i.descriptor=n,i.descriptor.date_updated=new Date(i.descriptor.date_updated),i}var n,r,i,y,w,x,_,S,C,T,E,I,M,P,R,O;return d(t,e),u(t,[{key:"_addOrUpdateItemOnServer",value:(O=a(s.mark((function e(t,n,r,i){var a,o;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={data:n},void 0!==i&&(a.ttl=i),e.next=4,this.services.network.post(t,a,r);case 4:return(o=e.sent).body.data=n,o.body.date_updated=new Date(o.body.date_updated),e.abrupt("return",o.body);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return O.apply(this,arguments)})},{key:"push",value:(R=a(s.mark((function e(t,n){var r,i,a;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n||{}).ttl,f.validateOptionalTtl(r),e.next=4,this._addOrUpdateItemOnServer(this.links.items,t,void 0,r);case 4:return i=e.sent,a=Number(i.index),this._handleItemMutated(a,i.url,i.last_event_id,i.revision,t,i.date_updated,i.date_expires,!0,!1),e.abrupt("return",this.cache.get(a));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return R.apply(this,arguments)})},{key:"set",value:(P=a(s.mark((function e(t,n,r){var i,a=this;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r||{},f.validateOptionalTtl(i.ttl),e.abrupt("return",this.updateMergingQueue.squashAndAdd(t,i,(function(e){return a._updateItemUnconditionally(t,n,e.ttl)})));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return P.apply(this,arguments)})},{key:"_updateItemUnconditionally",value:(M=a(s.mark((function e(t,n,r){var i,a;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return i=e.sent,e.next=5,this._addOrUpdateItemOnServer(i.uri,n,void 0,r);case 5:return a=e.sent,this._handleItemMutated(t,a.url,a.last_event_id,a.revision,a.data,a.date_updated,a.date_expires,!1,!1),e.abrupt("return",this.cache.get(t));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return M.apply(this,arguments)})},{key:"_updateItemWithIfMatch",value:(I=a(s.mark((function e(t,n,r){var i,a,o,u;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:if(i=e.sent,!(a=n(f.deepClone(i.value)))){e.next=25;break}return o=i.revision,e.prev=6,e.next=9,this._addOrUpdateItemOnServer(i.uri,a,o,r);case 9:return u=e.sent,this._handleItemMutated(t,u.url,u.last_event_id,u.revision,u.data,u.date_updated,u.date_expires,!1,!1),e.abrupt("return",this.cache.get(t));case 14:if(e.prev=14,e.t0=e.catch(6),412!==e.t0.status){e.next=22;break}return e.next=19,this._getItemFromServer(t);case 19:return e.abrupt("return",this._updateItemWithIfMatch(t,n,r));case 22:throw e.t0;case 23:e.next=26;break;case 25:return e.abrupt("return",i);case 26:case"end":return e.stop()}}),e,this,[[6,14]])}))),function(e,t,n){return I.apply(this,arguments)})},{key:"mutate",value:(E=a(s.mark((function e(t,n,r){var i,a=this;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r||{},f.validateOptionalTtl(i.ttl),e.abrupt("return",this.updateMergingQueue.add(t,i,(function(e){return a._updateItemWithIfMatch(t,n,e.ttl)})));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return E.apply(this,arguments)})},{key:"update",value:(T=a(s.mark((function e(t,n,r){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mutate(t,(function(e){return Object.assign(e,n)}),r));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return T.apply(this,arguments)})},{key:"remove",value:(C=a(s.mark((function e(t){var n,r;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return n=e.sent,e.next=5,this.services.network.delete(n.uri);case 5:r=e.sent,this._handleItemRemoved(t,r.body.last_event_id,void 0,new Date(r.body.date_updated),!1);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return C.apply(this,arguments)})},{key:"get",value:(S=a(s.mark((function e(t){var n;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this.cache.get(t))){e.next=5;break}return e.abrupt("return",n);case 5:return e.abrupt("return",this._getItemFromServer(t));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return S.apply(this,arguments)})},{key:"_getItemFromServer",value:(_=a(s.mark((function e(t){var n;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.queryItems({index:t});case 2:if(!((n=e.sent).items.length<1)){e.next=7;break}throw new p.SyncError("No item with index ".concat(t," found"),404,54151);case 7:return e.abrupt("return",n.items[0]);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return _.apply(this,arguments)})},{key:"queryItems",value:(x=a(s.mark((function e(t){var n,r,i,a,o=this;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},n=new h.UriBuilder(this.links.items).queryParam("From",t.from).queryParam("PageSize",t.limit).queryParam("Index",t.index).queryParam("PageToken",t.pageToken).queryParam("Order",t.order).build(),e.next=4,this.services.network.get(n);case 4:return r=e.sent,i=r.body.items.map((function(e){return e.date_updated=new Date(e.date_updated),o.cache.get(e.index)?o._handleItemMutated(e.index,e.url,e.last_event_id,e.revision,e.data,e.date_updated,e.date_expires,!1,!0):o.cache.store(Number(e.index),new m.ListItem({index:Number(e.index),uri:e.url,revision:e.revision,lastEventId:e.last_event_id,dateUpdated:e.date_updated,dateExpires:e.date_expires,value:e.data}),e.last_event_id),o.cache.get(e.index)})),a=r.body.meta,e.abrupt("return",new g.Paginator(i,(function(e){return o.queryItems({pageToken:e})}),a.previous_token,a.next_token));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return x.apply(this,arguments)})},{key:"getItems",value:(w=a(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},f.validatePageSize(t.pageSize),t.limit=t.pageSize||t.limit||50,t.order=t.order||"asc",e.abrupt("return",this.queryItems(t));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return w.apply(this,arguments)})},{key:"getContext",value:(y=a(s.mark((function e(){var t;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.context){e.next=5;break}return e.next=3,this.services.network.get(this.links.context);case 3:t=e.sent,this._updateContextIfRequired(t.body.data,t.body.last_event_id);case 5:return e.abrupt("return",this.context);case 6:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"setTtl",value:(i=a(s.mark((function e(t){var n,r;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f.validateMandatoryTtl(t),e.prev=1,n={ttl:t},e.next=5,this.services.network.post(this.uri,n);case 5:r=e.sent,this.descriptor.date_expires=r.body.date_expires,e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(1),404===e.t0.status&&this.onRemoved(!1),e.t0;case 13:case"end":return e.stop()}}),e,this,[[1,9]])}))),function(e){return i.apply(this,arguments)})},{key:"setItemTtl",value:(r=a(s.mark((function e(t,n){var r,i,a;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f.validateMandatoryTtl(n),e.next=3,this.get(t);case 3:return r=e.sent,i={ttl:n},e.next=7,this.services.network.post(r.uri,i);case 7:a=e.sent,r.updateDateExpires(a.body.date_expires);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"removeList",value:(n=a(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"onRemoved",value:function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e})}},{key:"shouldIgnoreEvent",value:function(e,t){return this.cache.isKnown(e,t)}},{key:"_update",value:function(e,t){var n=Number(e.item_index);switch(e.date_created=new Date(e.date_created),e.type){case"list_item_added":case"list_item_updated":this._handleItemMutated(n,e.item_url,e.id,e.item_revision,e.item_data,e.date_created,void 0,"list_item_added"===e.type,!0);break;case"list_item_removed":this._handleItemRemoved(n,e.id,e.item_data,e.date_created,!0);break;case"list_context_updated":this._handleContextUpdate(e.context_data,e.id,e.date_created);break;case"list_removed":this.onRemoved(!1)}t&&this._advanceLastEventId(e.id,e.list_revision)}},{key:"_advanceLastEventId",value:function(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e,t&&(this.descriptor.revision=t))}},{key:"_updateRootDateUpdated",value:function(e){(!this.descriptor.date_updated||e.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=e,this.services.storage.update(this.type,this.sid,this.uniqueName,{date_updated:e}))}},{key:"_handleItemMutated",value:function(e,t,n,r,i,s,a,o,u){if(this.shouldIgnoreEvent(e,n))v.default.trace("Item ",e," update skipped, current:",this.lastEventId,", remote:",n);else{this._updateRootDateUpdated(s);var c=this.cache.get(e);if(c)c.update(n,r,i,s),this.cache.store(e,c,n),void 0!==a&&c.updateDateExpires(a),this.emitItemMutationEvent(c,u,!1);else{var l=new m.ListItem({index:e,uri:t,lastEventId:n,revision:r,value:i,dateUpdated:s,dateExpires:a});this.cache.store(e,l,n),this.emitItemMutationEvent(l,u,o)}}}},{key:"emitItemMutationEvent",value:function(e,t,n){var r=n?"itemAdded":"itemUpdated";this.broadcastEventToListeners(r,{item:e,isLocal:!t})}},{key:"_handleItemRemoved",value:function(e,t,n,r,i){this._updateRootDateUpdated(r),this.cache.delete(e,t),this.broadcastEventToListeners("itemRemoved",{index:e,isLocal:!i,value:n})}},{key:"_handleContextUpdate",value:function(e,t,n){this._updateRootDateUpdated(n),this._updateContextIfRequired(e,t)&&this.broadcastEventToListeners("contextUpdated",{context:e,isLocal:!1})}},{key:"_updateContextIfRequired",value:function(e,t){return!this.contextEventId||t>this.contextEventId?(this.context=e,this.contextEventId=t,!0):(v.default.trace("Context update skipped, current:",this.lastEventId,", remote:",t),!1)}},{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"links",get:function(){return this.descriptor.links}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"list"}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}}],[{key:"type",get:function(){return"list"}}]),t}(y.SyncEntity);t.SyncListImpl=x;var _=function(e){function t(e){var n;return o(this,t),(n=c(this,l(t).call(this))).syncListImpl=e,n.syncListImpl.attach(i(i(n))),n}var n,f,h,p,v,y,m,g,b,k,w;return d(t,e),u(t,[{key:"push",value:(w=a(s.mark((function e(t,n){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.push(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return w.apply(this,arguments)})},{key:"set",value:(k=a(s.mark((function e(t,n,r){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.set(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return k.apply(this,arguments)})},{key:"mutate",value:(b=a(s.mark((function e(t,n,r){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.mutate(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return b.apply(this,arguments)})},{key:"update",value:(g=a(s.mark((function e(t,n,r){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.update(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return g.apply(this,arguments)})},{key:"remove",value:(m=a(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.remove(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"get",value:(y=a(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.get(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"getContext",value:(v=a(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.getContext());case 2:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"getItems",value:(p=a(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.getItems(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"setTtl",value:(h=a(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.setTtl(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"setItemTtl",value:(f=a(s.mark((function e(t,n){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.setItemTtl(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return f.apply(this,arguments)})},{key:"removeList",value:(n=a(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.removeList());case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"close",value:function(){r(l(t.prototype),"close",this).call(this),this.syncListImpl.detach(this.listenerUuid)}},{key:"uri",get:function(){return this.syncListImpl.uri}},{key:"revision",get:function(){return this.syncListImpl.revision}},{key:"lastEventId",get:function(){return this.syncListImpl.lastEventId}},{key:"links",get:function(){return this.syncListImpl.links}},{key:"dateExpires",get:function(){return this.syncListImpl.dateExpires}},{key:"type",get:function(){return x.type}},{key:"sid",get:function(){return this.syncListImpl.sid}},{key:"uniqueName",get:function(){return this.syncListImpl.uniqueName}},{key:"dateUpdated",get:function(){return this.syncListImpl.dateUpdated}}],[{key:"type",get:function(){return x.type}}]),t}(w.default);t.SyncList=_,t.default=_},1505:function(e,t,n){"use strict";var r=n(474),i=n(475);Object.defineProperty(t,"__esModule",{value:!0}),t.ListItem=void 0;var s=function(){function e(t){r(this,e),this.data=t}return i(e,[{key:"update",value:function(e,t,n,r){return this.data.lastEventId=e,this.data.revision=t,this.data.value=n,this.data.dateUpdated=r,this}},{key:"updateDateExpires",value:function(e){this.data.dateExpires=e}},{key:"uri",get:function(){return this.data.uri}},{key:"revision",get:function(){return this.data.revision}},{key:"lastEventId",get:function(){return this.data.lastEventId}},{key:"dateUpdated",get:function(){return this.data.dateUpdated}},{key:"dateExpires",get:function(){return this.data.dateExpires}},{key:"index",get:function(){return this.data.index}},{key:"value",get:function(){return this.data.value}}]),e}();t.ListItem=s,t.default=s},1506:function(e,t,n){"use strict";var r=n(3),i=n(800),s=n(474),a=n(475);Object.defineProperty(t,"__esModule",{value:!0}),t.Paginator=void 0;var o=function(){function e(t,n,r,i){s(this,e),this.prevToken=r,this.nextToken=i,this.items=t,this.source=n}var t,n;return a(e,[{key:"nextPage",value:(n=i(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasNextPage){e.next=2;break}throw new Error("No next page");case 2:return e.abrupt("return",this.source(this.nextToken));case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"prevPage",value:(t=i(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasPrevPage){e.next=2;break}throw new Error("No previous page");case 2:return e.abrupt("return",this.source(this.prevToken));case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"hasNextPage",get:function(){return!!this.nextToken}},{key:"hasPrevPage",get:function(){return!!this.prevToken}}]),e}();t.Paginator=o},1507:function(e,t,n){"use strict";var r=n(981),i=n(939),s=n(3),a=n(800),o=n(474),u=n(475),c=n(783),l=n(781),d=n(784);Object.defineProperty(t,"__esModule",{value:!0}),t.SyncMap=t.SyncMapImpl=void 0;var f=n(1022),h=n(1118),p=n(905),v=n(906),y=n(1023),m=n(1508),g=n(1506),b=n(1244),k=n(1243),w=n(1024),x=function(e){function t(e,n,r){var i;o(this,t);return(i=c(this,l(t).call(this,e,r))).updateMergingQueue=new k.NamespacedMergingQueue((function(e,t){return"number"==typeof t.ttl?{ttl:t.ttl}:e})),i.cache=new b.Cache,i.descriptor=n,i.descriptor.date_updated=new Date(i.descriptor.date_updated),n.items&&n.items.forEach((function(e){e.date_updated=new Date(e.date_updated),i.cache.store(e.key,new m.MapItem(e),e.last_event_id)})),i}var n,r,i,y,w,x,_,S,C,T,E,I,M,P;return d(t,e),u(t,[{key:"set",value:(P=a(s.mark((function e(t,n,r){var i,a=this;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r||{},f.validateOptionalTtl(i.ttl),e.abrupt("return",this.updateMergingQueue.squashAndAdd(t,i,(function(e){return a._putItemUnconditionally(t,n,e.ttl)})));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return P.apply(this,arguments)})},{key:"get",value:(M=a(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cache.has(t)){e.next=4;break}return e.abrupt("return",this.cache.get(t));case 4:return e.abrupt("return",this._getItemFromServer(t));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return M.apply(this,arguments)})},{key:"_getItemFromServer",value:(I=a(s.mark((function e(t){var n;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.queryItems({key:t});case 2:if(!((n=e.sent).items.length<1)){e.next=7;break}throw new p.SyncError("No item with key ".concat(t," found"),404,54201);case 7:return e.abrupt("return",n.items[0]);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return I.apply(this,arguments)})},{key:"mutate",value:(E=a(s.mark((function e(t,n,r){var i,a=this;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r||{},f.validateOptionalTtl(i.ttl),e.abrupt("return",this.updateMergingQueue.add(t,i,(function(e){return a._putItemWithIfMatch(t,n,e.ttl)})));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return E.apply(this,arguments)})},{key:"update",value:(T=a(s.mark((function e(t,n,r){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mutate(t,(function(e){return Object.assign(e,n)}),r));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return T.apply(this,arguments)})},{key:"_putItemUnconditionally",value:(C=a(s.mark((function e(t,n,r){var i,a;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._putItemToServer(t,n,void 0,r);case 2:return i=e.sent,a=i.item,this._handleItemMutated(a.key,a.url,a.last_event_id,a.revision,a.data,a.date_updated,a.date_expires,i.added,!1),e.abrupt("return",this.cache.get(a.key));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return C.apply(this,arguments)})},{key:"_putItemWithIfMatch",value:(S=a(s.mark((function e(t,n,r){var i,a,o,u,c;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t).catch((function(e){if(404===e.status)return new m.MapItem({key:t,data:{},last_event_id:-1,revision:"-1",url:null,date_updated:null,date_expires:null});throw e}));case 2:if(i=e.sent,!(a=n(f.deepClone(i.value)))){e.next=26;break}return o=i.revision,e.prev=6,e.next=9,this._putItemToServer(t,a,o,r);case 9:return u=e.sent,c=u.item,this._handleItemMutated(c.key,c.url,c.last_event_id,c.revision,c.data,c.date_updated,c.date_expires,u.added,!1),e.abrupt("return",this.cache.get(c.key));case 15:if(e.prev=15,e.t0=e.catch(6),412!==e.t0.status){e.next=23;break}return e.next=20,this._getItemFromServer(t);case 20:return e.abrupt("return",this._putItemWithIfMatch(t,n,r));case 23:throw e.t0;case 24:e.next=27;break;case 26:return e.abrupt("return",i);case 27:case"end":return e.stop()}}),e,this,[[6,15]])}))),function(e,t,n){return S.apply(this,arguments)})},{key:"_putItemToServer",value:(_=a(s.mark((function e(t,n,r,i){var a,o,u,c,l;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new h.UriBuilder(this.links.items).pathSegment(t).build(),o={data:n},void 0!==i&&(o.ttl=i),e.prev=3,e.next=6,this.services.network.put(a,o,r);case 6:return u=e.sent,(c=u.body).data=n,c.date_updated=new Date(c.date_updated),l=201===u.status.code,e.abrupt("return",{added:l,item:c});case 14:throw e.prev=14,e.t0=e.catch(3),404===e.t0.status&&this.onRemoved(!1),e.t0;case 18:case"end":return e.stop()}}),e,this,[[3,14]])}))),function(e,t,n,r){return _.apply(this,arguments)})},{key:"remove",value:(x=a(s.mark((function e(t){var n,r;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=2;break}throw new Error("Key argument is invalid");case 2:return e.next=4,this.get(t);case 4:return n=e.sent,e.next=7,this.services.network.delete(n.uri);case 7:r=e.sent,this._handleItemRemoved(t,r.body.last_event_id,void 0,new Date(r.body.date_updated),!1);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return x.apply(this,arguments)})},{key:"queryItems",value:(w=a(s.mark((function e(t){var n,r,i,a,o=this;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},n=new h.UriBuilder(this.links.items).queryParam("From",t.from).queryParam("PageSize",t.limit).queryParam("Key",t.key).queryParam("PageToken",t.pageToken).queryParam("Order",t.order).build(),e.next=4,this.services.network.get(n);case 4:return r=e.sent,i=r.body.items.map((function(e){return e.date_updated=new Date(e.date_updated),o.cache.get(e.key)?o._handleItemMutated(e.key,e.url,e.last_event_id,e.revision,e.data,e.date_updated,e.date_expires,!1,!0):o.cache.store(e.key,new m.MapItem(e),e.last_event_id),o.cache.get(e.key)})),a=r.body.meta,e.abrupt("return",new g.Paginator(i,(function(e){return o.queryItems({pageToken:e})}),a.previous_token,a.next_token));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return w.apply(this,arguments)})},{key:"getItems",value:(y=a(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},f.validatePageSize(t.pageSize),t.limit=t.pageSize||t.limit||50,t.order=t.order||"asc",e.abrupt("return",this.queryItems(t));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"shouldIgnoreEvent",value:function(e,t){return this.cache.isKnown(e,t)}},{key:"_update",value:function(e,t){switch(e.date_created=new Date(e.date_created),e.type){case"map_item_added":case"map_item_updated":this._handleItemMutated(e.item_key,e.item_url,e.id,e.item_revision,e.item_data,e.date_created,void 0,"map_item_added"===e.type,!0);break;case"map_item_removed":this._handleItemRemoved(e.item_key,e.id,e.item_data,e.date_created,!0);break;case"map_removed":this.onRemoved(!1)}t&&this._advanceLastEventId(e.id,e.map_revision)}},{key:"_advanceLastEventId",value:function(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e,t&&(this.descriptor.revision=t))}},{key:"_updateRootDateUpdated",value:function(e){(!this.descriptor.date_updated||e.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=e,this.services.storage.update(this.type,this.sid,this.uniqueName,{date_updated:e}))}},{key:"_handleItemMutated",value:function(e,t,n,r,i,s,a,o,u){if(this.shouldIgnoreEvent(e,n))v.default.trace("Item ",e," update skipped, current:",this.lastEventId,", remote:",n);else{this._updateRootDateUpdated(s);var c=this.cache.get(e);c?(c.update(n,r,i,s),this.cache.store(e,c,n),void 0!==a&&c.updateDateExpires(a),this.emitItemMutationEvent(c,u,!1)):(c=new m.MapItem({key:e,url:t,last_event_id:n,revision:r,data:i,date_updated:s,date_expires:a}),this.cache.store(e,c,n),this.emitItemMutationEvent(c,u,o))}}},{key:"emitItemMutationEvent",value:function(e,t,n){var r=n?"itemAdded":"itemUpdated";this.broadcastEventToListeners(r,{item:e,isLocal:!t})}},{key:"_handleItemRemoved",value:function(e,t,n,r,i){this._updateRootDateUpdated(r),this.cache.delete(e,t),this.broadcastEventToListeners("itemRemoved",{key:e,isLocal:!i,value:n})}},{key:"onRemoved",value:function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e})}},{key:"setTtl",value:(i=a(s.mark((function e(t){var n,r;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f.validateMandatoryTtl(t),e.prev=1,n={ttl:t},e.next=5,this.services.network.post(this.uri,n);case 5:r=e.sent,this.descriptor.date_expires=r.body.date_expires,e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(1),404===e.t0.status&&this.onRemoved(!1),e.t0;case 13:case"end":return e.stop()}}),e,this,[[1,9]])}))),function(e){return i.apply(this,arguments)})},{key:"setItemTtl",value:(r=a(s.mark((function e(t,n){var r,i,a;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f.validateMandatoryTtl(n),e.next=3,this.get(t);case 3:return r=e.sent,i={ttl:n},e.next=7,this.services.network.post(r.uri,i);case 7:a=e.sent,r.updateDateExpires(a.body.date_expires);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"removeMap",value:(n=a(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"uri",get:function(){return this.descriptor.url}},{key:"links",get:function(){return this.descriptor.links}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"map"}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}}],[{key:"type",get:function(){return"map"}}]),t}(y.SyncEntity);t.SyncMapImpl=x;var _=function(e){function t(e){var n;return o(this,t),(n=c(this,l(t).call(this))).syncMapImpl=e,n.syncMapImpl.attach(i(i(n))),n}var n,f,h,p,v,y,m,g,b;return d(t,e),u(t,[{key:"set",value:(b=a(s.mark((function e(t,n,r){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.set(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return b.apply(this,arguments)})},{key:"get",value:(g=a(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.get(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"mutate",value:(m=a(s.mark((function e(t,n,r){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.mutate(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return m.apply(this,arguments)})},{key:"update",value:(y=a(s.mark((function e(t,n,r){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.update(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return y.apply(this,arguments)})},{key:"remove",value:(v=a(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.remove(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"getItems",value:(p=a(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.getItems(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"setTtl",value:(h=a(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.setTtl(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"setItemTtl",value:(f=a(s.mark((function e(t,n){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.setItemTtl(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return f.apply(this,arguments)})},{key:"removeMap",value:(n=a(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.next=3,this.syncMapImpl.removeMap();case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"close",value:function(){r(l(t.prototype),"close",this).call(this),this.syncMapImpl.detach(this.listenerUuid)}},{key:"uri",get:function(){return this.syncMapImpl.uri}},{key:"links",get:function(){return this.syncMapImpl.links}},{key:"revision",get:function(){return this.syncMapImpl.revision}},{key:"lastEventId",get:function(){return this.syncMapImpl.lastEventId}},{key:"dateExpires",get:function(){return this.syncMapImpl.dateExpires}},{key:"type",get:function(){return x.type}},{key:"sid",get:function(){return this.syncMapImpl.sid}},{key:"uniqueName",get:function(){return this.syncMapImpl.uniqueName}},{key:"dateUpdated",get:function(){return this.syncMapImpl.dateUpdated}}],[{key:"type",get:function(){return x.type}}]),t}(w.Closeable);t.SyncMap=_,t.default=_},1508:function(e,t,n){"use strict";var r=n(474),i=n(475);Object.defineProperty(t,"__esModule",{value:!0}),t.MapItem=void 0;var s=function(){function e(t){r(this,e),this.descriptor=t}return i(e,[{key:"update",value:function(e,t,n,r){return this.descriptor.last_event_id=e,this.descriptor.revision=t,this.descriptor.data=n,this.descriptor.date_updated=r,this}},{key:"updateDateExpires",value:function(e){this.descriptor.date_expires=e}},{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"key",get:function(){return this.descriptor.key}},{key:"value",get:function(){return this.descriptor.data}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}}]),e}();t.MapItem=s},1509:function(e,t,n){"use strict";var r=n(3),i=n(981),s=n(939),a=n(800),o=n(475),u=n(783),c=n(781),l=n(784),d=n(474);Object.defineProperty(t,"__esModule",{value:!0}),t.InstantQuery=t.LiveQuery=t.queryItems=t.LiveQueryImpl=t.InsightsItem=void 0;var f=n(1118),h=n(905),p=n(906),v=n(324),y=n(1023),m=n(1024),g=n(1244);t.InsightsItem=function e(){d(this,e)};var b=function(e){function t(e,n,r,i){var s;return d(this,t),(s=u(this,c(t).call(this,n,r))).descriptor=e,s.cache=new g.Cache,i&&i.forEach((function(e){s.cache.store(e.key,{key:e.key,value:e.data},e.revision)})),s}return l(t,e),o(t,[{key:"onRemoved",value:function(){}},{key:"getItems",value:function(){var e={};return this.cache.forEach((function(t,n){e[t]=n.value})),e}},{key:"_update",value:function(e,t){switch(e.type){case"live_query_item_updated":this.handleItemMutated(e.item_key,e.item_data,e.item_revision);break;case"live_query_item_removed":this.handleItemRemoved(e.item_key,e.item_revision);break;case"live_query_updated":this.handleBatchUpdate(e.items)}t&&this._advanceLastEventId(e.last_event_id)}},{key:"handleItemMutated",value:function(e,t,n){if(this.shouldIgnoreEvent(e,n))p.default.trace("Item ".concat(e," update skipped, revision: ").concat(n));else{var r={key:e,value:t};this.cache.store(e,r,n),this.broadcastEventToListeners("itemUpdated",r)}}},{key:"handleItemRemoved",value:function(e,t){var n=null===t;this.shouldIgnoreEvent(e,t)?p.default.trace("Item ".concat(e," delete skipped, revision: ").concat(t)):(this.cache.delete(e,t,n),this.broadcastEventToListeners("itemRemoved",{key:e}))}},{key:"handleBatchUpdate",value:function(e){var t=this,n={};for(var r in null!=e&&e.forEach((function(e){n[e.key]={data:e.data,revision:e.revision}})),this.cache.forEach((function(e,r){var i=n[e];null!=i?t.handleItemMutated(e,i.data,i.revision):t.handleItemRemoved(e,null),delete n[e]})),n)this.handleItemMutated(r,n[r].data,n[r].revision)}},{key:"shouldIgnoreEvent",value:function(e,t){return null!=e&&null!=t&&this.cache.isKnown(e,t)}},{key:"_advanceLastEventId",value:function(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e)}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return null}},{key:"type",get:function(){return t.type}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"indexName",get:function(){return this.descriptor.indexName}},{key:"queryString",get:function(){return this.descriptor.queryExpression}},{key:"queryUri",get:function(){return this.descriptor.queryUri}},{key:"liveQueryDescriptor",get:function(){return this.descriptor}}],[{key:"type",get:function(){return"live_query"}}]),t}(y.SyncEntity);function k(e){return w.apply(this,arguments)}function w(){return(w=a(r.mark((function e(t){var n,i,s,a,o,u;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.network,i=t.queryString,s=t.uri,a=t.type,null!=i){e.next=3;break}throw new h.SyncError("Invalid query",400,54507);case 3:return o={query_string:i},a===x.type&&(o.type=a),e.next=7,n.post(s,o,void 0,!0);case 7:return u=e.sent,e.abrupt("return",u.body);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}t.LiveQueryImpl=b,t.queryItems=k;var x=function(e){function t(e){var n;return d(this,t),(n=u(this,c(t).call(this))).liveQueryImpl=e,n.liveQueryImpl.attach(s(s(n))),n}return l(t,e),o(t,[{key:"close",value:function(){i(c(t.prototype),"close",this).call(this),this.liveQueryImpl.detach(this.listenerUuid)}},{key:"getItems",value:function(){return this.ensureNotClosed(),this.liveQueryImpl.getItems()}},{key:"type",get:function(){return b.type}},{key:"lastEventId",get:function(){return this.liveQueryImpl.lastEventId}},{key:"sid",get:function(){return this.liveQueryImpl.sid}}],[{key:"type",get:function(){return b.type}}]),t}(m.Closeable);t.LiveQuery=x;var _=function(e){function t(e){var n;return d(this,t),(n=u(this,c(t).call(this))).queryExpression=null,n.items={},Object.assign(s(s(n)),e),n.updateIndexName(e.indexName),n}var n,i;return l(t,e),o(t,[{key:"search",value:(i=a(r.mark((function e(t){var n=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.items={},e.abrupt("return",k({network:this.network,uri:this.queryUri,queryString:t}).then((function(e){n.queryExpression=t,e.items&&e.items.forEach((function(e){n.items[e.key]=e.data})),n.emit("searchResult",n.getItems())})).catch((function(e){throw p.default.error("Error '".concat(e.message,"' while executing query '").concat(t,"'")),n.queryExpression=null,e})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"subscribe",value:(n=a(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.queryExpression){e.next=2;break}return e.abrupt("return",Promise.reject(new h.SyncError("Invalid query",400,54507)));case 2:return e.abrupt("return",this.liveQueryCreator(this.indexName,this.queryExpression));case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getItems",value:function(){return this.items}},{key:"updateIndexName",value:function(e){if(!e||"string"!=typeof e)throw new Error("Index name must contain a non-empty string value");this.indexName=e,this.queryUri=this.generateQueryUri(this.indexName)}},{key:"generateQueryUri",value:function(e){return new f.UriBuilder(this.insightsUri).pathSegment(e).pathSegment("Items").build()}},{key:"type",get:function(){return t.type}}],[{key:"type",get:function(){return"instant_query"}}]),t}(v.EventEmitter);t.InstantQuery=_,t.default=x},1510:function(e,t,n){"use strict";var r=n(474),i=n(475);Object.defineProperty(t,"__esModule",{value:!0});var s=n(1019);function a(e,t){return["".concat((new Date).toISOString()," MCS Client ").concat(e,":")].concat(Array.from(t))}var o=function(){function e(t){r(this,e),this.prefix="",this.prefix=null!=t&&t.length>0?t+" ":""}return i(e,[{key:"setLevel",value:function(e){s.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];s.trace.apply(null,a(this.prefix+"T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];s.debug.apply(null,a(this.prefix+"D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];s.info.apply(null,a(this.prefix+"I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];s.warn.apply(null,a(this.prefix+"W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];s.error.apply(null,a(this.prefix+"E",t))}}],[{key:"scope",value:function(t){return new e(t)}},{key:"setLevel",value:function(e){s.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];s.trace.apply(null,a("T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];s.debug.apply(null,a("D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];s.info.apply(null,a("I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];s.warn.apply(null,a("W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];s.error.apply(null,a("E",t))}}]),e}();t.Logger=o},1511:function(e,t,n){"use strict";var r=n(474),i=n(475);Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(t,n,i){r(this,e);var s=i.MCS||i||{};this.region=s.region||i.region,this.baseUrl=(void 0===this.region?"https://mcs.us1.twilio.com":"https://mcs.".concat(this.region,".twilio.com"))+n,this.token=t,this.retryWhenThrottledOverride=s.retryWhenThrottledOverride,this.backoffConfigOverride=s.backoffConfigOverride}return i(e,[{key:"updateToken",value:function(e){this.token=e}}],[{key:"backoffConfigDefault",get:function(){return{min:1e3,max:4e3,maxAttemptsCount:3}}},{key:"retryWhenThrottledDefault",get:function(){return true}}]),e}();t.Configuration=s},1512:function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);e.exports=function(){return n(r),r}}else{var i=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}},1513:function(e,t){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0,i=n;return[i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]]].join("")}},1514:function(e,t,n){"use strict";var r=d(n(1716)),i=d(n(1715)),s=d(n(1234)),a=d(n(2163)),o=d(n(856)),u=d(n(787)),c=d(n(857)),l=d(n(858));function d(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.SessionError=void 0;var f=function(e){function t(e,n){(0,u.default)(this,t);var r=(0,c.default)(this,(t.__proto__||(0,o.default)(t)).call(this));return r.name=r.constructor.name,r.message=e,r.code=n,Error.captureStackTrace?Error.captureStackTrace(r,r.constructor):r.stack=(new Error).stack,r}return(0,l.default)(t,e),t}(function(e){function t(){var t=(0,a.default)(e,(0,s.default)(arguments));return(0,i.default)(t,(0,o.default)(this)),t}return t.prototype=(0,r.default)(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),i.default?(0,i.default)(t,e):t.__proto__=e,t}(Error));t.SessionError=f},1515:function(e,t,n){"use strict";var r=a(n(816)),i=a(n(787)),s=a(n(790));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Deferred=void 0;var o=function(){function e(){var t=this;(0,i.default)(this,e),this._promise=new r.default((function(e,n){t._resolve=e,t._reject=n}))}return(0,s.default)(e,[{key:"update",value:function(e){this._resolve(e)}},{key:"set",value:function(e){this.current=e,this._resolve(e)}},{key:"fail",value:function(e){this._reject(e)}},{key:"promise",get:function(){return this._promise}}]),e}();t.Deferred=o},1516:function(e){e.exports={name:"twilio-chat",version:"4.1.0",description:"Twilio Chat service client library",main:"lib/index.js",browser:"browser/index.js",types:"./lib/client.d.ts",author:"Twilio",license:"MIT",dependencies:{"twilio-mcs-client":"^0.3.3","twilio-notifications":"^0.5.9","twilio-sync":"^0.13.0",twilsock:"^0.6.1","babel-runtime":"^6.26.0","iso8601-duration":"^1.2.0",loglevel:"^1.6.6","operation-retrier":"^3.0.0",platform:"^1.3.6",rfc6902:"^3.0.2",uuid:"^3.3.2"},devDependencies:{"@types/chai":"^4.2.5","@types/chai-as-promised":"^7.1.2","@types/chai-string":"^1.4.1","@types/core-js":"^2.5.0","@types/mocha":"^5.2.7","@types/node":"^12.12.12","@types/sinon":"^7.5.1","@types/sinon-chai":"^3.2.2",async:"^3.0.1","async-test-tools":"^1.0.7","babel-core":"^6.26.0","babel-plugin-transform-builtin-extend":"^1.1.2","babel-plugin-transform-runtime":"^6.23.0","babel-preset-env":"^1.6.1",babelify:"^8.0.0",backoff:"^2.5.0",browserify:"^16.2.3","browserify-replace":"^1.0.0",browserslist:"^4.13.0",chai:"^4.2.0","chai-as-promised":"^7.1.1","chai-string":"^1.5.0",cheerio:"^1.0.0-rc.2","cross-env":"^5.2.0",del:"^5.1.0","fancy-log":"^1.3.3",fs:"0.0.2",gulp:"^4.0.2","gulp-babel":"^7.0.1","gulp-derequire":"^2.1.0","gulp-if":"^2.0.2","gulp-insert":"^0.5.0","gulp-rename":"^1.4.0","gulp-sourcemaps":"^2.6.5","gulp-tap":"^1.0.1","gulp-tslint":"^8.1.4","gulp-typescript":"^5.0.1","gulp-uglify-es":"^1.0.4","ink-docstrap":"^1.3.2","isomorphic-form-data":"^2.0.0",jsdoc:"~3.5.5","jsdoc-strip-async-await":"^0.1.0",mocha:"^6.2.2","mocha.parallel":"^0.15.6","node-fetch":"^2.6.0",nyc:"^14.1.1",path:"^0.12.7",sinon:"^7.5.0","sinon-chai":"^3.3.0","source-map-explorer":"^2.1.1","ts-node":"^8.5.2",tslint:"^5.20.1",twilio:"^3.37.1",typescript:"^3.7.2","uglify-save-license":"^0.4.1","vinyl-buffer":"^1.0.1","vinyl-source-stream":"^2.0.0"},engines:{node:">=6"},browserslist:["IE 11","last 3 Chrome versions","last 3 Firefox versions","last 3 Safari versions","last 3 Edge versions","last 2 iOS version","last 2 ChromeAndroid version","last 2 FirefoxAndroid version","last 2 Samsung versions","last 2 UCAndroid versions"]}},1517:function(e,t,n){e.exports={default:n(2169),__esModule:!0}},1518:function(e,t,n){"use strict";var r=m(n(816)),i=m(n(938)),s=m(n(814)),a=m(n(815)),o=m(n(1236)),u=m(n(856)),c=m(n(787)),l=m(n(790)),d=m(n(857)),f=m(n(858)),h=m(n(1017)),p=m(n(1002)),v=m(n(935)),y=m(n(1018));function m(e){return e&&e.__esModule?e:{default:e}}var g=function(e,t,n,r){var i,s=arguments.length,a=s<3?t:null===r?r=(0,y.default)(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,v.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&(0,p.default)(t,n,a),a},b=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":(0,v.default)(Reflect))&&"function"==typeof h.default)return(0,h.default)(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.Member=void 0;var k=n(324),w=n(839),x=n(838),_=n(1020),S=x.Logger.scope("Member"),C=function(e){function t(e,n,r,i){(0,c.default)(this,t);var s=(0,d.default)(this,(t.__proto__||(0,u.default)(t)).call(this));if(s.channel=n,s.services=e,s.state={attributes:w.parseAttributes(r.attributes,"Retrieved malformed attributes from the server for member: "+i,S),dateCreated:r.dateCreated?w.parseTime(r.dateCreated):null,dateUpdated:r.dateCreated?w.parseTime(r.dateUpdated):null,sid:i,typingTimeout:null,isTyping:!1,identity:r.identity||null,roleSid:r.roleSid||null,lastConsumedMessageIndex:(0,o.default)(r.lastConsumedMessageIndex)?r.lastConsumedMessageIndex:null,lastConsumptionTimestamp:r.lastConsumptionTimestamp?w.parseTime(r.lastConsumptionTimestamp):null,type:r.type||"chat",userInfo:r.userInfo},!r.identity&&!r.type)throw new Error("Received invalid Member object from server: Missing identity or type of Member.");return s}var n,r,h,p;return(0,f.default)(t,e),(0,l.default)(t,[{key:"_startTyping",value:function(e){var t=this;return clearTimeout(this.state.typingTimeout),this.state.isTyping=!0,this.emit("typingStarted",this),this.channel.emit("typingStarted",this),this.state.typingTimeout=setTimeout((function(){return t._endTyping()}),e),this}},{key:"_endTyping",value:function(){this.state.typingTimeout&&(this.state.isTyping=!1,this.emit("typingEnded",this),this.channel.emit("typingEnded",this),clearInterval(this.state.typingTimeout),this.state.typingTimeout=null)}},{key:"_update",value:function(e){var t=[],n=w.parseAttributes(e.attributes,"Retrieved malformed attributes from the server for member: "+this.state.sid,S);e.attributes&&!w.isDeepEqual(this.state.attributes,n)&&(this.state.attributes=n,t.push("attributes"));var r=w.parseTime(e.dateUpdated);e.dateUpdated&&r.getTime()!==(this.state.dateUpdated&&this.state.dateUpdated.getTime())&&(this.state.dateUpdated=r,t.push("dateUpdated"));var i=w.parseTime(e.dateCreated);if(e.dateCreated&&i.getTime()!==(this.state.dateCreated&&this.state.dateCreated.getTime())&&(this.state.dateCreated=i,t.push("dateCreated")),e.roleSid&&this.state.roleSid!==e.roleSid&&(this.state.roleSid=e.roleSid,t.push("roleSid")),!(0,o.default)(e.lastConsumedMessageIndex)&&null!==e.lastConsumedMessageIndex||this.state.lastConsumedMessageIndex===e.lastConsumedMessageIndex||(this.state.lastConsumedMessageIndex=e.lastConsumedMessageIndex,t.push("lastConsumedMessageIndex")),e.lastConsumptionTimestamp){var s=new Date(e.lastConsumptionTimestamp);this.state.lastConsumptionTimestamp&&this.state.lastConsumptionTimestamp.getTime()===s.getTime()||(this.state.lastConsumptionTimestamp=s,t.push("lastConsumptionTimestamp"))}return t.length>0&&this.emit("updated",{member:this,updateReasons:t}),this}},{key:"getUserDescriptor",value:(p=(0,a.default)(s.default.mark((function e(){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("chat"==this.type){e.next=2;break}throw new Error("Getting User Descriptor is not supported for this Member type: "+this.type);case 2:return e.abrupt("return",this.services.users.getUserDescriptor(this.state.identity));case 3:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"getUser",value:(h=(0,a.default)(s.default.mark((function e(){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("chat"==this.type){e.next=2;break}throw new Error("Getting User is not supported for this Member type: "+this.type);case 2:return e.abrupt("return",this.services.users.getUser(this.state.identity,this.state.userInfo));case 3:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"remove",value:(r=(0,a.default)(s.default.mark((function e(){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.channel.removeMember(this));case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"updateAttributes",value:(n=(0,a.default)(s.default.mark((function e(t){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("editMemberAttributes",{channelSid:this.channel.sid,memberSid:this.sid,attributes:(0,i.default)(t)});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"sid",get:function(){return this.state.sid}},{key:"attributes",get:function(){return this.state.attributes}},{key:"dateCreated",get:function(){return this.state.dateCreated}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"identity",get:function(){return this.state.identity}},{key:"isTyping",get:function(){return this.state.isTyping}},{key:"lastConsumedMessageIndex",get:function(){return this.state.lastConsumedMessageIndex}},{key:"lastConsumptionTimestamp",get:function(){return this.state.lastConsumptionTimestamp}},{key:"roleSid",get:function(){return this.state.roleSid}},{key:"type",get:function(){return this.state.type}}]),t}(k.EventEmitter);g([_.asyncTypeCheck(["string","number","boolean","object",_.literal(null)]),b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",r.default)],C.prototype,"updateAttributes",null),t.Member=C},2054:function(e,t,n){"use strict";var r=n(2055);e.exports=r},2055:function(e,t,n){"use strict";var r=b(n(1113)),i=b(n(1230)),s=b(n(877)),a=b(n(814)),o=b(n(815)),u=b(n(816)),c=b(n(1415)),l=b(n(856)),d=b(n(790)),f=b(n(857)),h=b(n(858)),p=b(n(787)),v=b(n(1017)),y=b(n(1002)),m=b(n(935)),g=b(n(1018));function b(e){return e&&e.__esModule?e:{default:e}}var k=function(e,t,n,r){var i,s=arguments.length,a=s<3?t:null===r?r=(0,g.default)(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,m.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&(0,y.default)(t,n,a),a},w=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":(0,m.default)(Reflect))&&"function"==typeof v.default)return(0,v.default)(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.PushNotification=t.Client=t.User=void 0;var x=n(324),_=n(838),S=n(2086),C=n(1485);Object.defineProperty(t,"User",{enumerable:!0,get:function(){return C.User}});var T=n(2094),E=n(2095),I=n(1489),M=n(2099),P=n(1021),R=n(1496),O=n(2136),N=n(2150),U=n(2158),j=n(2168),A=n(2183),D=n(2186),L=n(2187),F=n(2188),q=n(2189);Object.defineProperty(t,"PushNotification",{enumerable:!0,get:function(){return q.PushNotification}});var B=n(839),W=n(1020),z=_.Logger.scope("Client"),H=n(1516).version,J=function e(){(0,p.default)(this,e)},G=function(e){function t(e,n){(0,p.default)(this,t);var r=(0,f.default)(this,(t.__proto__||(0,l.default)(t)).call(this));if(r.connectionState="connecting",r.sessionPromise=null,r.channelsPromise=null,r.version=H,r.parsePushNotification=t.parsePushNotification,r.options=n||{},!r.options.disableDeepClone){var i=(0,c.default)((0,c.default)({},r.options),{transport:void 0,twilsockClient:void 0});(i=B.deepClone(i)).transport=r.options.transport,i.twilsockClient=r.options.twilsockClient,r.options=i}r.options.logLevel=r.options.logLevel||"silent",z.setLevel(r.options.logLevel);var s=r.options.productId="ip_messaging";if(r.options.clientMetadata=r.options.clientMetadata||{},r.options.clientMetadata.hasOwnProperty("type")||(r.options.clientMetadata.type="chat"),r.options.clientMetadata.hasOwnProperty("sdk")||(r.options.clientMetadata.sdk="JS",r.options.clientMetadata.sdkv=H),r.options.Sync=r.options.Sync||{},void 0===r.options.Sync.enableSessionStorage&&(r.options.Sync.enableSessionStorage=!0),r.options.region&&(r.options.Sync.region=r.options.region),!e)throw new Error("A valid Twilio token should be provided");return r.services=new J,r.config=new S.Configuration(r.options),r.options.twilsockClient=r.options.twilsockClient||new P.Twilsock(e,s,r.options),r.options.transport=r.options.transport||r.options.twilsockClient,r.options.notificationsClient=r.options.notificationsClient||new R.Notifications(e,r.options),r.options.syncClient=r.options.syncClient||new O.SyncClient(e,r.options),r.services.syncClient=r.options.syncClient,r.services.transport=r.options.transport,r.services.twilsockClient=r.options.twilsockClient,r.services.notificationClient=r.options.notificationsClient,r.services.session=new U.Session(r.services,r.config),r.sessionPromise=r.services.session.initialize(),r.services.network=new E.Network(r.config,r.services),r.services.users=new A.Users({session:r.services.session,network:r.services.network,syncClient:r.services.syncClient}),r.services.users.on("userSubscribed",r.emit.bind(r,"userSubscribed")),r.services.users.on("userUpdated",(function(e){return r.emit("userUpdated",e)})),r.services.users.on("userUnsubscribed",r.emit.bind(r,"userUnsubscribed")),r.services.twilsockClient.on("tokenAboutToExpire",(function(e){return r.emit("tokenAboutToExpire",e)})),r.services.twilsockClient.on("tokenExpired",(function(){return r.emit("tokenExpired")})),r.services.twilsockClient.on("connectionError",(function(e){return r.emit("connectionError",e)})),r.services.consumptionHorizon=new L.ConsumptionHorizon(r.services),r.services.typingIndicator=new D.TypingIndicator(r.config,{transport:r.services.twilsockClient,notificationClient:r.services.notificationClient},r.getChannelBySid.bind(r)),r.services.syncList=new M.SyncList(r.services),r.channels=new j.Channels(r.services),r.channelsPromise=r.sessionPromise.then((function(){return r.channels.on("channelAdded",r.emit.bind(r,"channelAdded")),r.channels.on("channelRemoved",r.emit.bind(r,"channelRemoved")),r.channels.on("channelInvited",r.emit.bind(r,"channelInvited")),r.channels.on("channelJoined",r.emit.bind(r,"channelJoined")),r.channels.on("channelLeft",r.emit.bind(r,"channelLeft")),r.channels.on("channelUpdated",(function(e){return r.emit("channelUpdated",e)})),r.channels.on("memberJoined",r.emit.bind(r,"memberJoined")),r.channels.on("memberLeft",r.emit.bind(r,"memberLeft")),r.channels.on("memberUpdated",(function(e){return r.emit("memberUpdated",e)})),r.channels.on("messageAdded",r.emit.bind(r,"messageAdded")),r.channels.on("messageUpdated",(function(e){return r.emit("messageUpdated",e)})),r.channels.on("messageRemoved",r.emit.bind(r,"messageRemoved")),r.channels.on("typingStarted",r.emit.bind(r,"typingStarted")),r.channels.on("typingEnded",r.emit.bind(r,"typingEnded")),r.channels.fetchChannels()})).then((function(){return r.channels})),r.services.notificationClient.on("connectionStateChanged",(function(e){var t=null;switch(e){case"connected":t="connected";break;case"denied":t="denied";break;case"disconnecting":t="disconnecting";break;case"disconnected":t="disconnected";break;default:t="connecting"}t!==r.connectionState&&(r.connectionState=t,r.emit("connectionStateChanged",r.connectionState))})),r.fpaToken=e,r}var n,r,i,s,v,y,m,g,b,k,w;return(0,h.default)(t,e),(0,d.default)(t,[{key:"subscribeToPushNotifications",value:function(e){var t=this,n=[];return[I.NotificationTypes.NEW_MESSAGE,I.NotificationTypes.ADDED_TO_CHANNEL,I.NotificationTypes.INVITED_TO_CHANNEL,I.NotificationTypes.REMOVED_FROM_CHANNEL,I.NotificationTypes.TYPING_INDICATOR,I.NotificationTypes.CONSUMPTION_UPDATE].forEach((function(r){n.push(t.services.notificationClient.subscribe(r,e))})),u.default.all(n)}},{key:"unsubscribeFromPushNotifications",value:function(e){var t=this,n=[];return[I.NotificationTypes.NEW_MESSAGE,I.NotificationTypes.ADDED_TO_CHANNEL,I.NotificationTypes.INVITED_TO_CHANNEL,I.NotificationTypes.REMOVED_FROM_CHANNEL,I.NotificationTypes.TYPING_INDICATOR,I.NotificationTypes.CONSUMPTION_UPDATE].forEach((function(r){n.push(t.services.notificationClient.unsubscribe(r,e))})),u.default.all(n)}},{key:"initialize",value:(w=(0,o.default)(a.default.mark((function e(){var n,r,i=this;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sessionPromise;case 2:return t.supportedPushChannels.forEach((function(e){return i.subscribeToPushNotifications(e)})),e.next=5,this.services.session.getSessionLinks();case 5:return n=e.sent,this.services.publicChannels=new T.PublicChannels(this,this.services,n.publicChannelsUrl),this.services.userChannels=new F.UserChannels(this,this.services,n.myChannelsUrl),(r=(0,c.default)(this.options)).transport=null,this.services.mcsClient=new N.McsClient(this.fpaToken,n.mediaServiceUrl,r),e.next=13,this.services.typingIndicator.initialize();case 13:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)})},{key:"shutdown",value:(k=(0,o.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.twilsockClient.disconnect();case 2:case"end":return e.stop()}}),e,this)}))),function(){return k.apply(this,arguments)})},{key:"updateToken",value:(b=(0,o.default)(a.default.mark((function e(t){var n=this;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(z.info("updateToken"),this.fpaToken!==t){e.next=3;break}return e.abrupt("return",this);case 3:return e.next=5,this.services.twilsockClient.updateToken(t).then((function(){return n.fpaToken=t})).then((function(){return n.services.mcsClient.updateToken(t)})).then((function(){return n.sessionPromise}));case 5:return e.abrupt("return",this);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)})},{key:"getChannelBySid",value:(g=(0,o.default)(a.default.mark((function e(t){var n=this;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.channels.syncListRead.promise.then((function(){return n.channels.getChannel(t).then((function(e){return e||n.services.publicChannels.getChannelBySid(t).then((function(e){return n.channels.pushChannel(e)}))}))})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"getChannelByUniqueName",value:(m=(0,o.default)(a.default.mark((function e(t){var n=this;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.channels.syncListRead.promise.then((function(){return n.services.publicChannels.getChannelByUniqueName(t).then((function(e){return n.channels.pushChannel(e)}))})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"getSubscribedChannels",value:function(e){return this.channelsPromise.then((function(t){return t.getChannels(e)}))}},{key:"getLocalChannels",value:function(e){return this.channelsPromise.then((function(n){var r=[];n.channels.forEach((function(e){r.push(e)}));var i=(null==e?void 0:e.order)||"ascending";return e&&e.criteria&&("lastMessage"===e.criteria?r.sort((function(e,n){return t.compareChannelsByLastMessage(e,n,i)})):"uniqueName"===e.criteria?r.sort((function(e,n){return t.compareChannelsByStringProperty(e.uniqueName,n.uniqueName,i)})):"friendlyName"===e.criteria&&r.sort((function(e,n){return t.compareChannelsByStringProperty(e.friendlyName,n.friendlyName,i)}))),r}))}},{key:"getPublicChannelDescriptors",value:function(){return this.services.publicChannels.getChannels()}},{key:"getUserChannelDescriptors",value:function(){return this.services.userChannels.getChannels()}},{key:"createChannel",value:function(e){return e=e||{},this.channelsPromise.then((function(t){return t.addChannel(e)}))}},{key:"setPushRegistrationId",value:(y=(0,o.default)(a.default.mark((function e(t,n){var r=this;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.subscribeToPushNotifications(t).then((function(){return r.services.notificationClient.setPushRegistrationId(n,t)}));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return y.apply(this,arguments)})},{key:"unsetPushRegistrationId",value:(v=(0,o.default)(a.default.mark((function e(n){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1!==t.supportedPushChannels.indexOf(n)){e.next=2;break}throw new Error("Invalid or unsupported channelType: "+n);case 2:return e.next=4,this.unsubscribeFromPushNotifications(n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"handlePushNotification",value:(s=(0,o.default)(a.default.mark((function e(n){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:z.debug("handlePushNotification, notificationPayload=",n),this.emit("pushNotification",t.parsePushNotification(n));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"getUser",value:function(e){return this.services.users.getUser(e)}},{key:"getUserDescriptor",value:(i=(0,o.default)(a.default.mark((function e(t){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.users.getUserDescriptor(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"getSubscribedUsers",value:(r=(0,o.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.users.getSubscribedUsers());case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"user",get:function(){return this.services.users.myself}},{key:"reachabilityEnabled",get:function(){return this.services.session.reachabilityEnabled}},{key:"token",get:function(){return this.fpaToken}}],[{key:"create",value:(n=(0,o.default)(a.default.mark((function e(n,r){var i;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new t(n,r),e.next=3,i.initialize();case 3:return e.abrupt("return",i);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"compareChannelsByLastMessage",value:function(e,t,n){if(e.lastMessage&&t.lastMessage){if(e.lastMessage.dateCreated&&t.lastMessage.dateCreated)return e.lastMessage.dateCreated.getTime()<t.lastMessage.dateCreated.getTime()?"ascending"===n?-1:1:"ascending"===n?1:-1;if(e.lastMessage.dateCreated)return-1;if(t.lastMessage.dateCreated)return 1}return e.lastMessage?-1:t.lastMessage?1:0}},{key:"compareChannelsByStringProperty",value:function(e,t,n){return e&&t?"ascending"===n?e.localeCompare(t):-1*e.localeCompare(t):e?-1:t?1:0}},{key:"parsePushNotificationChatData",value:function(e){var n={};for(var r in t.supportedPushDataFields)void 0!==e[r]&&null!==e[r]&&("message_index"===r?null!==B.parseToNumber(e[r])&&(n[t.supportedPushDataFields[r]]=Number(e[r])):n[t.supportedPushDataFields[r]]=e[r]);return n}},{key:"parsePushNotification",value:function(e){if(z.debug("parsePushNotification, notificationPayload=",e),void 0!==e.aps){if(!e.twi_message_type)throw new Error("Provided push notification payload does not contain Programmable Chat push notification type");var n=t.parsePushNotificationChatData(e),r=e.aps,i=null,s=null;return"string"==typeof r.alert?i=r.alert||null:(i=r.alert.body||null,s=r.alert.title||null),new q.PushNotification({title:s,body:i,sound:r.sound||null,badge:r.badge||null,action:r.category||null,type:e.twi_message_type,data:n})}if(void 0!==e.data){var a=e.data;if(!a.twi_message_type)throw new Error("Provided push notification payload does not contain Programmable Chat push notification type");var o=t.parsePushNotificationChatData(e.data);return new q.PushNotification({title:a.twi_title||null,body:a.twi_body||null,sound:a.twi_sound||null,badge:null,action:a.twi_action||null,type:a.twi_message_type,data:o})}throw new Error("Provided push notification payload is not Programmable Chat notification")}}]),t}(x.EventEmitter);G.version=H,G.supportedPushChannels=["fcm","apn","gcm"],G.supportedPushDataFields={channel_sid:"channelSid",message_sid:"messageSid",message_index:"messageIndex"},k([W.asyncTypeCheck(W.nonEmptyString),w("design:type",Function),w("design:paramtypes",[String]),w("design:returntype",u.default)],G.prototype,"updateToken",null),k([W.asyncTypeCheck(W.nonEmptyString),w("design:type",Function),w("design:paramtypes",[String]),w("design:returntype",u.default)],G.prototype,"getChannelBySid",null),k([W.asyncTypeCheck(W.nonEmptyString),w("design:type",Function),w("design:paramtypes",[String]),w("design:returntype",u.default)],G.prototype,"getChannelByUniqueName",null),k([W.asyncTypeCheck(["undefined",W.custom((function(e){var t="valid sorting options";if("object"!==(void 0===e?"undefined":(0,m.default)(e))||null===e||Array.isArray(e))return[!1,t+" (should be a pure object)"];var n=new s.default([["criteria",["lastMessage","friendlyName","uniqueName"]],["order",["ascending","descending"]]]),a=!0,o=!1,u=void 0;try{for(var c,l=(0,r.default)(n.entries());!(a=(c=l.next()).done);a=!0){var d=c.value,f=(0,i.default)(d,2),h=f[0],p=f[1];if(void 0!==e[h]&&!p.includes(e[h]))return[!1,t+" (sortingOptions."+h+' should be one of: "'+p.join('", "')+'")',"malformed sorting options (sortingOptions."+h+" is "+W.stringifyReceivedType(e[h])+")"]}}catch(e){o=!0,u=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw u}}return[!0]}))]),w("design:type",Function),w("design:paramtypes",[Object]),w("design:returntype",u.default)],G.prototype,"getLocalChannels",null),k([W.asyncTypeCheck(["undefined",W.custom((function(e){var t="valid channel options";if("object"!==(void 0===e?"undefined":(0,m.default)(e))||null===e||Array.isArray(e))return[!1,t+" (should be a pure object)"];var n=new s.default([["friendlyName","string"],["isPrivate","boolean"],["uniqueName","string"]]),a=!0,o=!1,u=void 0;try{for(var c,l=(0,r.default)(n.entries());!(a=(c=l.next()).done);a=!0){var d=c.value,f=(0,i.default)(d,2),h=f[0],p=f[1];if(void 0!==e[h]&&(0,m.default)(e[h])!==p)return[!1,t+" (options."+h+" should be of type "+p+")","malformed channel options (options."+h+" is "+W.stringifyReceivedType(e[h])+")"]}}catch(e){o=!0,u=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw u}}return[!0]}))]),w("design:type",Function),w("design:paramtypes",[Object]),w("design:returntype",u.default)],G.prototype,"createChannel",null),k([W.asyncTypeCheck(W.literal("gcm","fcm","apn"),"string"),w("design:type",Function),w("design:paramtypes",[String,String]),w("design:returntype",u.default)],G.prototype,"setPushRegistrationId",null),k([W.asyncTypeCheck(W.literal("gcm","fcm","apn")),w("design:type",Function),w("design:paramtypes",[String]),w("design:returntype",u.default)],G.prototype,"unsetPushRegistrationId",null),k([W.asyncTypeCheck(W.pureObject),w("design:type",Function),w("design:paramtypes",[Object]),w("design:returntype",u.default)],G.prototype,"handlePushNotification",null),k([W.asyncTypeCheck(W.nonEmptyString),w("design:type",Function),w("design:paramtypes",[String]),w("design:returntype",u.default)],G.prototype,"getUser",null),k([W.asyncTypeCheck(W.nonEmptyString),w("design:type",Function),w("design:paramtypes",[String]),w("design:returntype",u.default)],G.prototype,"getUserDescriptor",null),k([W.asyncTypeCheck("string",["undefined",W.pureObject]),w("design:type",Function),w("design:paramtypes",[String,Object]),w("design:returntype",u.default)],G,"create",null),k([W.typeCheck(W.pureObject),w("design:type",Function),w("design:paramtypes",[Object]),w("design:returntype",q.PushNotification)],G,"parsePushNotification",null),t.Client=G,t.default=G},2056:function(e,t,n){n(1003),n(957),e.exports=n(2057)},2057:function(e,t,n){var r=n(849),i=n(1229);e.exports=n(795).getIterator=function(e){var t=i(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return r(t.call(e))}},2058:function(e,t,n){e.exports={default:n(2059),__esModule:!0}},2059:function(e,t,n){n(1003),n(957),e.exports=n(2060)},2060:function(e,t,n){var r=n(1114),i=n(834)("iterator"),s=n(1057);e.exports=n(795).isIterable=function(e){var t=Object(e);return void 0!==t[i]||"@@iterator"in t||s.hasOwnProperty(r(t))}},2061:function(e,t,n){n(1205),n(957),n(1003),n(1471),n(2064),n(2066),n(2067),e.exports=n(795).Map},2062:function(e,t,n){var r=n(2063);e.exports=function(e,t){return new(r(e))(t)}},2063:function(e,t,n){var r=n(825),i=n(1714),s=n(834)("species");e.exports=function(e){var t;return i(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!i(t.prototype)||(t=void 0),r(t)&&null===(t=t[s])&&(t=void 0)),void 0===t?Array:t}},2064:function(e,t,n){var r=n(813);r(r.P+r.R,"Map",{toJSON:n(1476)("Map")})},2065:function(e,t,n){var r=n(978);e.exports=function(e,t){var n=[];return r(e,!1,n.push,n,t),n}},2066:function(e,t,n){n(1477)("Map")},2067:function(e,t,n){n(1478)("Map")},2068:function(e,t,n){var r=function(){return this}()||Function("return this")(),i=r.regeneratorRuntime&&Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime")>=0,s=i&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,e.exports=n(2069),i)r.regeneratorRuntime=s;else try{delete r.regeneratorRuntime}catch(e){r.regeneratorRuntime=void 0}},2069:function(e,t){!function(t){"use strict";var n,r=Object.prototype,i=r.hasOwnProperty,s="function"==typeof Symbol?Symbol:{},a=s.iterator||"@@iterator",o=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag",c="object"==typeof e,l=t.regeneratorRuntime;if(l)c&&(e.exports=l);else{(l=t.regeneratorRuntime=c?e.exports:{}).wrap=k;var d="suspendedStart",f="suspendedYield",h="executing",p="completed",v={},y={};y[a]=function(){return this};var m=Object.getPrototypeOf,g=m&&m(m(R([])));g&&g!==r&&i.call(g,a)&&(y=g);var b=S.prototype=x.prototype=Object.create(y);_.prototype=b.constructor=S,S.constructor=_,S[u]=_.displayName="GeneratorFunction",l.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===_||"GeneratorFunction"===(t.displayName||t.name))},l.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,S):(e.__proto__=S,u in e||(e[u]="GeneratorFunction")),e.prototype=Object.create(b),e},l.awrap=function(e){return{__await:e}},C(T.prototype),T.prototype[o]=function(){return this},l.AsyncIterator=T,l.async=function(e,t,n,r){var i=new T(k(e,t,n,r));return l.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},C(b),b[u]="Generator",b[a]=function(){return this},b.toString=function(){return"[object Generator]"},l.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},l.values=R,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(M),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,i){return o.type="throw",o.arg=e,t.next=r,i&&(t.method="next",t.arg=n),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var a=this.tryEntries[s],o=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var u=i.call(a,"catchLoc"),c=i.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var s=r;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=e,a.arg=t,s?(this.method="next",this.next=s.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),M(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;M(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:R(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=n),v}}}function k(e,t,n,r){var i=t&&t.prototype instanceof x?t:x,s=Object.create(i.prototype),a=new P(r||[]);return s._invoke=function(e,t,n){var r=d;return function(i,s){if(r===h)throw new Error("Generator is already running");if(r===p){if("throw"===i)throw s;return O()}for(n.method=i,n.arg=s;;){var a=n.delegate;if(a){var o=E(a,n);if(o){if(o===v)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===d)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=h;var u=w(e,t,n);if("normal"===u.type){if(r=n.done?p:f,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=p,n.method="throw",n.arg=u.arg)}}}(e,n,a),s}function w(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function x(){}function _(){}function S(){}function C(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function T(e){function t(n,r,s,a){var o=w(e[n],e,r);if("throw"!==o.type){var u=o.arg,c=u.value;return c&&"object"==typeof c&&i.call(c,"__await")?Promise.resolve(c.__await).then((function(e){t("next",e,s,a)}),(function(e){t("throw",e,s,a)})):Promise.resolve(c).then((function(e){u.value=e,s(u)}),a)}a(o.arg)}var n;this._invoke=function(e,r){function i(){return new Promise((function(n,i){t(e,r,n,i)}))}return n=n?n.then(i,i):i()}}function E(e,t){var r=e.iterator[t.method];if(r===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=n,E(e,t),"throw"===t.method))return v;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var i=w(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,v;var s=i.arg;return s?s.done?(t[e.resultName]=s.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,v):s:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,v)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function R(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,s=function t(){for(;++r<e.length;)if(i.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=n,t.done=!0,t};return s.next=s}}return{next:O}}function O(){return{value:n,done:!0}}}(function(){return this}()||Function("return this")())},2070:function(e,t,n){n(1205),n(957),n(1003),n(2071),n(2074),n(2075),e.exports=n(795).Promise},2071:function(e,t,n){"use strict";var r,i,s,a,o=n(1204),u=n(824),c=n(901),l=n(1114),d=n(813),f=n(825),h=n(920),p=n(1116),v=n(978),y=n(1479),m=n(1480).set,g=n(2072)(),b=n(1233),k=n(1482),w=n(2073),x=n(1483),_="Promise",S=u.TypeError,C=u.process,T=C&&C.versions,E=T&&T.v8||"",I=u.Promise,M="process"==l(C),P=function(){},R=i=b.f,O=!!function(){try{var e=I.resolve(1),t=(e.constructor={})[n(834)("species")]=function(e){e(P,P)};return(M||"function"==typeof PromiseRejectionEvent)&&e.then(P)instanceof t&&0!==E.indexOf("6.6")&&-1===w.indexOf("Chrome/66")}catch(e){}}(),N=function(e){var t;return!(!f(e)||"function"!=typeof(t=e.then))&&t},U=function(e,t){if(!e._n){e._n=!0;var n=e._c;g((function(){for(var r=e._v,i=1==e._s,s=0,a=function(t){var n,s,a,o=i?t.ok:t.fail,u=t.resolve,c=t.reject,l=t.domain;try{o?(i||(2==e._h&&D(e),e._h=1),!0===o?n=r:(l&&l.enter(),n=o(r),l&&(l.exit(),a=!0)),n===t.promise?c(S("Promise-chain cycle")):(s=N(n))?s.call(n,u,c):u(n)):c(r)}catch(e){l&&!a&&l.exit(),c(e)}};n.length>s;)a(n[s++]);e._c=[],e._n=!1,t&&!e._h&&j(e)}))}},j=function(e){m.call(u,(function(){var t,n,r,i=e._v,s=A(e);if(s&&(t=k((function(){M?C.emit("unhandledRejection",i,e):(n=u.onunhandledrejection)?n({promise:e,reason:i}):(r=u.console)&&r.error&&r.error("Unhandled promise rejection",i)})),e._h=M||A(e)?2:1),e._a=void 0,s&&t.e)throw t.v}))},A=function(e){return 1!==e._h&&0===(e._a||e._c).length},D=function(e){m.call(u,(function(){var t;M?C.emit("rejectionHandled",e):(t=u.onrejectionhandled)&&t({promise:e,reason:e._v})}))},L=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),U(t,!0))},F=function e(t){var n,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===t)throw S("Promise can't be resolved itself");(n=N(t))?g((function(){var i={_w:r,_d:!1};try{n.call(t,c(e,i,1),c(L,i,1))}catch(e){L.call(i,e)}})):(r._v=t,r._s=1,U(r,!1))}catch(e){L.call({_w:r,_d:!1},e)}}};O||(I=function(e){p(this,I,_,"_h"),h(e),r.call(this);try{e(c(F,this,1),c(L,this,1))}catch(e){L.call(this,e)}},(r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=n(1115)(I.prototype,{then:function(e,t){var n=R(y(this,I));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=M?C.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&U(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),s=function(){var e=new r;this.promise=e,this.resolve=c(F,e,1),this.reject=c(L,e,1)},b.f=R=function(e){return e===I||e===a?new s(e):i(e)}),d(d.G+d.W+d.F*!O,{Promise:I}),n(1138)(I,_),n(1475)(_),a=n(795).Promise,d(d.S+d.F*!O,_,{reject:function(e){var t=R(this);return(0,t.reject)(e),t.promise}}),d(d.S+d.F*(o||!O),_,{resolve:function(e){return x(o&&this===a?I:this,e)}}),d(d.S+d.F*!(O&&n(1484)((function(e){I.all(e).catch(P)}))),_,{all:function(e){var t=this,n=R(t),r=n.resolve,i=n.reject,s=k((function(){var n=[],s=0,a=1;v(e,!1,(function(e){var o=s++,u=!1;n.push(void 0),a++,t.resolve(e).then((function(e){u||(u=!0,n[o]=e,--a||r(n))}),i)})),--a||r(n)}));return s.e&&i(s.v),n.promise},race:function(e){var t=this,n=R(t),r=n.reject,i=k((function(){v(e,!1,(function(e){t.resolve(e).then(n.resolve,r)}))}));return i.e&&r(i.v),n.promise}})},2072:function(e,t,n){var r=n(824),i=n(1480).set,s=r.MutationObserver||r.WebKitMutationObserver,a=r.process,o=r.Promise,u="process"==n(1107)(a);e.exports=function(){var e,t,n,c=function(){var r,i;for(u&&(r=a.domain)&&r.exit();e;){i=e.fn,e=e.next;try{i()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(u)n=function(){a.nextTick(c)};else if(!s||r.navigator&&r.navigator.standalone)if(o&&o.resolve){var l=o.resolve(void 0);n=function(){l.then(c)}}else n=function(){i.call(r,c)};else{var d=!0,f=document.createTextNode("");new s(c).observe(f,{characterData:!0}),n=function(){f.data=d=!d}}return function(r){var i={fn:r,next:void 0};t&&(t.next=i),e||(e=i,n()),t=i}}},2073:function(e,t,n){var r=n(824).navigator;e.exports=r&&r.userAgent||""},2074:function(e,t,n){"use strict";var r=n(813),i=n(795),s=n(824),a=n(1479),o=n(1483);r(r.P+r.R,"Promise",{finally:function(e){var t=a(this,i.Promise||s.Promise),n="function"==typeof e;return this.then(n?function(n){return o(t,e()).then((function(){return n}))}:e,n?function(n){return o(t,e()).then((function(){throw n}))}:e)}})},2075:function(e,t,n){"use strict";var r=n(813),i=n(1233),s=n(1482);r(r.S,"Promise",{try:function(e){var t=i.f(this),n=s(e);return(n.e?t.reject:t.resolve)(n.v),t.promise}})},2076:function(e,t,n){n(2077),e.exports=n(795).Reflect.metadata},2077:function(e,t,n){var r=n(2078),i=n(849),s=n(920),a=r.key,o=r.set;r.exp({metadata:function(e,t){return function(n,r){o(e,t,(void 0!==r?i:s)(n),a(r))}}})},2078:function(e,t,n){var r=n(1471),i=n(813),s=n(1286)("metadata"),a=s.store||(s.store=new(n(2079))),o=function(e,t,n){var i=a.get(e);if(!i){if(!n)return;a.set(e,i=new r)}var s=i.get(t);if(!s){if(!n)return;i.set(t,s=new r)}return s};e.exports={store:a,map:o,has:function(e,t,n){var r=o(t,n,!1);return void 0!==r&&r.has(e)},get:function(e,t,n){var r=o(t,n,!1);return void 0===r?void 0:r.get(e)},set:function(e,t,n,r){o(n,r,!0).set(e,t)},keys:function(e,t){var n=o(e,t,!1),r=[];return n&&n.forEach((function(e,t){r.push(t)})),r},key:function(e){return void 0===e||"symbol"==typeof e?e:String(e)},exp:function(e){i(i.S,"Reflect",e)}}},2079:function(e,t,n){"use strict";var r,i=n(824),s=n(1232)(0),a=n(1458),o=n(1086),u=n(1711),c=n(2080),l=n(825),d=n(979),f=n(979),h=!i.ActiveXObject&&"ActiveXObject"in i,p="WeakMap",v=o.getWeak,y=Object.isExtensible,m=c.ufstore,g=function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},b={get:function(e){if(l(e)){var t=v(e);return!0===t?m(d(this,p)).get(e):t?t[this._i]:void 0}},set:function(e,t){return c.def(d(this,p),e,t)}},k=e.exports=n(1231)(p,g,b,c,!0,!0);f&&h&&(u((r=c.getConstructor(g,p)).prototype,b),o.NEED=!0,s(["delete","has","get","set"],(function(e){var t=k.prototype,n=t[e];a(t,e,(function(t,i){if(l(t)&&!y(t)){this._f||(this._f=new r);var s=this._f[e](t,i);return"set"==e?this:s}return n.call(this,t,i)}))})))},2080:function(e,t,n){"use strict";var r=n(1115),i=n(1086).getWeak,s=n(849),a=n(825),o=n(1116),u=n(978),c=n(1232),l=n(1e3),d=n(979),f=c(5),h=c(6),p=0,v=function(e){return e._l||(e._l=new y)},y=function(){this.a=[]},m=function(e,t){return f(e.a,(function(e){return e[0]===t}))};y.prototype={get:function(e){var t=m(this,e);if(t)return t[1]},has:function(e){return!!m(this,e)},set:function(e,t){var n=m(this,e);n?n[1]=t:this.a.push([e,t])},delete:function(e){var t=h(this.a,(function(t){return t[0]===e}));return~t&&this.a.splice(t,1),!!~t}},e.exports={getConstructor:function(e,t,n,s){var c=e((function(e,r){o(e,c,t,"_i"),e._t=t,e._i=p++,e._l=void 0,null!=r&&u(r,n,e[s],e)}));return r(c.prototype,{delete:function(e){if(!a(e))return!1;var n=i(e);return!0===n?v(d(this,t)).delete(e):n&&l(n,this._i)&&delete n[this._i]},has:function(e){if(!a(e))return!1;var n=i(e);return!0===n?v(d(this,t)).has(e):n&&l(n,this._i)}}),c},def:function(e,t,n){var r=i(s(t),!0);return!0===r?v(e).set(t,n):r[e._i]=n,e},ufstore:v}},2081:function(e,t,n){n(2082);var r=n(795).Object;e.exports=function(e,t){return r.getOwnPropertyDescriptor(e,t)}},2082:function(e,t,n){var r=n(1056),i=n(1459).f;n(1418)("getOwnPropertyDescriptor",(function(){return function(e,t){return i(r(e),t)}}))},2083:function(e,t,n){n(957),n(2084),e.exports=n(795).Array.from},2084:function(e,t,n){"use strict";var r=n(901),i=n(813),s=n(1001),a=n(1473),o=n(1474),u=n(1203),c=n(2085),l=n(1229);i(i.S+i.F*!n(1484)((function(e){Array.from(e)})),"Array",{from:function(e){var t,n,i,d,f=s(e),h="function"==typeof this?this:Array,p=arguments.length,v=p>1?arguments[1]:void 0,y=void 0!==v,m=0,g=l(f);if(y&&(v=r(v,p>2?arguments[2]:void 0,2)),null==g||h==Array&&o(g))for(n=new h(t=u(f.length));t>m;m++)c(n,m,y?v(f[m],m):f[m]);else for(d=g.call(f),n=new h;!(i=d.next()).done;m++)c(n,m,y?a(d,v,[i.value,m],!0):i.value);return n.length=m,n}})},2085:function(e,t,n){"use strict";var r=n(885),i=n(1201);e.exports=function(e,t,n){t in e?r.f(e,t,i(0,n)):e[t]=n}},2086:function(e,t,n){"use strict";var r=s(n(787)),i=s(n(790));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Configuration=void 0;var a=function(){function e(t){(0,r.default)(this,e);var n=(t=t||{}).Chat||t.IPMessaging||t||{};this.region=n.region||t.region,this.baseUrl=n.apiUri||n.typingUri||(this.region&&"us1"!==this.region?"https://aim."+this.region+".twilio.com":"https://aim.twilio.com"),this.typingIndicatorUri=this.baseUrl+"/v1/typing",this.typingIndicatorTimeoutOverride=n.typingIndicatorTimeoutOverride,this.httpCacheIntervalOverride=n.httpCacheIntervalOverride,this.consumptionReportIntervalOverride=n.consumptionReportIntervalOverride,this.userInfosToSubscribeOverride=n.userInfosToSubscribeOverride,this.retryWhenThrottledOverride=n.retryWhenThrottledOverride,this.backoffConfigOverride=n.backoffConfigOverride,this.productId=t.productId}return(0,i.default)(e,[{key:"typingIndicatorTimeoutDefault",get:function(){return 5e3}},{key:"httpCacheIntervalDefault",get:function(){return"PT5S"}},{key:"consumptionReportIntervalDefault",get:function(){return"PT5S"}},{key:"userInfosToSubscribeDefault",get:function(){return 100}},{key:"retryWhenThrottledDefault",get:function(){return true}},{key:"backoffConfigDefault",get:function(){return{min:1e3,max:4e3,maxAttemptsCount:3}}}]),e}();t.Configuration=a},2087:function(e,t,n){var r=n(795),i=r.JSON||(r.JSON={stringify:JSON.stringify});e.exports=function(e){return i.stringify.apply(i,arguments)}},2088:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createTests=t.createPatch=t.applyPatch=void 0;var r=n(1486),i=n(2089),s=n(2090);function a(e,t){var n=r.Pointer.fromJSON(t).evaluate(e);if(void 0!==n)return{op:"test",path:t,value:n.value}}t.applyPatch=function(e,t){return t.map((function(t){return i.apply(e,t)}))},t.createPatch=function(e,t,n){var i=new r.Pointer;return(n?function(e){return function t(n,r,i){var a=e(n,r,i);return Array.isArray(a)?a:s.diffAny(n,r,i,t)}}(n):s.diffAny)(e,t,i)},t.createTests=function(e,t){var n=new Array;return t.filter(s.isDestructive).forEach((function(t){var r=a(e,t.path);if(r&&n.push(r),"from"in t){var i=a(e,t.from);i&&n.push(i)}})),n}},2089:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.apply=t.InvalidOperationError=t.test=t.copy=t.move=t.replace=t.remove=t.add=t.TestError=t.MissingError=void 0;var s=n(1486),a=n(1235),o=n(1487),u=function(e){function t(t){var n=e.call(this,"Value required at path: "+t)||this;return n.path=t,n.name="MissingError",n}return i(t,e),t}(Error);t.MissingError=u;var c=function(e){function t(t,n){var r=e.call(this,"Test failed: "+t+" != "+n)||this;return r.actual=t,r.expected=n,r.name="TestError",r}return i(t,e),t}(Error);function l(e,t,n){if(Array.isArray(e))if("-"==t)e.push(n);else{var r=parseInt(t,10);e.splice(r,0,n)}else e[t]=n}function d(e,t){if(Array.isArray(e)){var n=parseInt(t,10);e.splice(n,1)}else delete e[t]}function f(e,t){var n=s.Pointer.fromJSON(t.path).evaluate(e);return void 0===n.parent?new u(t.path):(l(n.parent,n.key,a.clone(t.value)),null)}function h(e,t){var n=s.Pointer.fromJSON(t.path).evaluate(e);return void 0===n.value?new u(t.path):(d(n.parent,n.key),null)}function p(e,t){var n=s.Pointer.fromJSON(t.path).evaluate(e);if(null===n.parent)return new u(t.path);if(Array.isArray(n.parent)){if(parseInt(n.key,10)>=n.parent.length)return new u(t.path)}else if(void 0===n.value)return new u(t.path);return n.parent[n.key]=t.value,null}function v(e,t){var n=s.Pointer.fromJSON(t.from).evaluate(e);if(void 0===n.value)return new u(t.from);var r=s.Pointer.fromJSON(t.path).evaluate(e);return void 0===r.parent?new u(t.path):(d(n.parent,n.key),l(r.parent,r.key,n.value),null)}function y(e,t){var n=s.Pointer.fromJSON(t.from).evaluate(e);if(void 0===n.value)return new u(t.from);var r=s.Pointer.fromJSON(t.path).evaluate(e);return void 0===r.parent?new u(t.path):(l(r.parent,r.key,a.clone(n.value)),null)}function m(e,t){var n=s.Pointer.fromJSON(t.path).evaluate(e);return o.compare(n.value,t.value)?null:new c(n.value,t.value)}t.TestError=c,t.add=f,t.remove=h,t.replace=p,t.move=v,t.copy=y,t.test=m;var g=function(e){function t(t){var n=e.call(this,"Invalid operation: "+t.op)||this;return n.operation=t,n.name="InvalidOperationError",n}return i(t,e),t}(Error);t.InvalidOperationError=g,t.apply=function(e,t){switch(t.op){case"add":return f(e,t);case"remove":return h(e,t);case"replace":return p(e,t);case"move":return v(e,t);case"copy":return y(e,t);case"test":return m(e,t)}return new g(t)}},2090:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.diffAny=t.diffObjects=t.diffArrays=t.intersection=t.subtract=t.isDestructive=void 0;var r=n(1487),i=n(1235);function s(e,t){var n={};for(var r in e)i.hasOwnProperty.call(e,r)&&void 0!==e[r]&&(n[r]=1);for(var s in t)i.hasOwnProperty.call(t,s)&&void 0!==t[s]&&delete n[s];return Object.keys(n)}function a(e){for(var t=e.length,n={},r=0;r<t;r++){var s=e[r];for(var a in s)i.hasOwnProperty.call(s,a)&&void 0!==s[a]&&(n[a]=(n[a]||0)+1)}for(var a in n)n[a]<t&&delete n[a];return Object.keys(n)}function o(e,t){return{operations:e.operations.concat(t),cost:e.cost+1}}function u(e,t,n,i){void 0===i&&(i=l);var s={"0,0":{operations:[],cost:0}};var a=isNaN(e.length)||e.length<=0?0:e.length,u=isNaN(t.length)||t.length<=0?0:t.length;return function n(i,a){var u=i+","+a,c=s[u];if(void 0===c){if(i>0&&a>0&&r.compare(e[i-1],t[a-1]))c=n(i-1,a-1);else{var l=[];if(i>0){var d=n(i-1,a),f={op:"remove",index:i-1};l.push(o(d,f))}if(a>0){var h=n(i,a-1),p={op:"add",index:i-1,value:t[a-1]};l.push(o(h,p))}if(i>0&&a>0){var v=n(i-1,a-1),y={op:"replace",index:i-1,original:e[i-1],value:t[a-1]};l.push(o(v,y))}c=l.sort((function(e,t){return e.cost-t.cost}))[0]}s[u]=c}return c}(a,u).operations.reduce((function(e,t){var r=e[0],s=e[1];if(function(e){return"add"===e.op}(t)){var o=t.index+1+s,u=o<a+s?String(o):"-",c={op:t.op,path:n.add(u).toString(),value:t.value};return[r.concat(c),s+1]}if(function(e){return"remove"===e.op}(t)){c={op:t.op,path:n.add(String(t.index+s)).toString()};return[r.concat(c),s-1]}var l=n.add(String(t.index+s)),d=i(t.original,t.value,l);return[r.concat.apply(r,d),s]}),[[],0])[0]}function c(e,t,n,r){void 0===r&&(r=l);var i=[];return s(e,t).forEach((function(e){i.push({op:"remove",path:n.add(e).toString()})})),s(t,e).forEach((function(e){i.push({op:"add",path:n.add(e).toString(),value:t[e]})})),a([e,t]).forEach((function(s){i.push.apply(i,r(e[s],t[s],n.add(s)))})),i}function l(e,t,n,r){if(void 0===r&&(r=l),e===t)return[];var s=i.objectType(e),a=i.objectType(t);return"array"==s&&"array"==a?u(e,t,n,r):"object"==s&&"object"==a?c(e,t,n,r):[{op:"replace",path:n.toString(),value:t}]}t.isDestructive=function(e){var t=e.op;return"remove"===t||"replace"===t||"copy"===t||"move"===t},t.subtract=s,t.intersection=a,t.diffArrays=u,t.diffObjects=c,t.diffAny=l},2091:function(e,t,n){n(2092),e.exports=n(795).Number.isInteger},2092:function(e,t,n){var r=n(813);r(r.S,"Number",{isInteger:n(2093)})},2093:function(e,t,n){var r=n(825),i=Math.floor;e.exports=function(e){return!r(e)&&isFinite(e)&&i(e)===e}},2094:function(e,t,n){"use strict";var r=o(n(814)),i=o(n(815)),s=o(n(787)),a=o(n(790));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.PublicChannels=void 0;var u=n(839),c=n(1117),l=n(1488),d=function(){function e(t,n,r){(0,s.default)(this,e),this.client=t,this.services=n,this.url=r}var t,n,o;return(0,a.default)(e,[{key:"getChannels",value:(o=(0,i.default)(r.default.mark((function e(){var t,n,i=this,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new u.UriBuilder(this.url).arg("PageToken",s.pageToken).build(),e.next=3,this.services.network.get(t);case 3:return n=e.sent,e.abrupt("return",new c.RestPaginator(n.body.channels.map((function(e){return new l.ChannelDescriptor(i.client,e)})),(function(e){return i.getChannels({pageToken:e})}),n.body.meta.previous_token,n.body.meta.next_token));case 5:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"getChannelBySid",value:(n=(0,i.default)(r.default.mark((function e(t){var n,i;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new u.UriBuilder(this.url).path(t).build(),e.next=3,this.services.network.get(n);case 3:return i=e.sent,e.abrupt("return",new l.ChannelDescriptor(this.client,i.body));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getChannelByUniqueName",value:(t=(0,i.default)(r.default.mark((function e(t){var n,i;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new u.UriBuilder(this.url).path(t).build(),e.next=3,this.services.network.get(n);case 3:return i=e.sent,e.abrupt("return",new l.ChannelDescriptor(this.client,i.body));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();t.PublicChannels=d},2095:function(e,t,n){"use strict";var r=f(n(814)),i=f(n(815)),s=f(n(816)),a=f(n(1113)),o=f(n(1230)),u=f(n(1415)),c=f(n(877)),l=f(n(787)),d=f(n(790));function f(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Network=void 0;var h=n(980),p=function(){function e(t,n){var r=this;(0,l.default)(this,e),this.config=t,this.services=n,this.cache=new c.default,this.cacheLifetime=0,this.services.session.getHttpCacheInterval().then((function(e){r.cacheLifetime=1e3*e,r.cleanupCache()}))}var t;return(0,d.default)(e,[{key:"backoffConfig",value:function(){return(0,u.default)(this.config.backoffConfigDefault,this.config.backoffConfigOverride)}},{key:"retryWhenThrottled",value:function(){return void 0!==this.config.retryWhenThrottledOverride?this.config.retryWhenThrottledOverride:void 0!==this.config.retryWhenThrottledDefault&&this.config.retryWhenThrottledDefault}},{key:"isExpired",value:function(e){return!this.cacheLifetime||Date.now()-e>this.cacheLifetime}},{key:"cleanupCache",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=(0,a.default)(this.cache);!(e=(r=i.next()).done);e=!0){var s=r.value,u=(0,o.default)(s,2),c=u[0],l=u[1];this.isExpired(l.timestamp)&&this.cache.delete(c)}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}0===this.cache.size&&clearInterval(this.timer)}},{key:"pokeTimer",value:function(){var e=this;this.timer=this.timer||setInterval((function(){return e.cleanupCache()}),2*this.cacheLifetime)}},{key:"executeWithRetry",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new s.default((function(r,i){var s=[502,503,504];n&&s.push(429);var a=new h.Retrier(t.backoffConfig());a.on("attempt",(function(){e().then((function(e){return a.succeeded(e)})).catch((function(e){s.indexOf(e.status)>-1||"Twilsock disconnected"===e.message?a.failed(e):(a.removeAllListeners(),a.cancel(),i(e))}))})),a.on("succeeded",(function(e){r(e)})),a.on("cancelled",(function(e){return i(e)})),a.on("failed",(function(e){return i(e)})),a.start()}))}},{key:"get",value:(t=(0,i.default)(r.default.mark((function e(t){var n,i,s,a=this;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this.cache.get(t))||this.isExpired(n.timestamp)){e.next=3;break}return e.abrupt("return",n.response);case 3:return i={},e.next=6,this.executeWithRetry((function(){return a.services.transport.get(t,i,a.config.productId)}),this.retryWhenThrottled());case 6:return s=e.sent,this.cache.set(t,{response:s,timestamp:Date.now()}),this.pokeTimer(),e.abrupt("return",s);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();t.Network=p},2096:function(e,t,n){"use strict";var r=n(474),i=n(475),s=n(783),a=n(781),o=n(784);Object.defineProperty(t,"__esModule",{value:!0});var u=function(e){function t(e){var n;return r(this,t),(n=s(this,a(t).call(this))).minDelay=e.min,n.maxDelay=e.max,n.initialDelay=e.initial||0,n.maxAttemptsCount=e.maxAttemptsCount||0,n.maxAttemptsTime=e.maxAttemptsTime||0,n.randomness=e.randomness||0,n.inProgress=!1,n.attemptNum=0,n.prevDelay=0,n.currDelay=0,n}return o(t,e),i(t,[{key:"attempt",value:function(){clearTimeout(this.timeout),this.attemptNum++,this.timeout=null,this.emit("attempt",this)}},{key:"nextDelay",value:function(e){if("number"==typeof e)return this.prevDelay=0,this.currDelay=e,e;if(0==this.attemptNum)return this.initialDelay;if(1==this.attemptNum)return this.currDelay=this.minDelay,this.currDelay;this.prevDelay=this.currDelay;var t=this.currDelay+this.prevDelay;return this.maxDelay&&t>this.maxDelay&&(this.currDelay=this.maxDelay,t=this.maxDelay),this.currDelay=t,t}},{key:"randomize",value:function(e){var t=e*this.randomness,n=Math.round(Math.random()*t*2-t);return Math.max(0,e+n)}},{key:"scheduleAttempt",value:function(e){var t=this;if(this.maxAttemptsCount&&this.attemptNum>=this.maxAttemptsCount)return this.cleanup(),this.emit("failed",new Error("Maximum attempt count limit reached")),void this.reject(new Error("Maximum attempt count reached"));var n=this.nextDelay(e);if(n=this.randomize(n),this.maxAttemptsTime&&this.startTimestamp+this.maxAttemptsTime<Date.now()+n)return this.cleanup(),this.emit("failed",new Error("Maximum attempt time limit reached")),void this.reject(new Error("Maximum attempt time limit reached"));this.timeout=setTimeout((function(){return t.attempt()}),n)}},{key:"cleanup",value:function(){clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.attemptNum=0,this.prevDelay=0,this.currDelay=0}},{key:"start",value:function(){var e=this;if(this.inProgress)throw new Error("Retrier is already in progress");return this.inProgress=!0,new Promise((function(t,n){e.resolve=t,e.reject=n,e.startTimestamp=Date.now(),e.scheduleAttempt(e.initialDelay)}))}},{key:"cancel",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.emit("cancelled"),this.reject(new Error("Cancelled")))}},{key:"succeeded",value:function(e){this.emit("succeeded",e),this.resolve(e)}},{key:"failed",value:function(e,t){if(this.timeout)throw new Error("Retrier attempt is already in progress");this.scheduleAttempt(t)}},{key:"run",value:function(e){var t=this;return this.on("attempt",(function(){e().then((function(e){return t.succeeded(e)})).catch((function(e){return t.failed(e)}))})),this.start()}}]),t}(n(324).EventEmitter);t.Retrier=u,t.default=u},2097:function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(t){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?e.exports=r=function(e){return n(e)}:e.exports=r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},r(t)}e.exports=r},2098:function(e,t,n){"use strict";var r=n(474),i=n(475),s=n(783),a=n(781),o=n(784);function u(e){return null!=e}Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(e){var n;if(r(this,t),n=s(this,a(t).call(this)),u((e=e||{}).initialDelay)&&e.initialDelay<1)throw new Error("The initial timeout must be equal to or greater than 1.");if(u(e.maxDelay)&&e.maxDelay<=1)throw new Error("The maximal timeout must be greater than 1.");if(u(e.randomisationFactor)&&(e.randomisationFactor<0||e.randomisationFactor>1))throw new Error("The randomisation factor must be between 0 and 1.");if(u(e.factor)&&e.factor<=1)throw new Error("Exponential factor should be greater than 1.");if(n.initialDelay=e.initialDelay||100,n.maxDelay=e.maxDelay||1e4,n.maxDelay<=n.initialDelay)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");return n.randomisationFactor=e.randomisationFactor||0,n.factor=e.factor||2,n.maxNumberOfRetry=-1,n.reset(),n}return o(t,e),i(t,[{key:"backoff",value:function(e){null==this.timeoutID&&(this.backoffNumber===this.maxNumberOfRetry?(this.emit("fail",e),this.reset()):(this.backoffDelay=this.next(),this.timeoutID=setTimeout(this.onBackoff.bind(this),this.backoffDelay),this.emit("backoff",this.backoffNumber,this.backoffDelay,e)))}},{key:"reset",value:function(){this.backoffDelay=0,this.nextBackoffDelay=this.initialDelay,this.backoffNumber=0,clearTimeout(this.timeoutID),this.timeoutID=null}},{key:"failAfter",value:function(e){if(e<=0)throw new Error("Expected a maximum number of retry greater than 0 but got ".concat(e));this.maxNumberOfRetry=e}},{key:"next",value:function(){this.backoffDelay=Math.min(this.nextBackoffDelay,this.maxDelay),this.nextBackoffDelay=this.backoffDelay*this.factor;var e=1+Math.random()*this.randomisationFactor;return Math.min(this.maxDelay,Math.round(this.backoffDelay*e))}},{key:"onBackoff",value:function(){this.timeoutID=null,this.emit("ready",this.backoffNumber,this.backoffDelay),this.backoffNumber++}}],[{key:"exponential",value:function(e){return new t(e)}}]),t}(n(324).EventEmitter);t.Backoff=c,t.default=c},2099:function(e,t,n){"use strict";var r=o(n(814)),i=o(n(815)),s=o(n(787)),a=o(n(790));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.SyncList=void 0;var u=n(839),c=n(1117),l=n(2100),d=function(){function e(t){(0,s.default)(this,e),this.services=t}var t;return(0,a.default)(e,[{key:"getPage",value:(t=(0,i.default)(r.default.mark((function e(t){var n,i,s,a=this;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},e.next=3,this.services.session.getSessionLinks();case 3:return n=e.sent,i=new u.UriBuilder(n.syncListUrl).arg("PageToken",t.pageToken).build(),e.next=7,this.services.network.get(i);case 7:return s=e.sent,e.abrupt("return",new c.RestPaginator(s.body.channels.map((function(e){return new l.SyncListDescriptor(e)})),(function(e){return a.getPage({pageToken:e})}),s.body.meta.previous_token,s.body.meta.next_token));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();t.SyncList=d},2100:function(e,t,n){"use strict";var r,i=n(787),s=(r=i)&&r.__esModule?r:{default:r};Object.defineProperty(t,"__esModule",{value:!0}),t.SyncListDescriptor=void 0;t.SyncListDescriptor=function e(t){(0,s.default)(this,e),this.descriptor=t,this.channel_sid=t.channel_sid,this.status=t.status,this.channel=t.channel,this.messages=t.messages,this.roster=t.roster,this.lastConsumedMessageIndex=t.last_consumed_message_index,this.notificationLevel=t.notification_level,this.status=t.status}},2101:function(e,t,n){"use strict";var r=n(3),i=n(800),s=n(475),a=n(783),o=n(981),u=n(781),c=n(784),l=n(474);Object.defineProperty(t,"__esModule",{value:!0});var d=n(324),f=n(904),h=n(2103),p=n(2104),v=n(2117),y=n(2119),m=n(2121),g=n(2122),b=n(2124),k=n(878),w=n(2125),x=n(2126),_=n(2127),S=function e(){l(this,e)};t.TelemetryEvents=S,S.TWILSOCK_CONNECT="twilsock.sdk.connect",S.TWILSOCK_INIT="twilsock.sdk.init";var C=function(e){function t(e,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};l(this,t),(r=a(this,u(t).call(this))).offlineStorageDeferred=new b.Deferred,i.continuationToken=i.continuationToken?i.continuationToken:x.TokenStorage.getStoredToken(n);var s=r.config=new h.Configuration(e,n,i);f.log.setLevel(s.logLevel);var o=new y.WebSocketChannel(s.url),c=i.transport?i.transport:new v.PacketInterface(o,s);return r.channel=i.channel?i.channel:new p.TwilsockImpl(o,c,s),r.registrations=i.registrations?i.registrations:new m.Registrations(c),r.upstream=new g.Upstream(c,r.channel,s),r.telemetryTracker=new _.TelemetryTracker(s,c),r.channel.on("initialized",(function(){return r.telemetryTracker.canSendTelemetry=!0})),o.on("disconnected",(function(){return r.telemetryTracker.canSendTelemetry=!1})),r.registrations.on("registered",(function(e){return r.emit("registered",e)})),r.channel.on("message",(function(e,t){return setTimeout((function(){return r.emit("message",e,t)}),0)})),r.channel.on("stateChanged",(function(e){return setTimeout((function(){return r.emit("stateChanged",e)}),0)})),r.channel.on("connectionError",(function(e){return setTimeout((function(){return r.emit("connectionError",e)}),0)})),r.channel.on("tokenAboutToExpire",(function(){return setTimeout((function(){return r.emit("tokenAboutToExpire")}),0)})),r.channel.on("tokenExpired",(function(){return setTimeout((function(){return r.emit("tokenExpired")}),0)})),r.channel.on("connected",(function(){return r.registrations.updateRegistrations()})),r.channel.on("connected",(function(){return r.upstream.sendPendingMessages()})),r.channel.on("connected",(function(){return setTimeout((function(){return r.emit("connected")}),0)})),r.channel.on("beforeConnect",(function(){return r.telemetryTracker.addPartialEvent(new _.TelemetryEventDescription("Establish WebSocket connection","",new Date),S.TWILSOCK_CONNECT,_.TelemetryPoint.Start)})),r.channel.on("connected",(function(){return r.telemetryTracker.addPartialEvent(new _.TelemetryEventDescription("Establish WebSocket connection","",new Date,new Date),S.TWILSOCK_CONNECT,_.TelemetryPoint.End)})),r.channel.on("beforeSendInit",(function(){return r.telemetryTracker.addPartialEvent(new _.TelemetryEventDescription("Send Twilsock init","",new Date),S.TWILSOCK_INIT,_.TelemetryPoint.Start)})),r.channel.on("initialized",(function(){return r.telemetryTracker.addPartialEvent(new _.TelemetryEventDescription("Send Twilsock init","Succeeded",new Date,new Date),S.TWILSOCK_INIT,_.TelemetryPoint.End)})),r.channel.on("sendInitFailed",(function(){return r.telemetryTracker.addPartialEvent(new _.TelemetryEventDescription("Send Twilsock init","Failed",new Date,new Date),S.TWILSOCK_INIT,_.TelemetryPoint.End)})),r.channel.on("initialized",(function(e){r.handleStorageId(n,e),x.TokenStorage.storeToken(e.continuationToken,n),setTimeout((function(){return r.emit("initialized",e)}),0)})),r.channel.on("disconnected",(function(){return setTimeout((function(){return r.emit("disconnected")}),0)})),r.channel.on("disconnected",(function(){return r.upstream.rejectPendingMessages()})),r.channel.on("disconnected",(function(){return r.offlineStorageDeferred.fail(new k.TwilsockError("Client disconnected"))})),r.offlineStorageDeferred.promise.catch((function(){})),r}var n;return c(t,e),s(t,[{key:"emit",value:function(e){for(var n,r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];return f.log.debug("Emitting ".concat(e.toString(),"(").concat(i.map((function(e){return JSON.stringify(e)})).join(", "),")")),(n=o(u(t.prototype),"emit",this)).call.apply(n,[this,e].concat(i))}},{key:"handleStorageId",value:function(e,t){if(t.offlineStorage)if(t.offlineStorage.hasOwnProperty(e))try{this.offlineStorageDeferred.set(w.OfflineProductStorage.create(t.offlineStorage[e])),f.log.debug("Offline storage for '".concat(e,"' product: ").concat(JSON.stringify(t.offlineStorage[e]),"."))}catch(n){this.offlineStorageDeferred.fail(new k.TwilsockError("Failed to parse offline storage for ".concat(e," ").concat(JSON.stringify(t.offlineStorage[e]),". ").concat(n,".")))}else this.offlineStorageDeferred.fail(new k.TwilsockError("No offline storage id for '".concat(e,"' product: ").concat(JSON.stringify(t.offlineStorage))));else this.offlineStorageDeferred.fail(new k.TwilsockError("No offline storage id"))}},{key:"storageId",value:function(){return this.offlineStorageDeferred.promise}},{key:"updateToken",value:(n=i(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f.log.trace("updating token '".concat(t,"'")),this.config.token!==t){e.next=3;break}return e.abrupt("return");case 3:return this.config.updateToken(t),e.abrupt("return",this.channel.updateToken(t));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"setNotificationsContext",value:function(e,t){this.registrations.setNotificationsContext(e,t)}},{key:"removeNotificationsContext",value:function(e){this.registrations.removeNotificationsContext(e)}},{key:"connect",value:function(){return this.channel.connect()}},{key:"disconnect",value:function(){return this.telemetryTracker.sendTelemetry(_.EventSendingLimitation.AnyEventsIncludingUnfinished),this.channel.disconnect()}},{key:"get",value:function(e,t,n){return this.telemetryTracker.sendTelemetry(_.EventSendingLimitation.AnyEvents),this.upstream.send("GET",e,t,void 0,n)}},{key:"post",value:function(e,t,n,r){return this.telemetryTracker.sendTelemetry(_.EventSendingLimitation.AnyEvents),this.upstream.send("POST",e,t,n,r)}},{key:"put",value:function(e,t,n,r){return this.telemetryTracker.sendTelemetry(_.EventSendingLimitation.AnyEvents),this.upstream.send("PUT",e,t,n,r)}},{key:"delete",value:function(e,t,n){return this.telemetryTracker.sendTelemetry(_.EventSendingLimitation.AnyEvents),this.upstream.send("DELETE",e,t,void 0,n)}},{key:"addTelemetryEvent",value:function(e){this.telemetryTracker.addTelemetryEvent(e),this.telemetryTracker.sendTelemetryIfMinimalPortionCollected()}},{key:"addPartialTelemetryEvent",value:function(e,t,n){this.telemetryTracker.addPartialEvent(e,t,n),n===_.TelemetryPoint.End&&this.telemetryTracker.sendTelemetryIfMinimalPortionCollected()}},{key:"isConnected",get:function(){return this.channel.isConnected}},{key:"state",get:function(){return this.channel.state}}]),t}(d.EventEmitter);t.TwilsockClient=C,t.Twilsock=C},2102:function(e,t,n){var r=n(781);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=r(e)););return e}},2103:function(e,t,n){"use strict";var r=n(474),i=n(475);Object.defineProperty(t,"__esModule",{value:!0});var s="0.6.2",a=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r(this,e),this.confirmedCapabilities=new Set,this.activeGrant=n,this._token=t;var a=i.region||"us1",o="wss://tsock.".concat(a,".twilio.com/v3/wsconnect"),u=i.twilsock||i.Twilsock||{};this.url=u.uri||o,this._continuationToken=i.continuationToken?i.continuationToken:null,this.logLevel=i.logLevel?i.logLevel:"error",this.retryPolicy=i.retryPolicy?i.retryPolicy:{min:1e3,max:12e4,randomness:.2},this.clientMetadata=i.clientMetadata?i.clientMetadata:{},this.clientMetadata.ver=s,this.initRegistrations=i.initRegistrations?i.initRegistrations:null,this.tweaks=i.tweaks?i.tweaks:null}return i(e,[{key:"updateToken",value:function(e){this._token=e}},{key:"updateContinuationToken",value:function(e){this._continuationToken=e}},{key:"token",get:function(){return this._token}},{key:"continuationToken",get:function(){return this._continuationToken}}]),e}();t.Configuration=a},2104:function(e,t,n){"use strict";var r=n(3),i=n(800),s=n(475),a=n(783),o=n(781),u=n(784),c=n(474);Object.defineProperty(t,"__esModule",{value:!0});var l=n(324),d=n(2105),f=n(904),h=n(1238),p=n(1493),v=n(1494),y=n(2116);t.Response=function e(){c(this,e)};var m=function(e){function t(e,n,r){var i;return c(this,t),(i=a(this,o(t).call(this))).terminalStates=["disconnected","rejected"],i.lastEmittedState=void 0,i.tokenExpiredSasCode=20104,i.terminationReason="Connection is not initialized",i.websocket=e,i.websocket.on("connected",(function(){return i.fsm.socketConnected()})),i.websocket.on("disconnected",(function(e){return i.fsm.socketClosed()})),i.websocket.on("message",(function(e){return i.onIncomingMessage(e)})),i.websocket.on("socketError",(function(e){return i.emit("connectionError",{terminal:!1,message:"Socket error: ".concat(e.message),httpStatusCode:null,errorCode:null})})),i.transport=n,i.config=r,i.retrier=new y.BackoffRetrier(r.retryPolicy),i.retrier.on("attempt",(function(){return i.retry()})),i.retrier.on("failed",(function(e){f.log.warn("Retrying failed: ".concat(e.message)),i.disconnect()})),"undefined"!=typeof window&&void 0!==window.addEventListener&&(window.addEventListener("online",(function(){f.log.debug("Browser reported connectivity state: online"),i.resetBackoff(),i.fsm.systemOnline()})),window.addEventListener("offline",(function(){f.log.debug("Browser reported connectivity state: offline"),i.websocket.close(),i.fsm.socketClosed()}))),i.fsm=new d({init:"disconnected",transitions:[{name:"userConnect",from:["disconnected","rejected"],to:"connecting"},{name:"userConnect",from:["connecting","connected"]},{name:"userDisconnect",from:["connecting","initialising","connected","updating","retrying","rejected","waitSocketClosed","waitOffloadSocketClosed"],to:"disconnecting"},{name:"userRetry",from:["retrying"],to:"connecting"},{name:"socketConnected",from:["connecting"],to:"initialising"},{name:"socketClosed",from:["connecting","initialising","connected","updating","error","waitOffloadSocketClosed"],to:"retrying"},{name:"socketClosed",from:["disconnecting"],to:"disconnected"},{name:"socketClosed",from:["waitSocketClosed"],to:"disconnected"},{name:"socketClosed",from:["rejected"],to:"rejected"},{name:"initSuccess",from:["initialising"],to:"connected"},{name:"initError",from:["initialising"],to:"error"},{name:"tokenRejected",from:["initialising","updating"],to:"rejected"},{name:"protocolError",from:["initialising","connected","updating"],to:"error"},{name:"receiveClose",from:["initialising","connected","updating"],to:"waitSocketClosed"},{name:"receiveOffload",from:["initialising","connected","updating"],to:"waitOffloadSocketClosed"},{name:"unsupportedProtocol",from:["initialising","connected","updating"],to:"unsupported"},{name:"receiveFatalClose",from:["initialising","connected","updating"],to:"unsupported"},{name:"userUpdateToken",from:["disconnected","rejected","connecting","retrying"],to:"connecting"},{name:"userUpdateToken",from:["connected"],to:"updating"},{name:"updateSuccess",from:["updating"],to:"connected"},{name:"updateError",from:["updating"],to:"error"},{name:"userSend",from:["connected"],to:"connected"},{name:"systemOnline",from:["retrying"],to:"connecting"}],methods:{onConnecting:function(){i.setupSocket(),i.emit("connecting")},onEnterInitialising:function(){i.sendInit()},onLeaveInitialising:function(){i.cancelInit()},onEnterUpdating:function(){i.sendUpdate()},onLeaveUpdating:function(){i.cancelUpdate()},onEnterRetrying:function(){i.initRetry(),i.emit("connecting")},onEnterConnected:function(){i.resetBackoff(),i.onConnected()},onUserUpdateToken:function(){i.resetBackoff()},onTokenRejected:function(){i.resetBackoff(),i.closeSocket(!0),i.finalizeSocket()},onUserDisconnect:function(){i.closeSocket(!0)},onEnterDisconnecting:function(){i.startDisconnectTimer()},onLeaveDisconnecting:function(){i.cancelDisconnectTimer()},onEnterWaitSocketClosed:function(){i.startDisconnectTimer()},onLeaveWaitSocketClosed:function(){i.cancelDisconnectTimer()},onEnterWaitOffloadSocketClosed:function(){i.startDisconnectTimer()},onLeaveWaitOffloadSocketClosed:function(){i.cancelDisconnectTimer()},onDisconnected:function(){i.resetBackoff(),i.finalizeSocket()},onReceiveClose:function(e,t){i.onCloseReceived(t)},onReceiveOffload:function(e,t){f.log.debug("onreceiveoffload: ",t),i.modifyBackoff(t.body),i.onCloseReceived(t.status)},onUnsupported:function(){i.closeSocket(!0),i.finalizeSocket()},onError:function(e,t){i.closeSocket(t),i.finalizeSocket()},onEnterState:function(e){"none"!==e.from&&i.changeState(e)},onInvalidTransition:function(e,t,n){f.log.warn("FSM: unexpected transition",t,n)}}}),i}var n,l;return u(t,e),s(t,[{key:"changeState",value:function(e){f.log.debug("FSM: ".concat(e.transition,": ").concat(e.from," --\x3e ").concat(e.to)),this.lastEmittedState!==this.state&&(this.lastEmittedState=this.state,this.emit("stateChanged",this.state))}},{key:"resetBackoff",value:function(){f.log.trace("resetBackoff"),this.retrier.stop()}},{key:"modifyBackoff",value:function(e){f.log.trace("modifyBackoff",e);var t=e?e.backoff_policy:null;t&&"number"==typeof t.reconnect_min_ms&&this.retrier.modifyBackoff(t.reconnect_min_ms)}},{key:"startDisconnectTimer",value:function(){var e=this;f.log.trace("startDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null),this.disconnectingTimer=setTimeout((function(){f.log.debug("disconnecting is timed out"),e.closeSocket(!0)}),3e3)}},{key:"cancelDisconnectTimer",value:function(){f.log.trace("cancelDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null)}},{key:"initRetry",value:function(){f.log.debug("initRetry"),this.retrier.inProgress?this.retrier.attemptFailed():this.retrier.start()}},{key:"retry",value:function(){"connecting"!=this.fsm.state?(f.log.trace("retry"),this.websocket.close(),this.fsm.userRetry()):f.log.trace("can\t retry as already connecting")}},{key:"onConnected",value:function(){this.emit("connected")}},{key:"finalizeSocket",value:function(){f.log.trace("finalizeSocket"),this.websocket.close(),this.emit("disconnected"),this.disconnectedPromiseResolve&&(this.disconnectedPromiseResolve(),this.disconnectedPromiseResolve=null)}},{key:"setupSocket",value:function(){f.log.trace("setupSocket:",this.config.token),this.emit("beforeConnect"),this.websocket.connect()}},{key:"onIncomingMessage",value:function(e){var t=p.Parser.parse(e),n=t.method,r=t.header,i=t.payload;if("reply"!==n&&this.confirmReceiving(r),"notification"===n)this.emit("message",r.message_type,i);else if("reply"===r.method)this.transport.processReply({id:r.id,status:r.status,header:r,body:i});else if("client_update"===r.method)"token_about_to_expire"===r.client_update_type&&this.emit("tokenAboutToExpire");else if("close"===r.method)if(308===r.status.code)f.log.debug("Connection has been offloaded"),this.fsm.receiveOffload({status:r.status.status,body:i});else if(406===r.status.code){var s="Server closed connection because can't parse protocol: ".concat(JSON.stringify(r.status));this.emitReplyConnectionError(s,r,!0),f.log.error(s),this.fsm.receiveFatalClose()}else 417===r.status.code?(f.log.error("Server closed connection because can't parse client reply: ".concat(JSON.stringify(r.status))),this.fsm.receiveFatalClose(r.status.status)):410===r.status.code?(f.log.warn("Server closed connection: ".concat(JSON.stringify(r.status))),this.fsm.receiveClose(r.status.status),this.emit("tokenExpired")):401===r.status.code?(f.log.error("Server closed connection: ".concat(JSON.stringify(r.status))),this.fsm.receiveClose(r.status.status)):(f.log.warn("unexpected message: ",r.status),this.fsm.receiveOffload({status:r.status.status,body:null}))}},{key:"sendInit",value:(l=i(r.mark((function e(){var t,n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f.log.trace("sendInit"),e.prev=1,this.emit("beforeSendInit"),e.next=5,this.transport.sendInit();case 5:t=e.sent,this.config.updateContinuationToken(t.continuationToken),this.config.confirmedCapabilities=t.confirmedCapabilities,this.fsm.initSuccess(t),this.emit("initialized",t),this.emit("tokenUpdated"),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),e.t0 instanceof v.TwilsockReplyError?(n=!1,f.log.warn("Init rejected by server: ".concat(JSON.stringify(e.t0.reply.status))),this.emit("sendInitFailed"),401===e.t0.reply.status.code||403===e.t0.reply.status.code?(n=!0,this.fsm.tokenRejected(e.t0.reply.status),e.t0.reply.status.errorCode===this.tokenExpiredSasCode&&this.emit("tokenExpired")):429===e.t0.reply.status.code?(this.modifyBackoff(e.t0.reply.body),this.fsm.initError(!0)):500===e.t0.reply.status.code?this.fsm.initError(!1):this.fsm.initError(!0),this.emitReplyConnectionError(e.t0.message,e.t0.reply,n)):(this.terminationReason=e.t0.message,this.emit("connectionError",{terminal:!0,message:"Unknown error during connection initialisation: ".concat(e.t0.message,"\n").concat(JSON.stringify(e.t0,null,2)),httpStatusCode:null,errorCode:null}),this.fsm.initError(!0)),this.emit("tokenUpdated",e.t0);case 17:case"end":return e.stop()}}),e,this,[[1,13]])}))),function(){return l.apply(this,arguments)})},{key:"sendUpdate",value:(n=i(r.mark((function e(){var t,n,i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f.log.trace("sendUpdate"),t=new h.Update(this.config.token),e.prev=2,e.next=5,this.transport.sendWithReply(t);case 5:n=e.sent,this.fsm.updateSuccess(n.body),this.emit("tokenUpdated"),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(2),e.t0 instanceof v.TwilsockReplyError?(i=!1,f.log.warn("Token update rejected by server: ".concat(JSON.stringify(e.t0.reply.status))),401===e.t0.reply.status.code||403===e.t0.reply.status.code?(i=!0,this.fsm.tokenRejected(e.t0.reply.status),e.t0.reply.status.errorCode===this.tokenExpiredSasCode&&this.emit("tokenExpired")):429===e.t0.reply.status.code?(this.modifyBackoff(e.t0.reply.body),this.fsm.updateError(e.t0.reply.status)):this.fsm.updateError(e.t0.reply.status),this.emitReplyConnectionError(e.t0.message,e.t0.reply,i)):(this.emit("error",!1,e.t0.message,null,null),this.fsm.updateError(e.t0)),this.emit("tokenUpdated",e.t0);case 14:case"end":return e.stop()}}),e,this,[[2,10]])}))),function(){return n.apply(this,arguments)})},{key:"emitReplyConnectionError",value:function(e,t,n){var r=t.status&&t.status.description?t.status.description:e,i=t.status.code,s=t.status&&t.status.errorCode?t.status.errorCode:null;n&&(this.terminationReason=r),this.emit("connectionError",{terminal:n,message:"Connection error: ".concat(r),httpStatusCode:i,errorCode:s})}},{key:"cancelInit",value:function(){f.log.trace("cancelInit")}},{key:"cancelUpdate",value:function(){f.log.trace("cancelUpdate")}},{key:"confirmReceiving",value:function(e){f.log.trace("confirmReceiving");try{this.transport.send(new h.Reply(e.id))}catch(e){f.log.debug("failed to confirm packet receiving",e)}}},{key:"closeSocket",value:function(e){var t=this;f.log.trace("closeSocket (graceful: ".concat(e,")")),e&&this.transport.isConnected&&this.transport.sendClose(),this.websocket.close(),setTimeout((function(){return t.fsm.socketClosed()}),0)}},{key:"connect",value:function(){f.log.trace("connect"),this.fsm.userConnect()}},{key:"disconnect",value:function(){var e=this;return f.log.trace("disconnect"),this.fsm.is("disconnected")?Promise.resolve():new Promise((function(t){e.disconnectedPromiseResolve=t,e.fsm.userDisconnect()}))}},{key:"updateToken",value:function(e){var t=this;return f.log.trace("updateToken:",e),new Promise((function(e,n){t.once("tokenUpdated",(function(t){t?n(t):e()})),t.fsm.userUpdateToken()}))}},{key:"onCloseReceived",value:function(e){this.websocket.close()}},{key:"isConnected",get:function(){return"connected"===this.state&&this.websocket.isConnected}},{key:"state",get:function(){switch(this.fsm.state){case"connecting":case"initialising":case"retrying":case"error":return"connecting";case"updating":case"connected":return"connected";case"rejected":return"rejected";case"disconnecting":case"waitSocketClosed":case"waitOffloadSocketClosed":return"disconnecting";case"disconnected":default:return"disconnected"}}},{key:"isTerminalState",get:function(){return-1!==this.terminalStates.indexOf(this.fsm.state)}},{key:"getTerminationReason",get:function(){return this.terminationReason}}]),t}(l.EventEmitter);t.TwilsockChannel=m,t.TwilsockImpl=m},2105:function(e,t,n){var r;r=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){"use strict";e.exports=function(e,t){var n,r,i;for(n=1;n<arguments.length;n++)for(i in r=arguments[n])r.hasOwnProperty(i)&&(e[i]=r[i]);return e}},function(e,t,n){"use strict";var r=n(0);e.exports={build:function(e,t){var n,i,s,a=t.plugins;for(n=0,i=a.length;n<i;n++)(s=a[n]).methods&&r(e,s.methods),s.properties&&Object.defineProperties(e,s.properties)},hook:function(e,t,n){var r,i,s,a,o=e.config.plugins,u=[e.context];for(n&&(u=u.concat(n)),r=0,i=o.length;r<i;r++)a=o[r],(s=o[r][t])&&s.apply(a,u)}}},function(e,t,n){"use strict";function r(e){if(0===e.length)return e;var t,n,r=e.split(/[_-]/);if(1===r.length&&r[0][0].toLowerCase()===r[0][0])return e;for(n=r[0].toLowerCase(),t=1;t<r.length;t++)n=n+r[t].charAt(0).toUpperCase()+r[t].substring(1).toLowerCase();return n}r.prepended=function(e,t){return e+(t=r(t))[0].toUpperCase()+t.substring(1)},e.exports=r},function(e,t,n){"use strict";var r=n(0),i=n(2);function s(e,t){e=e||{},this.options=e,this.defaults=t.defaults,this.states=[],this.transitions=[],this.map={},this.lifecycle=this.configureLifecycle(),this.init=this.configureInitTransition(e.init),this.data=this.configureData(e.data),this.methods=this.configureMethods(e.methods),this.map[this.defaults.wildcard]={},this.configureTransitions(e.transitions||[]),this.plugins=this.configurePlugins(e.plugins,t.plugin)}r(s.prototype,{addState:function(e){this.map[e]||(this.states.push(e),this.addStateLifecycleNames(e),this.map[e]={})},addStateLifecycleNames:function(e){this.lifecycle.onEnter[e]=i.prepended("onEnter",e),this.lifecycle.onLeave[e]=i.prepended("onLeave",e),this.lifecycle.on[e]=i.prepended("on",e)},addTransition:function(e){this.transitions.indexOf(e)<0&&(this.transitions.push(e),this.addTransitionLifecycleNames(e))},addTransitionLifecycleNames:function(e){this.lifecycle.onBefore[e]=i.prepended("onBefore",e),this.lifecycle.onAfter[e]=i.prepended("onAfter",e),this.lifecycle.on[e]=i.prepended("on",e)},mapTransition:function(e){var t=e.name,n=e.from,r=e.to;return this.addState(n),"function"!=typeof r&&this.addState(r),this.addTransition(t),this.map[n][t]=e,e},configureLifecycle:function(){return{onBefore:{transition:"onBeforeTransition"},onAfter:{transition:"onAfterTransition"},onEnter:{state:"onEnterState"},onLeave:{state:"onLeaveState"},on:{transition:"onTransition"}}},configureInitTransition:function(e){return"string"==typeof e?this.mapTransition(r({},this.defaults.init,{to:e,active:!0})):"object"==typeof e?this.mapTransition(r({},this.defaults.init,e,{active:!0})):(this.addState(this.defaults.init.from),this.defaults.init)},configureData:function(e){return"function"==typeof e?e:"object"==typeof e?function(){return e}:function(){return{}}},configureMethods:function(e){return e||{}},configurePlugins:function(e,t){var n,r,i;for(n=0,r=(e=e||[]).length;n<r;n++)"function"==typeof(i=e[n])&&(e[n]=i=i()),i.configure&&i.configure(this);return e},configureTransitions:function(e){var t,n,r,i,s,a=this.defaults.wildcard;for(n=0;n<e.length;n++)for(r=e[n],i=Array.isArray(r.from)?r.from:[r.from||a],s=r.to||a,t=0;t<i.length;t++)this.mapTransition({name:r.name,from:i[t],to:s})},transitionFor:function(e,t){var n=this.defaults.wildcard;return this.map[e][t]||this.map[n][t]},transitionsFor:function(e){var t=this.defaults.wildcard;return Object.keys(this.map[e]).concat(Object.keys(this.map[t]))},allStates:function(){return this.states},allTransitions:function(){return this.transitions}}),e.exports=s},function(e,t,n){var r=n(0),i=n(6),s=n(1),a=[null,[]];function o(e,t){this.context=e,this.config=t,this.state=t.init.from,this.observers=[e]}r(o.prototype,{init:function(e){if(r(this.context,this.config.data.apply(this.context,e)),s.hook(this,"init"),this.config.init.active)return this.fire(this.config.init.name,[])},is:function(e){return Array.isArray(e)?e.indexOf(this.state)>=0:this.state===e},isPending:function(){return this.pending},can:function(e){return!this.isPending()&&!!this.seek(e)},cannot:function(e){return!this.can(e)},allStates:function(){return this.config.allStates()},allTransitions:function(){return this.config.allTransitions()},transitions:function(){return this.config.transitionsFor(this.state)},seek:function(e,t){var n=this.config.defaults.wildcard,r=this.config.transitionFor(this.state,e),i=r&&r.to;return"function"==typeof i?i.apply(this.context,t):i===n?this.state:i},fire:function(e,t){return this.transit(e,this.state,this.seek(e,t),t)},transit:function(e,t,n,r){var i=this.config.lifecycle,s=this.config.options.observeUnchangedState||t!==n;return n?this.isPending()?this.context.onPendingTransition(e,t,n):(this.config.addState(n),this.beginTransit(),r.unshift({transition:e,from:t,to:n,fsm:this.context}),this.observeEvents([this.observersForEvent(i.onBefore.transition),this.observersForEvent(i.onBefore[e]),s?this.observersForEvent(i.onLeave.state):a,s?this.observersForEvent(i.onLeave[t]):a,this.observersForEvent(i.on.transition),s?["doTransit",[this]]:a,s?this.observersForEvent(i.onEnter.state):a,s?this.observersForEvent(i.onEnter[n]):a,s?this.observersForEvent(i.on[n]):a,this.observersForEvent(i.onAfter.transition),this.observersForEvent(i.onAfter[e]),this.observersForEvent(i.on[e])],r)):this.context.onInvalidTransition(e,t,n)},beginTransit:function(){this.pending=!0},endTransit:function(e){return this.pending=!1,e},failTransit:function(e){throw this.pending=!1,e},doTransit:function(e){this.state=e.to},observe:function(e){if(2===e.length){var t={};t[e[0]]=e[1],this.observers.push(t)}else this.observers.push(e[0])},observersForEvent:function(e){for(var t,n=0,r=this.observers.length,i=[];n<r;n++)(t=this.observers[n])[e]&&i.push(t);return[e,i,!0]},observeEvents:function(e,t,n,r){if(0===e.length)return this.endTransit(void 0===r||r);var i=e[0][0],a=e[0][1],o=e[0][2];if(t[0].event=i,i&&o&&i!==n&&s.hook(this,"lifecycle",t),0===a.length)return e.shift(),this.observeEvents(e,t,i,r);var u=a.shift(),c=u[i].apply(u,t);return c&&"function"==typeof c.then?c.then(this.observeEvents.bind(this,e,t,i)).catch(this.failTransit.bind(this)):!1===c?this.endTransit(!1):this.observeEvents(e,t,i,c)},onInvalidTransition:function(e,t,n){throw new i("transition is invalid in current state",e,t,n,this.state)},onPendingTransition:function(e,t,n){throw new i("transition is invalid while previous transition is still in progress",e,t,n,this.state)}}),e.exports=o},function(e,t,n){"use strict";var r=n(0),i=n(2),s=n(1),a=n(3),o=n(4),u={is:function(e){return this._fsm.is(e)},can:function(e){return this._fsm.can(e)},cannot:function(e){return this._fsm.cannot(e)},observe:function(){return this._fsm.observe(arguments)},transitions:function(){return this._fsm.transitions()},allTransitions:function(){return this._fsm.allTransitions()},allStates:function(){return this._fsm.allStates()},onInvalidTransition:function(e,t,n){return this._fsm.onInvalidTransition(e,t,n)},onPendingTransition:function(e,t,n){return this._fsm.onPendingTransition(e,t,n)}},c={state:{configurable:!1,enumerable:!0,get:function(){return this._fsm.state},set:function(e){throw Error("use transitions to change state")}}};function l(e){return d(this||{},e)}function d(e,t){return f(e,new a(t,l)),e._fsm(),e}function f(e,t){if("object"!=typeof e||Array.isArray(e))throw Error("StateMachine can only be applied to objects");s.build(e,t),Object.defineProperties(e,c),r(e,u),r(e,t.methods),t.allTransitions().forEach((function(t){e[i(t)]=function(){return this._fsm.fire(t,[].slice.call(arguments))}})),e._fsm=function(){this._fsm=new o(this,t),this._fsm.init(arguments)}}l.version="3.0.1",l.factory=function(){var e,t;"function"==typeof arguments[0]?(e=arguments[0],t=arguments[1]||{}):(e=function(){this._fsm.apply(this,arguments)},t=arguments[0]||{});var n=new a(t,l);return f(e.prototype,n),e.prototype._fsm.config=n,e},l.apply=d,l.defaults={wildcard:"*",init:{name:"init",from:"none"}},e.exports=l},function(e,t,n){"use strict";e.exports=function(e,t,n,r,i){this.message=e,this.transition=t,this.from=n,this.to=r,this.current=i}}])},e.exports=r()},2106:function(e,t,n){"use strict";var r=n(474),i=n(783),s=n(781),a=n(784);Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(e,n,a){var o,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return r(this,t),(o=i(this,s(t).call(this))).method="init",o.token=e,o.continuation_token=n,o.metadata=a,o.registrations=u,o.tweaks=c,o.capabilities=["client_update","offline_storage","telemetry.v1"],o}return a(t,e),t}(n(940).AbstractMessage);t.Init=o},2107:function(e,t,n){var r,i,s=n(1490),a=n(1491),o=0,u=0;e.exports=function(e,t,n){var c=t&&n||0,l=t||[],d=(e=e||{}).node||r,f=void 0!==e.clockseq?e.clockseq:i;if(null==d||null==f){var h=s();null==d&&(d=r=[1|h[0],h[1],h[2],h[3],h[4],h[5]]),null==f&&(f=i=16383&(h[6]<<8|h[7]))}var p=void 0!==e.msecs?e.msecs:(new Date).getTime(),v=void 0!==e.nsecs?e.nsecs:u+1,y=p-o+(v-u)/1e4;if(y<0&&void 0===e.clockseq&&(f=f+1&16383),(y<0||p>o)&&void 0===e.nsecs&&(v=0),v>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");o=p,u=v,i=f;var m=(1e4*(268435455&(p+=122192928e5))+v)%4294967296;l[c++]=m>>>24&255,l[c++]=m>>>16&255,l[c++]=m>>>8&255,l[c++]=255&m;var g=p/4294967296*1e4&268435455;l[c++]=g>>>8&255,l[c++]=255&g,l[c++]=g>>>24&15|16,l[c++]=g>>>16&255,l[c++]=f>>>8|128,l[c++]=255&f;for(var b=0;b<6;++b)l[c+b]=d[b];return t||a(l)}},2108:function(e,t,n){var r=n(1490),i=n(1491);e.exports=function(e,t,n){var s=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||r)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var o=0;o<16;++o)t[s+o]=a[o];return t||i(a)}},2109:function(e,t,n){"use strict";var r=n(783),i=n(781),s=n(784),a=n(474);Object.defineProperty(t,"__esModule",{value:!0});var o=n(940);t.ContinuationTokenStatus=function e(){a(this,e)};var u=function(e){function t(e,n,s,o,u,c,l){var d;return a(this,t),(d=r(this,i(t).call(this,e))).continuationToken=n,d.continuationTokenStatus=s,d.offlineStorage=o,d.initRegistrations=u,d.debugInfo=c,d.confirmedCapabilities=l,d}return s(t,e),t}(o.AbstractMessage);t.InitReply=u},2110:function(e,t,n){"use strict";var r=n(474),i=n(783),s=n(781),a=n(784);Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(e){var n;return r(this,t),(n=i(this,s(t).call(this))).method="update",n.token=e,n}return a(t,e),t}(n(940).AbstractMessage);t.Update=o},2111:function(e,t,n){"use strict";var r=n(474),i=n(783),s=n(781),a=n(784);Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(e,n,a){var o;return r(this,t),(o=i(this,s(t).call(this))).method="message",o.active_grant=e,o.payload_type=n,o.http_request=a,o}return a(t,e),t}(n(940).AbstractMessage);t.Message=o},2112:function(e,t,n){"use strict";var r=n(474),i=n(783),s=n(781),a=n(784);Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(e){var n;return r(this,t),(n=i(this,s(t).call(this,e))).method="reply",n.payload_type="application/json",n.status={code:200,status:"OK"},n}return a(t,e),t}(n(940).AbstractMessage);t.Reply=o},2113:function(e,t,n){"use strict";var r=n(474),i=n(783),s=n(781),a=n(784);Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){var e;return r(this,t),(e=i(this,s(t).call(this))).method="close",e}return a(t,e),t}(n(940).AbstractMessage);t.Close=o},2114:function(e,t){e.exports=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}},2115:function(e,t,n){var r=n(1237);function i(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function s(t,n,a){return i()?e.exports=s=Reflect.construct:e.exports=s=function(e,t,n){var i=[null];i.push.apply(i,t);var s=new(Function.bind.apply(e,i));return n&&r(s,n.prototype),s},s.apply(null,arguments)}e.exports=s},2116:function(e,t,n){"use strict";var r=n(474),i=n(475),s=n(783),a=n(781),o=n(784);Object.defineProperty(t,"__esModule",{value:!0});var u=n(324),c=n(980),l=function(e){function t(e){var n;return r(this,t),(n=s(this,a(t).call(this))).options=e?Object.assign({},e):{},n}return o(t,e),i(t,[{key:"start",value:function(){if(this.inProgress)throw new Error("Already waiting for next attempt, call finishAttempt(success : boolean) to finish it");this.createRetrier()}},{key:"stop",value:function(){this.cleanRetrier(),this.newBackoff=null,this.usedBackoff=null}},{key:"modifyBackoff",value:function(e){this.newBackoff=e}},{key:"attemptFailed",value:function(){if(!this.inProgress)throw new Error("No attempt is in progress");this.newBackoff?!this.usedBackoff||this.usedBackoff<this.newBackoff?this.createRetrier():this.retrier.failed(new Error):this.retrier.failed(new Error)}},{key:"cancel",value:function(){this.retrier&&this.retrier.cancel()}},{key:"cleanRetrier",value:function(){this.retrier&&(this.retrier.removeAllListeners(),this.retrier.cancel(),this.retrier=null)}},{key:"getRetryPolicy",value:function(){var e=Object.assign({},this.options);return this.newBackoff&&(e.min=this.newBackoff,e.max=this.options.max&&this.options.max>this.newBackoff?this.options.max:this.newBackoff),e.maxAttemptsCount=this.options.maxAttemptsCount?this.options.maxAttemptsCount+1:void 0,e}},{key:"createRetrier",value:function(){var e=this;this.cleanRetrier();var t=this.getRetryPolicy();this.retrier=new c.Retrier(t),this.retrier.once("attempt",(function(){e.retrier.on("attempt",(function(){return e.emit("attempt")})),e.retrier.failed(new Error("Skipping first attempt"))})),this.retrier.on("failed",(function(t){return e.emit("failed",t)})),this.usedBackoff=this.newBackoff,this.newBackoff=null,this.retrier.start().catch((function(e){}))}},{key:"inProgress",get:function(){return!!this.retrier}}]),t}(u.EventEmitter);t.BackoffRetrier=l},2117:function(e,t,n){"use strict";var r=n(3),i=n(800),s=n(475),a=n(474);Object.defineProperty(t,"__esModule",{value:!0});var o=n(904),u=n(1239),c=n(878),l=n(1494),d=n(1493),f=n(1238),h=n(2118);t.PacketResponse=function e(){a(this,e)};var p=function(){function e(t,n){var r=this;a(this,e),this.config=n,this.activeRequests=new Map,this.channel=t,this.channel.on("reply",(function(e){return r.processReply(e)})),this.channel.on("disconnected",(function(){r.activeRequests.forEach((function(e){clearTimeout(e.timeout),e.reject(new c.TwilsockError("disconnected"))})),r.activeRequests.clear()}))}var t;return s(e,[{key:"processReply",value:function(e){var t,n=this.activeRequests.get(e.id);n&&(clearTimeout(n.timeout),this.activeRequests.delete(e.id),(t=e.status.code)>=200&&t<300?n.resolve(e):(n.reject(new l.TwilsockReplyError("Transport failure: "+e.status.status,e)),o.log.trace("message rejected")))}},{key:"storeRequest",value:function(e,t,n){var r={resolve:t,reject:n,timeout:setTimeout((function(){o.log.trace("request",e,"is timed out"),n(new c.TwilsockError("Twilsock: request timeout: "+e))}),3e4)};this.activeRequests.set(e,r)}},{key:"shutdown",value:function(){this.activeRequests.forEach((function(e){clearTimeout(e.timeout),e.reject(new c.TwilsockError("Twilsock: request cancelled by user"))})),this.activeRequests.clear()}},{key:"sendInit",value:(t=i(r.mark((function e(){var t,n,i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.log.trace("sendInit"),t=h.Metadata.getMetadata(this.config),n=new f.Init(this.config.token,this.config.continuationToken,t,this.config.initRegistrations,this.config.tweaks),e.next=5,this.sendWithReply(n);case 5:return i=e.sent,e.abrupt("return",new f.InitReply(i.id,i.header.continuation_token,i.header.continuation_token_status,i.header.offline_storage,i.header.init_registrations,i.header.debug_info,new Set(i.header.capabilities)));case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"sendClose",value:function(){var e=new f.Close;this.send(e)}},{key:"sendWithReply",value:function(e,t){var n=this;return new Promise((function(r,i){var s=n.send(e,t);n.storeRequest(s,r,i)}))}},{key:"send",value:function(e,t){e.id=e.id||"TM".concat(u.v4());var n=d.Parser.createPacket(e,function(e){switch(typeof e){case"undefined":return"";case"object":return JSON.stringify(e);default:return e}}(t));try{return this.channel.send(n),e.id}catch(t){throw o.log.debug("failed to send ",e,t),o.log.trace(t.stack),t}}},{key:"isConnected",get:function(){return this.channel.isConnected}}]),e}();t.PacketInterface=p},2118:function(e,t,n){"use strict";var r=n(474),i=n(475);Object.defineProperty(t,"__esModule",{value:!0});var s=n(1241),a=function(){function e(){r(this,e)}return i(e,null,[{key:"getMetadata",value:function(e){"undefined"!=typeof navigator&&s.parse(navigator.userAgent);var t=e&&e.clientMetadata?e.clientMetadata:{},n={env:s.name,envv:s.version,os:s.os.family,osv:s.os.version,osa:s.os.architecture,sdk:"js-default"},r={};return["ver","env","envv","os","osv","osa","type","sdk","sdkv","dev","devv","devt","app","appv"].filter((function(e){return e in t||e in n})).forEach((function(e){return r[e]=e in t?t[e]:n[e]})),r}}]),e}();t.Metadata=a},2119:function(e,t,n){"use strict";(function(e){var r=n(474),i=n(475),s=n(783),a=n(781),o=n(784);Object.defineProperty(t,"__esModule",{value:!0});var u=n(324),c=n(904),l=function(t){function u(t){var i;return r(this,u),(i=s(this,a(u).call(this))).url=t,i.WebSocket=e.WebSocket||e.MozWebSocket||n(2120),i}return o(u,t),i(u,[{key:"connect",value:function(){var e,t=this;c.log.trace("connecting to socket");try{e=new this.WebSocket(this.url)}catch(e){return c.log.debug("Socket error: ".concat(this.url)),void this.emit("socketError",e)}e.binaryType="arraybuffer",e.onopen=function(){c.log.debug("socket opened ".concat(t.url)),t.emit("connected")},e.onclose=function(e){c.log.debug("socket closed",e),t.emit("disconnected",e)},e.onerror=function(e){c.log.debug("Socket error:",e),t.emit("socketError",e)},e.onmessage=function(e){t.emit("message",e.data)},this.socket=e}},{key:"send",value:function(e){this.socket.send(e)}},{key:"close",value:function(){if(c.log.trace("closing socket"),this.socket){this.socket.onopen=null,this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null;try{this.socket.close()}finally{}}}},{key:"isConnected",get:function(){return this.socket&&1===this.socket.readyState}}]),u}(u.EventEmitter);t.WebSocketChannel=l}).call(this,n(54))},2121:function(e,t,n){"use strict";var r=n(3),i=n(800),s=n(474),a=n(475),o=n(783),u=n(781),c=n(784);Object.defineProperty(t,"__esModule",{value:!0});var l=n(904),d=n(324),f=n(1239),h=n(878),p=function(e){function t(e){var n;return s(this,t),(n=o(this,u(t).call(this))).transport=e,n.registrations=new Map,n.registrationsInProgress=new Map,n}var n,d,p,v;return c(t,e),a(t,[{key:"putNotificationContext",value:(v=i(r.mark((function e(t,n){var i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={method:"put_notification_ctx",notification_ctx_id:t},e.next=3,this.transport.sendWithReply(i,n);case 3:e.sent;case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return v.apply(this,arguments)})},{key:"deleteNotificationContext",value:(p=i(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"delete_notification_ctx",notification_ctx_id:t},e.next=3,this.transport.sendWithReply(n);case 3:e.sent;case 4:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"updateRegistration",value:(d=i(r.mark((function e(t,n){var i,s;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l.log.debug("update registration for context",t),(i=this.registrationsInProgress.get(t))||(i=new Set,this.registrationsInProgress.set(t,i)),s=f.v4(),i.add(s),e.prev=5,e.next=8,this.putNotificationContext(t,n);case 8:l.log.debug("registration attempt succeeded for context",n),i.delete(s),0===i.size&&(this.registrationsInProgress.delete(t),this.emit("registered",t)),e.next=19;break;case 13:e.prev=13,e.t0=e.catch(5),l.log.warn("registration attempt failed for context",n),l.log.debug(e.t0),i.delete(s),0===i.size&&(this.registrationsInProgress.delete(t),this.emit("registrationFailed",t,e.t0));case 19:case"end":return e.stop()}}),e,this,[[5,13]])}))),function(e,t){return d.apply(this,arguments)})},{key:"updateRegistrations",value:function(){var e=this;l.log.trace("refreshing ".concat(this.registrations.size," registrations")),this.registrations.forEach((function(t,n){e.updateRegistration(n,t)}))}},{key:"setNotificationsContext",value:function(e,t){if(!e||!t)throw new h.TwilsockError("Invalid arguments provided");this.registrations.set(e,t),this.transport.isConnected&&this.updateRegistration(e,t)}},{key:"removeNotificationsContext",value:(n=i(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.registrations.has(t)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.deleteNotificationContext(t);case 4:this.transport.isConnected&&this.registrations.delete(t);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]),t}(d.EventEmitter);t.Registrations=p},2122:function(e,t,n){"use strict";var r=n(3),i=n(800),s=n(475),a=n(474);Object.defineProperty(t,"__esModule",{value:!0});var o=n(904),u=n(878),c=n(2123),l=n(1238),d=n(1495);function f(e,t){var n=function(e){var t=e.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)(\/[^?#]*)(\?[^#]*|)(#.*|)$/);if(t){var n={protocol:t[1],host:t[2],hostname:t[3],port:t[4],pathname:t[5],search:t[6],hash:t[7],params:null};if(n.search.length>0){var r=n.search.substring(1);n.params=r.split("&").map((function(e){return e.split("=")})).reduce((function(e,t){return e.hasOwnProperty(t[0])?Array.isArray(e[t[0]])?e[t[0]].push(t[1]):e[t[0]]=[e[t[0]],t[1]]:e[t[0]]=t[1],e}),{})}return n}throw new u.TwilsockError("Incorrect URI: "+e)}(t),r={method:e,host:n.host,path:n.pathname};return n.params&&(r.params=n.params),r}function h(e,t,n,r,i){return{to:f(e,t),headers:n,body:r,grant:i}}var p=function(){function e(t,n,r){a(this,e),this.config=r,this.transport=t,this.pendingMessages=[],this.twilsock=n}var t;return s(e,[{key:"saveMessage",value:function(e){var t=this;return new Promise((function(n,r){var i={message:e,resolve:n,reject:r,alreadyRejected:!1,timeout:setTimeout((function(){o.log.debug("request is timed out"),r(new u.TwilsockError("request '".concat(e.to.method,"' to '").concat(e.to.host,"' timed out"))),i.alreadyRejected=!0}),2e4)};t.pendingMessages.push(i)}))}},{key:"sendPendingMessages",value:function(){for(var e=this,t=function(){var t=e.pendingMessages[0];if(!t.alreadyRejected)try{var n=t.message;e.actualSend(n).then((function(e){return t.resolve(e)})).catch((function(e){return t.reject(e)})),clearTimeout(t.timeout)}catch(e){return o.log.debug("Failed to send pending message",e),"break"}e.pendingMessages.splice(0,1)};this.pendingMessages.length;){if("break"===t())break}}},{key:"rejectPendingMessages",value:function(){var e=this;this.pendingMessages.forEach((function(t){t.reject(new d.TransportUnavailableError("Unable to connect: "+e.twilsock.getTerminationReason)),clearTimeout(t.timeout)})),this.pendingMessages.splice(0,this.pendingMessages.length)}},{key:"actualSend",value:(t=i(r.mark((function e(t){var n,i,s,a,o,u,d;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.to,i=t.headers,s=t.body,a=t.grant?t.grant:this.config.activeGrant,o={host:n.host,path:n.path,method:n.method,params:n.params,headers:i},u=new l.Message(a,i["Content-Type"]||"application/json",o),e.next=8,this.transport.sendWithReply(u,s);case 8:if(d=e.sent,!((f=d)&&f.header&&f.header.http_status)||(r=d.header.http_status.code)>=200&&r<300){e.next=11;break}throw new c.TwilsockUpstreamError(d.header.http_status.code,d.header.http_status.status,d.body);case 11:return e.abrupt("return",{status:d.header.http_status,headers:d.header.http_headers,body:d.body});case 12:case"end":return e.stop()}var r,f}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"send",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;if(this.twilsock.isTerminalState)return Promise.reject(new d.TransportUnavailableError("Unable to connect: "+this.twilsock.getTerminationReason));var s=h(e,t,n,r,i);return this.twilsock.isConnected?this.actualSend(s):this.saveMessage(s)}}]),e}();t.Upstream=p},2123:function(e,t,n){"use strict";var r=n(474),i=n(783),s=n(781),a=n(784);Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(e,n,a){var o;return r(this,t),(o=i(this,s(t).call(this,n))).status=e,o.description=n,o.body=a,o}return a(t,e),t}(n(878).TwilsockError);t.TwilsockUpstreamError=o},2124:function(e,t,n){"use strict";var r=n(474),i=n(475);Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(){var t=this;r(this,e),this._promise=new Promise((function(e,n){t._resolve=e,t._reject=n}))}return i(e,[{key:"update",value:function(e){this._resolve(e)}},{key:"set",value:function(e){this.current=e,this._resolve(e)}},{key:"fail",value:function(e){this._reject(e)}},{key:"promise",get:function(){return this._promise}}]),e}();t.Deferred=s},2125:function(e,t,n){"use strict";var r=n(474),i=n(475);Object.defineProperty(t,"__esModule",{value:!0});var s=n(878),a=function(){function e(t){r(this,e),this.id=t}return i(e,null,[{key:"create",value:function(t){if(t instanceof Object&&"storage_id"in t)return new e(t.storage_id);throw new s.TwilsockError('Field "storage_id" is missing')}}]),e}();t.OfflineProductStorage=a},2126:function(e,t,n){"use strict";(function(e){var r=n(474),i=n(475);Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function t(){r(this,t)}return i(t,null,[{key:"storeToken",value:function(e,n){t.canStore&&t.sessionStorage.setItem(t.getKeyName(n),e)}},{key:"getStoredToken",value:function(e){return t.canStore?t.sessionStorage.getItem(t.getKeyName(e)):null}},{key:"initialize",value:function(){t.canStore&&(t.sessionStorage.getItem(t.initializedFlag)&&this.clear(),t.sessionStorage.setItem(t.initializedFlag,"true"),t.window.addEventListener("unload",(function(){t.sessionStorage.removeItem(t.initializedFlag)})))}},{key:"clear",value:function(){if(t.canStore){for(var e=[],n=0;n<t.sessionStorage.length;n++){var r=t.sessionStorage.key(n);0===r.indexOf(t.tokenStoragePrefix)&&e.push(r)}e.forEach((function(e){return t.sessionStorage.removeItem(e)})),t.sessionStorage.removeItem(t.initializedFlag)}}},{key:"getKeyName",value:function(e){return"".concat(t.tokenStoragePrefix).concat(e)}},{key:"sessionStorage",get:function(){try{return e.sessionStorage}catch(e){return null}}},{key:"window",get:function(){try{return e.window}catch(e){return null}}},{key:"canStore",get:function(){return t.sessionStorage&&t.window}}]),t}();t.TokenStorage=s,s.initializedFlag="twilio_twilsock_token_storage",s.tokenStoragePrefix="twilio_continuation_token_",s.initialize()}).call(this,n(54))},2127:function(e,t,n){"use strict";var r=n(474),i=n(475);Object.defineProperty(t,"__esModule",{value:!0});var s,a,o=n(1492),u=n(904),c=function(){function e(t,n,i,s,a,o){r(this,e),this.title=t,this.details=n,this.start=i,this.type=a,this.id=o,this.end=s}return i(e,[{key:"toTelemetryEvent",value:function(){var e=new Date,t=this.start,n=this.end?this.end:e;if(n<t){var r=n;n=t,t=r}var i=t.getTime()-e.getTime(),s=n.getTime()-e.getTime();return new o.TelemetryEvent(i,s,this.title,this.details,this.id,this.type)}}]),e}();t.TelemetryEventDescription=c,function(e){e[e.Start=0]="Start",e[e.End=1]="End"}(s||(s={})),t.TelemetryPoint=s,function(e){e[e.MinEventsPortion=0]="MinEventsPortion",e[e.AnyEvents=1]="AnyEvents",e[e.AnyEventsIncludingUnfinished=2]="AnyEventsIncludingUnfinished"}(a||(a={})),t.EventSendingLimitation=a;var l=function(){function e(t,n){r(this,e),this.minEventsPortionToSend=50,this.maxEventsPortionToSend=100,this.pendingEvents=new Map,this.readyEvents=[],this.hasInitializationFinished=!1,this._canSendTelemetry=!1,this.config=t,this.packetInterface=n}return i(e,[{key:"addTelemetryEvent",value:function(e){!this.canSendTelemetry&&this.hasInitializationFinished||this.readyEvents.push(e)}},{key:"addPartialEvent",value:function(e,t,n){u.log.debug("Adding ".concat(n===s.Start?"starting":"ending"," timepoint for '").concat(t,"' event"));var r=this.pendingEvents.has(t);if(n===s.Start)r&&u.log.debug("Overwriting starting point for '".concat(t,"' event")),this.pendingEvents.set(t,e);else{if(!r)return void u.log.info("Could not find started event for '".concat(t,"' event"));this.addTelemetryEvent(this.merge(this.pendingEvents.get(t),e)),this.pendingEvents.delete(t)}}},{key:"getTelemetryToSend",value:function(e){return this.canSendTelemetry&&0!=this.readyEvents.length?e==a.MinEventsPortion&&this.readyEvents.length<this.minEventsPortionToSend?[]:this.getTelemetryPortion(e==a.AnyEventsIncludingUnfinished):[]}},{key:"getTelemetryPortion",value:function(e){var t=this,n=Math.min(this.readyEvents.length,this.maxEventsPortionToSend),r=this.readyEvents.splice(0,n);return e&&r.length<this.maxEventsPortionToSend&&this.pendingEvents.forEach((function(e,n){if(!(r.length>=t.maxEventsPortionToSend)){var i=t.pendingEvents.get(n);t.pendingEvents.delete(n),r.push(new c("[UNFINISHED] ".concat(i.title),i.details,i.start,null,i.type,i.id))}})),r}},{key:"merge",value:function(e,t){return new c(t.title?t.title:e.title,t.details?t.details:e.details,e.start,t.end,t.type?t.type:e.type,t.id?t.id:e.id)}},{key:"sendTelemetryIfMinimalPortionCollected",value:function(){this.sendTelemetry(a.MinEventsPortion)}},{key:"sendTelemetry",value:function(e){var t=this.getTelemetryToSend(e);if(0!==t.length)try{this.packetInterface.send(new o.Telemetry(t.map((function(e){return e.toTelemetryEvent()}))))}catch(e){u.log.debug("Error while sending ".concat(t.length," telemetry events due to ").concat(e,"; they will be resubmitted")),this.readyEvents=this.readyEvents.concat(t)}}},{key:"isTelemetryEnabled",get:function(){return this.config.confirmedCapabilities.has("telemetry.v1")}},{key:"canSendTelemetry",get:function(){return this._canSendTelemetry&&this.isTelemetryEnabled},set:function(e){u.log.debug("TelemetryTracker.canSendTelemetry: ".concat(e," TelemetryTracker.isTelemetryEnabled: ").concat(this.isTelemetryEnabled)),this._canSendTelemetry&&!e&&(this.pendingEvents.clear(),this.readyEvents=[]),this._canSendTelemetry=e,e&&this.sendTelemetry(a.AnyEvents),e&&!this.hasInitializationFinished&&(this.hasInitializationFinished=!0)}}]),e}();t.TelemetryTracker=l},2128:function(e,t,n){"use strict";var r=n(3),i=n(800),s=n(474),a=n(475),o=n(783),u=n(781),c=n(784),l=n(939);Object.defineProperty(t,"__esModule",{value:!0}),t.Client=void 0;var d=n(324),f=n(1021),h=n(2129),p=n(2130),v=n(1242),y=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(s(this,t),n=o(this,u(t).call(this)),!e||0===e.length)throw new Error("Token is required for Notifications client");r.logLevel=r.logLevel||"error",v.log.setLevel(r.logLevel);r.minTokenRefreshInterval;var i=r.productId||"notifications";return r.twilsockClient=r.twilsockClient||new f.TwilsockClient(e,i,r),r.transport=r.transport||r.twilsockClient,n.services={twilsock:r.twilsockClient,transport:r.transport,config:new h.Configuration(null,r)},n.registrar=new p.Registrar(i,n.services.transport,n.services.twilsock,n.services.config),n.reliableTransportState={overall:!1,transport:!1,registration:!1,lastEmitted:null},n._onTransportStateChange(n.services.twilsock.isConnected),n.registrar.on("transportReady",(function(e){n._onRegistrationStateChange(e?"registered":"")})),n.registrar.on("stateChanged",(function(e){n._onRegistrationStateChange(e)})),n.registrar.on("needReliableTransport",n._onNeedReliableTransport.bind(l(l(n)))),n.services.twilsock.on("message",(function(e,t){return n._routeMessage(e,t)})),n.services.twilsock.on("connected",(function(e){n._onTransportStateChange(!0),n.registrar.setNotificationId("twilsock",e)})),n.services.twilsock.on("disconnected",(function(){n._onTransportStateChange(!1)})),n.services.config.updateToken(e),n.registrar.updateToken(e),n}var n;return c(t,e),a(t,[{key:"_routeMessage",value:function(e,t){v.log.trace("Message arrived: ",e,t),this.emit("message",e,t)}},{key:"_onNeedReliableTransport",value:function(e){e?this.services.twilsock.connect():this.services.twilsock.disconnect()}},{key:"_onRegistrationStateChange",value:function(e){this.reliableTransportState.registration="registered"===e,this._updateTransportState()}},{key:"_onTransportStateChange",value:function(e){this.reliableTransportState.transport=e,this._updateTransportState()}},{key:"_updateTransportState",value:function(){var e=this.reliableTransportState.transport&&this.reliableTransportState.registration;this.reliableTransportState.overall!==e&&(this.reliableTransportState.overall=e,v.log.info("Transport ready:",e),this.emit("transportReady",e)),this.reliableTransportState.lastEmitted!==this.connectionState&&(this.reliableTransportState.lastEmitted=this.connectionState,this.emit("connectionStateChanged",this.connectionState))}},{key:"subscribe",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"twilsock";return v.log.trace("Add subscriptions for message type: ",e,t),this.registrar.subscribe(e,t)}},{key:"unsubscribe",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"twilsock";return v.log.trace("Remove subscriptions for message type: ",e,t),this.registrar.unsubscribe(e,t)}},{key:"handlePushNotification",value:function(e){return{messageType:e.twi_message_type,payload:e.payload}}},{key:"setPushRegistrationId",value:function(e,t){v.log.trace("Set push registration id",e,t),this.registrar.setNotificationId(t,e)}},{key:"updateToken",value:(n=i(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v.log.info("authTokenUpdated"),this.services.config.token!==t){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.services.twilsock.updateToken(t);case 5:this.services.config.updateToken(t),this.registrar.updateToken(t);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"connectionState",get:function(){return"disconnected"===this.services.twilsock.state?"disconnected":"disconnecting"===this.services.twilsock.state?"disconnecting":"connected"===this.services.twilsock.state&&this.reliableTransportState.registration?"connected":"rejected"===this.services.twilsock.state?"denied":"connecting"}}]),t}(d.EventEmitter);t.Client=y},2129:function(e,t,n){"use strict";var r=n(474),i=n(475);Object.defineProperty(t,"__esModule",{value:!0}),t.Configuration=void 0;var s=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,e);var i=n.notifications||{},s=i.region||n.region||"us1",a="https://ers.".concat(s,".twilio.com/v1/registrations");this.registrarUrl=i.ersUrl||a,this._token=t}return i(e,[{key:"updateToken",value:function(e){this._token=e}},{key:"token",get:function(){return this._token}}]),e}();t.Configuration=s},2130:function(e,t,n){"use strict";var r=n(474),i=n(475),s=n(783),a=n(781),o=n(784);Object.defineProperty(t,"__esModule",{value:!0}),t.Registrar=void 0;var u=n(324),c=n(2131),l=n(2132),d=function(e){function t(e,n,i,o){var u;r(this,t),(u=s(this,a(t).call(this))).config=o,u.connectors=new Map;var d=u.detectPlatform();return u.connectors.set("gcm",new c.RegistrarConnector("gcm",{protocolVersion:3,productId:e,platform:d},n,o)),u.connectors.set("fcm",new c.RegistrarConnector("fcm",{protocolVersion:3,productId:e,platform:d},n,o)),u.connectors.set("apn",new c.RegistrarConnector("apn",{protocolVersion:4,productId:e,platform:d},n,o)),u.connectors.set("twilsock",new l.TwilsockConnector({productId:e,platform:d},i,o)),u.connectors.get("twilsock").on("transportReady",(function(e){return u.emit("transportReady",e)})),u}return o(t,e),i(t,[{key:"setNotificationId",value:function(e,t){this.connector(e).setNotificationId(t)}},{key:"subscribe",value:function(e,t){return this.connector(t).subscribe(e)}},{key:"unsubscribe",value:function(e,t){return this.connector(t).unsubscribe(e)}},{key:"updateToken",value:function(e){this.connectors.forEach((function(t){return t.updateToken(e)}))}},{key:"connector",value:function(e){var t=this.connectors.get(e);if(!t)throw new Error("Unknown channel type: ".concat(e));return t}},{key:"detectPlatform",value:function(){var e="";return"undefined"!=typeof navigator?(e="unknown",void 0!==navigator.product&&(e=navigator.product),void 0!==navigator.userAgent&&(e=navigator.userAgent)):e="web",e.substring(0,128)}}]),t}(u.EventEmitter);t.Registrar=d},2131:function(e,t,n){"use strict";var r=n(3),i=n(800),s=n(474),a=n(475),o=n(783),u=n(781),c=n(784);Object.defineProperty(t,"__esModule",{value:!0}),t.RegistrarConnector=t.Connector=void 0;var l=n(980),d=n(1242),f=n(1497);Object.defineProperty(t,"Connector",{enumerable:!0,get:function(){return f.Connector}});var h={min:2e3,max:12e4,randomness:.2},p=function(e){function t(e,n,r,i){var a;return s(this,t),(a=o(this,u(t).call(this,i))).channelType=e,a.context=n,a.transport=r,a}var n,f,p;return c(t,e),a(t,[{key:"updateRegistration",value:(p=i(r.mark((function e(t,n){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.has("notificationId")){e.next=3;break}return e.next=3,this.removeRegistration();case 3:if(t.notificationId&&t.notificationId.length){e.next=5;break}return e.abrupt("return",t);case 5:return e.next=7,this.register(t);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return p.apply(this,arguments)})},{key:"removeRegistration",value:(f=i(r.mark((function e(){var t,n,i=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.registrationId){e.next=2;break}return e.abrupt("return");case 2:return t="".concat(this.config.registrarUrl,"/").concat(this.registrationId,"?productId=").concat(this.context.productId),n={"Content-Type":"application/json","X-Twilio-Token":this.config.token},e.prev=4,d.log.trace("Removing registration for ",this.channelType),e.next=8,new l.Retrier(Object.assign(h,{maxAttemptsCount:3})).run((function(){return i.transport.delete(t,n)}));case 8:d.log.debug("Registration removed for",this.channelType),e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(4),d.log.error("Failed to remove of registration ",this.channelType,e.t0),e.t0;case 15:case"end":return e.stop()}}),e,this,[[4,11]])}))),function(){return f.apply(this,arguments)})},{key:"register",value:(n=i(r.mark((function e(t){var n,i,s,a,o=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d.log.trace("Registering",this.channelType,t),n={endpoint_platform:this.context.platform,channel_type:this.channelType,version:this.context.protocolVersion.toString(),message_types:Array.from(t.messageTypes),data:{registration_id:t.notificationId},ttl:"PT24H"},i="".concat(this.config.registrarUrl,"?productId=").concat(this.context.productId),s={"Content-Type":"application/json","X-Twilio-Token":t.token},d.log.trace("Creating registration for channel ",this.channelType),e.prev=5,e.next=8,new l.Retrier(h).run((function(){return o.transport.post(i,s,n)}));case 8:a=e.sent,this.registrationId=a.body.id,d.log.debug("Registration created: ",a),e.next=17;break;case 13:throw e.prev=13,e.t0=e.catch(5),d.log.error("Registration failed: ",e.t0),e.t0;case 17:case"end":return e.stop()}}),e,this,[[5,13]])}))),function(e){return n.apply(this,arguments)})}]),t}(f.Connector);t.RegistrarConnector=p},2132:function(e,t,n){"use strict";var r=n(3),i=n(800),s=n(474),a=n(475),o=n(783),u=n(781),c=n(784);Object.defineProperty(t,"__esModule",{value:!0}),t.TwilsockConnector=void 0;var l=n(2133),d=function(e){function t(e,n,r){var i;return s(this,t),(i=o(this,u(t).call(this,r))).twilsock=n,i.context=e,e.id=l.v4(),i.twilsock.on("stateChanged",(function(e){"connected"!==e&&i.emit("transportReady",!1)})),i.twilsock.on("registered",(function(t){e&&t===e.id&&"connected"===n.state&&i.emit("transportReady",!0)})),i}var n,d;return c(t,e),a(t,[{key:"setNotificationId",value:function(){}},{key:"updateToken",value:function(e){}},{key:"updateContextRequest",value:(d=i(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={product_id:this.context.productId,notification_protocol_version:4,endpoint_platform:this.context.platform,message_types:t},this.emit("transportReady",!1),e.next=4,this.twilsock.setNotificationsContext(this.context.id,n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"updateRegistration",value:(n=i(r.mark((function e(t,n){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.has("messageType")){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.updateContextRequest(Array.from(t.messageTypes));case 4:return e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"removeRegistration",value:function(){return this.twilsock.removeNotificationsContext(this.context.id)}}]),t}(n(1497).Connector);t.TwilsockConnector=d},2133:function(e,t,n){var r=n(2134),i=n(2135),s=i;s.v1=r,s.v4=i,e.exports=s},2134:function(e,t,n){var r,i,s=n(1498),a=n(1499),o=0,u=0;e.exports=function(e,t,n){var c=t&&n||0,l=t||[],d=(e=e||{}).node||r,f=void 0!==e.clockseq?e.clockseq:i;if(null==d||null==f){var h=s();null==d&&(d=r=[1|h[0],h[1],h[2],h[3],h[4],h[5]]),null==f&&(f=i=16383&(h[6]<<8|h[7]))}var p=void 0!==e.msecs?e.msecs:(new Date).getTime(),v=void 0!==e.nsecs?e.nsecs:u+1,y=p-o+(v-u)/1e4;if(y<0&&void 0===e.clockseq&&(f=f+1&16383),(y<0||p>o)&&void 0===e.nsecs&&(v=0),v>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");o=p,u=v,i=f;var m=(1e4*(268435455&(p+=122192928e5))+v)%4294967296;l[c++]=m>>>24&255,l[c++]=m>>>16&255,l[c++]=m>>>8&255,l[c++]=255&m;var g=p/4294967296*1e4&268435455;l[c++]=g>>>8&255,l[c++]=255&g,l[c++]=g>>>24&15|16,l[c++]=g>>>16&255,l[c++]=f>>>8|128,l[c++]=255&f;for(var b=0;b<6;++b)l[c+b]=d[b];return t||a(l)}},2135:function(e,t,n){var r=n(1498),i=n(1499);e.exports=function(e,t,n){var s=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||r)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var o=0;o<16;++o)t[s+o]=a[o];return t||i(a)}},2136:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncMapItem=t.SyncMap=t.SyncListItem=t.SyncList=t.SyncDocument=t.SyncClient=void 0;var r=n(2137);Object.defineProperty(t,"SyncClient",{enumerable:!0,get:function(){return r.SyncClient}});var i=n(1503);Object.defineProperty(t,"SyncDocument",{enumerable:!0,get:function(){return i.SyncDocument}});var s=n(1504);Object.defineProperty(t,"SyncList",{enumerable:!0,get:function(){return s.SyncList}});var a=n(1505);Object.defineProperty(t,"SyncListItem",{enumerable:!0,get:function(){return a.ListItem}});var o=n(1507);Object.defineProperty(t,"SyncMap",{enumerable:!0,get:function(){return o.SyncMap}});var u=n(1508);Object.defineProperty(t,"SyncMapItem",{enumerable:!0,get:function(){return u.MapItem}}),t.default=r.SyncClient,e.exports=r.SyncClient,e.exports.SyncClient=r.SyncClient},2137:function(e,t,n){"use strict";var r=n(3),i=n(800),s=n(474),a=n(475),o=n(783),u=n(781),c=n(784);Object.defineProperty(t,"__esModule",{value:!0}),t.SyncClient=t.Client=void 0;var l=n(324),d=n(1021),f=n(1496),h=n(1118),p=n(905),v=n(1022),y=n(906),m=n(2138),g=n(2139),b=n(2140),k=n(2141),w=n(1503),x=n(1504),_=n(1507),S=n(2145),C=n(2146),T=n(2147),E=n(2148),I=n(1509),M=n(1509),P="data_sync",R=n(2149).version;function O(e){if(e){if("string"==typeof e)return{id:e,mode:"open_or_create"};v.validateOptionalTtl(e.ttl),v.validateId(e.id);var t=e.mode||(e.id?"open_or_create":"create_new");return Object.assign(Object.assign({},e),{mode:t})}return{mode:"create_new"}}var N=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(s(this,t),n=o(this,u(t).call(this)),!e)throw new Error("Sync library needs a valid Twilio token to be passed");r.hasOwnProperty("logLevel")?y.default.setLevel(r.logLevel):y.default.setLevel("silent");var i=r.productId=r.productId||P;r.clientMetadata=r.clientMetadata||{},r.clientMetadata.hasOwnProperty("type")||(r.clientMetadata.type="sync"),r.clientMetadata.hasOwnProperty("sdk")||(r.clientMetadata.sdk="JS",r.clientMetadata.sdkv=R);var a=r.twilsockClient=r.twilsockClient||new d.Twilsock(e,i,r);a.on("tokenAboutToExpire",(function(e){return n.emit("tokenAboutToExpire",e)})),a.on("tokenExpired",(function(){return n.emit("tokenExpired")})),a.on("connectionError",(function(e){return n.emit("connectionError",e)}));var c=r.notificationsClient=r.notificationsClient||new f.Notifications(e,r),l=new m.Configuration(r),h=new k.NetworkService(new S.ClientInfo(R),l,a),p=new T.SessionStorage(l);n.localStorageId=null,a.connect(),n.services={config:l,twilsock:a,notifications:c,network:h,storage:p,router:null,subscriptions:null};var v=new g.Subscriptions(n.services),w=new b.Router({config:l,subscriptions:v,notifications:c});return n.services.router=w,n.services.subscriptions=v,n.entities=new C.EntitiesCache,c.on("connectionStateChanged",(function(){n.emit("connectionStateChanged",n.services.notifications.connectionState)})),n}var n,l,N,U,j,A,D,L,F,q,B,W,z,H,J;return c(t,e),a(t,[{key:"ensureReady",value:(J=i(r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.services.config.sessionStorageEnabled){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this.services.twilsock.storageId();case 5:t=e.sent,this.services.storage.updateStorageId(t.id),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),y.default.warn("Failed to initialize storage",e.t0);case 12:case"end":return e.stop()}}),e,this,[[2,9]])}))),function(){return J.apply(this,arguments)})},{key:"storeRootInSessionCache",value:function(e,t,n){if(this.services.config.sessionStorageEnabled&&t){var r=v.deepClone(n);e!==x.SyncList.type&&e!==_.SyncMap.type||(r.last_event_id=null,delete r.items),this.services.storage.store(e,t,r)}}},{key:"readRootFromSessionCache",value:function(e,t){return this.services.config.sessionStorageEnabled&&t?this.services.storage.read(e,t):null}},{key:"_get",value:(H=i(r.mark((function e(t,n){var i,s,a,o=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=o.length>2&&void 0!==o[2]&&o[2],n){e.next=3;break}throw new p.SyncError("Cannot get entity without id",404);case 3:return s=new h.UriBuilder(t).pathSegment(n).queryParam("Include",i?"items":void 0).build(),e.next=6,this.services.network.get(s);case 6:return a=e.sent,e.abrupt("return",a.body);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return H.apply(this,arguments)})},{key:"_createDocument",value:function(e,t,n){var r={unique_name:e,data:t||{}};return void 0!==n&&(r.ttl=n),this.services.network.post(this.services.config.documentsUri,r).then((function(e){return e.body.data=r.data,e.body}))}},{key:"_getDocument",value:(z=i(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readRootFromSessionCache(w.SyncDocument.type,t)||this._get(this.services.config.documentsUri,t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return z.apply(this,arguments)})},{key:"_createList",value:function(e,t,n,r){var i={unique_name:e,purpose:t,context:n};return void 0!==r&&(i.ttl=r),this.services.network.post(this.services.config.listsUri,i).then((function(e){return e.body}))}},{key:"_getList",value:(W=i(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readRootFromSessionCache(x.SyncList.type,t)||this._get(this.services.config.listsUri,t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return W.apply(this,arguments)})},{key:"_createMap",value:function(e,t){var n={unique_name:e};return void 0!==t&&(n.ttl=t),this.services.network.post(this.services.config.mapsUri,n).then((function(e){return e.body}))}},{key:"_getMap",value:(B=i(r.mark((function e(t){var n,i=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]&&i[1],e.abrupt("return",this.readRootFromSessionCache(_.SyncMap.type,t)||this._get(this.services.config.mapsUri,t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return B.apply(this,arguments)})},{key:"_getStream",value:(q=i(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readRootFromSessionCache(E.SyncStream.type,t)||this._get(this.services.config.streamsUri,t,!1));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return q.apply(this,arguments)})},{key:"_createStream",value:(F=i(r.mark((function e(t,n){var i,s;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={unique_name:t},void 0!==n&&(i.ttl=n),e.next=4,this.services.network.post(this.services.config.streamsUri,i);case 4:return s=e.sent,e.abrupt("return",s.body);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return F.apply(this,arguments)})},{key:"_getLiveQuery",value:function(e){return this.readRootFromSessionCache(I.LiveQuery.type,e)}},{key:"getCached",value:function(e,t){return e&&this.entities.get(e,t)||null}},{key:"removeFromCacheAndSession",value:function(e,t,n){this.entities.remove(t),this.services.config.sessionStorageEnabled&&this.services.storage.remove(e,t,n)}},{key:"document",value:(L=i(r.mark((function e(t){var n,i,s,a,o=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if("create_new"!==(n=O(t)).mode){e.next=9;break}return e.next=6,this._createDocument(n.id,n.value,n.ttl);case 6:i=e.sent,e.next=39;break;case 9:if(!(s=this.getCached(n.id,w.SyncDocument.type))){e.next=14;break}return e.abrupt("return",new w.SyncDocument(s));case 14:return e.prev=14,e.next=17,this._getDocument(n.id);case 17:i=e.sent,e.next=39;break;case 20:if(e.prev=20,e.t0=e.catch(14),404===e.t0.status&&"open_existing"!==n.mode){e.next=26;break}throw e.t0;case 26:return e.prev=26,e.next=29,this._createDocument(n.id,n.value,n.ttl);case 29:i=e.sent,e.next=39;break;case 32:if(e.prev=32,e.t1=e.catch(26),409!==e.t1.status){e.next=38;break}return e.abrupt("return",this.document(t));case 38:throw e.t1;case 39:return this.storeRootInSessionCache(w.SyncDocument.type,n.id,i),a=new w.SyncDocumentImpl(this.services,i,(function(e,t,n){return o.removeFromCacheAndSession(e,t,n)})),a=this.entities.store(a),e.abrupt("return",new w.SyncDocument(a));case 43:case"end":return e.stop()}}),e,this,[[14,20],[26,32]])}))),function(e){return L.apply(this,arguments)})},{key:"map",value:(D=i(r.mark((function e(t){var n,i,s,a,o=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if("create_new"!==(n=O(t)).mode){e.next=9;break}return e.next=6,this._createMap(n.id,n.ttl);case 6:i=e.sent,e.next=39;break;case 9:if(!(s=this.getCached(n.id,_.SyncMap.type))){e.next=14;break}return e.abrupt("return",new _.SyncMap(s));case 14:return e.prev=14,e.next=17,this._getMap(n.id,n.includeItems);case 17:i=e.sent,e.next=39;break;case 20:if(e.prev=20,e.t0=e.catch(14),404===e.t0.status&&"open_existing"!==n.mode){e.next=26;break}throw e.t0;case 26:return e.prev=26,e.next=29,this._createMap(n.id,n.ttl);case 29:i=e.sent,e.next=39;break;case 32:if(e.prev=32,e.t1=e.catch(26),409!==e.t1.status){e.next=38;break}return e.abrupt("return",this.map(t));case 38:throw e.t1;case 39:return this.storeRootInSessionCache(_.SyncMap.type,n.id,i),a=new _.SyncMapImpl(this.services,i,(function(e,t,n){return o.removeFromCacheAndSession(e,t,n)})),a=this.entities.store(a),e.abrupt("return",new _.SyncMap(a));case 43:case"end":return e.stop()}}),e,this,[[14,20],[26,32]])}))),function(e){return D.apply(this,arguments)})},{key:"list",value:(A=i(r.mark((function e(t){var n,i,s,a,o=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if("create_new"!==(n=O(t)).mode){e.next=9;break}return e.next=6,this._createList(n.id,n.purpose,n.context,n.ttl);case 6:i=e.sent,e.next=39;break;case 9:if(!(s=this.getCached(n.id,x.SyncList.type))){e.next=14;break}return e.abrupt("return",new x.SyncList(s));case 14:return e.prev=14,e.next=17,this._getList(n.id);case 17:i=e.sent,e.next=39;break;case 20:if(e.prev=20,e.t0=e.catch(14),404===e.t0.status&&"open_existing"!==n.mode){e.next=26;break}throw e.t0;case 26:return e.prev=26,e.next=29,this._createList(n.id,n.purpose,n.context,n.ttl);case 29:i=e.sent,e.next=39;break;case 32:if(e.prev=32,e.t1=e.catch(26),409!==e.t1.status){e.next=38;break}return e.abrupt("return",this.list(t));case 38:throw e.t1;case 39:return this.storeRootInSessionCache(x.SyncList.type,n.id,i),a=new x.SyncListImpl(this.services,i,(function(e,t,n){return o.removeFromCacheAndSession(e,t,n)})),a=this.entities.store(a),e.abrupt("return",new x.SyncList(a));case 43:case"end":return e.stop()}}),e,this,[[14,20],[26,32]])}))),function(e){return A.apply(this,arguments)})},{key:"stream",value:(j=i(r.mark((function e(t){var n,i,s,a,o,u=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if("create_new"!==(n=O(t)).mode){e.next=9;break}return e.next=6,this._createStream(n.id,n.ttl);case 6:i=e.sent,e.next=39;break;case 9:if(!(s=this.getCached(n.id,E.SyncStream.type))){e.next=14;break}return e.abrupt("return",new E.SyncStream(s));case 14:return e.prev=14,e.next=17,this._getStream(n.id);case 17:i=e.sent,e.next=39;break;case 20:if(e.prev=20,e.t0=e.catch(14),404===e.t0.status&&"open_existing"!==n.mode){e.next=26;break}throw e.t0;case 26:return e.prev=26,e.next=29,this._createStream(n.id,n.ttl);case 29:i=e.sent,e.next=39;break;case 32:if(e.prev=32,e.t1=e.catch(26),409!==e.t1.status){e.next=38;break}return e.abrupt("return",this.stream(t));case 38:throw e.t1;case 39:return this.storeRootInSessionCache(E.SyncStream.type,n.id,i),a=function(e,t,n){return u.removeFromCacheAndSession(e,t,n)},o=new E.SyncStreamImpl(this.services,i,a),o=this.entities.store(o),e.abrupt("return",new E.SyncStream(o));case 44:case"end":return e.stop()}}),e,this,[[14,20],[26,32]])}))),function(e){return j.apply(this,arguments)})},{key:"shutdown",value:(U=i(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.subscriptions.shutdown();case 2:return e.next=4,this.services.twilsock.disconnect();case 4:case"end":return e.stop()}}),e,this)}))),function(){return U.apply(this,arguments)})},{key:"updateToken",value:(N=i(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",Promise.reject(new Error("A valid Twilio token should be provided")));case 2:return e.abrupt("return",this.services.twilsock.updateToken(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return N.apply(this,arguments)})},{key:"liveQuery",value:(l=i(r.mark((function e(t,n){var i,s,a,o,u,c=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if(t&&"string"==typeof t){e.next=4;break}throw new Error("Index name must contain a non-empty string value");case 4:return i=new h.UriBuilder(this.services.config.insightsUri).pathSegment(t).pathSegment("Items").build(),e.next=7,M.queryItems({network:this.services.network,uri:i,queryString:n,type:I.LiveQuery.type});case 7:return s=e.sent,(a=this.getCached(s.query_id,I.LiveQuery.type))||((o=this._getLiveQuery(s.query_id))||(o={indexName:t,queryExpression:n,sid:s.query_id,queryUri:i,last_event_id:s.last_event_id}),u=function(e,t,n){return c.removeFromCacheAndSession(e,t,n)},a=new I.LiveQueryImpl(o,this.services,u,s.items)),this.storeRootInSessionCache(I.LiveQuery.type,s.query_id,a.liveQueryDescriptor),a=this.entities.store(a),e.abrupt("return",new I.LiveQuery(a));case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"instantQuery",value:(n=i(r.mark((function e(t){var n,i,s=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:return n=function(e,t){return s.liveQuery(e,t)},i=new I.InstantQuery({indexName:t,network:this.services.network,insightsUri:this.services.config.insightsUri,liveQueryCreator:n}),e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"connectionState",get:function(){return this.services.notifications.connectionState}}],[{key:"version",get:function(){return R}}]),t}(l.EventEmitter);t.Client=N,t.SyncClient=N,t.default=N},2138:function(e,t,n){"use strict";var r=n(474),i=n(475);Object.defineProperty(t,"__esModule",{value:!0}),t.Configuration=void 0;var s="/v4/Subscriptions",a="/v3/Maps",o="/v3/Lists",u="/v3/Documents",c="/v3/Streams",l="/v3/Insights";function d(e,t,n){return e&&void 0!==e[t]?e[t]:n}var f=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e);var n=t.region||"us1",i="https://cds.".concat(n,".twilio.com"),f=t.cdsUri||i;this.settings={subscriptionsUri:f+s,documentsUri:f+u,listsUri:f+o,mapsUri:f+a,streamsUri:f+c,insightsUri:f+l,sessionStorageEnabled:d(t.Sync,"enableSessionStorage",!0),productId:t.productId}}return i(e,[{key:"subscriptionsUri",get:function(){return this.settings.subscriptionsUri}},{key:"documentsUri",get:function(){return this.settings.documentsUri}},{key:"listsUri",get:function(){return this.settings.listsUri}},{key:"mapsUri",get:function(){return this.settings.mapsUri}},{key:"streamsUri",get:function(){return this.settings.streamsUri}},{key:"insightsUri",get:function(){return this.settings.insightsUri}},{key:"backoffConfig",get:function(){return this.settings.backoffConfig||{}}},{key:"sessionStorageEnabled",get:function(){return this.settings.sessionStorageEnabled}},{key:"productId",get:function(){return this.settings.productId}}]),e}();t.Configuration=f},2139:function(e,t,n){"use strict";var r=n(3),i=n(800),s=n(489),a=n(474),o=n(475);function u(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw s}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object.defineProperty(t,"__esModule",{value:!0}),t.Subscriptions=void 0;var l=n(980),d=n(905),f=n(906),h=n(1021),p=function(){function e(t){a(this,e),this.localObject=t,this.pendingCorrelationId=null,this.pendingAction=null,this.established=!1,this.retryCount=0}return o(e,[{key:"update",value:function(e,t){this.localObject._update(e,t)}},{key:"updatePending",value:function(e,t){this.pendingAction=e,this.pendingCorrelationId=t}},{key:"reset",value:function(){this.updatePending(null,null),this.retryCount=0,this.established=!1,this.setSubscriptionState("none")}},{key:"markAsFailed",value:function(e){this.rejectedWithError=e.error,this.updatePending(null,null),this.localObject.reportFailure(new d.SyncError("Failed to subscribe on service events: ".concat(e.error.message),e.error.status,e.error.code))}},{key:"complete",value:function(e){this.updatePending(null,null),this.established=!0,this.localObject._advanceLastEventId(e)}},{key:"setSubscriptionState",value:function(e){this.localObject._setSubscriptionState(e)}},{key:"sid",get:function(){return this.localObject.sid}},{key:"type",get:function(){return this.localObject.type}},{key:"lastEventId",get:function(){return this.localObject.lastEventId}},{key:"indexName",get:function(){return this.localObject.indexName}},{key:"queryString",get:function(){return this.localObject.queryString}},{key:"isEstablished",get:function(){return this.established}}]),e}(),v=function(){function e(t){var n=this;a(this,e),this.isConnected=!1,this.maxBatchSize=100,this.subscriptionTtlTimer=null,this.pendingPokeReason=null,this.services=t,this.subscriptions=new Map,this.persisted=new Map,this.latestPokeResponseArrivalTimestampByCorrelationId=new Map;this.backoff=l.Backoff.exponential(Object.assign({randomisationFactor:.2,initialDelay:100,maxDelay:12e4},this.services.config.backoffConfig)),this.backoff.on("ready",(function(){var e=n.getSubscriptionUpdateBatch(),t=e.action,r=e.subscriptions;t?n.applyNewSubscriptionUpdateBatch(t,r):(n.backoff.reset(),f.default.debug("All subscriptions resolved."))}))}var t;return o(e,[{key:"getSubscriptionUpdateBatch",value:function(){function e(e,t,n,r){var i,a=[],o=u(e);try{for(o.s();!(i=o.n()).done;){var c=s(i.value,2),l=c[0],d=c[1];if(!t.get(l)&&n!==d.pendingAction&&!d.rejectedWithError&&(a.push(d),r&&a.length>=r))break}}catch(e){o.e(e)}finally{o.f()}return a}var t=e(this.subscriptions,this.persisted,"establish",this.maxBatchSize);if(t.length>0)return{action:"establish",subscriptions:t};var n=e(this.persisted,this.subscriptions,"cancel",this.maxBatchSize);return n.length>0?{action:"cancel",subscriptions:n}:{action:null,subscriptions:null}}},{key:"persist",value:function(){this.backoff.backoff()}},{key:"applyNewSubscriptionUpdateBatch",value:(t=i(r.mark((function e(t,n){var i,s,a,o,c,l,d,p,v,y,m,g,b=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isConnected){e.next=4;break}return f.default.debug("Twilsock connection (required for subscription) not ready; waiting…"),this.backoff.reset(),e.abrupt("return");case 4:n=this.processLocalActions(t,n),i=(new Date).getTime(),s=u(n);try{for(s.s();!(a=s.n()).done;)o=a.value,this.recordActionAttemptOn(o,t,i)}catch(e){s.e(e)}finally{s.f()}return c=this.pendingPokeReason,this.pendingPokeReason=null,e.prev=10,e.next=13,this.request(t,i,c,n);case 13:l=e.sent,d=l.body.max_batch_size,!isNaN(parseInt(d))&&isFinite(d)&&d>0&&(this.maxBatchSize=d),this.subscriptionTtlTimer||(p=l.body.ttl_in_s,!isNaN(parseFloat(p))&&isFinite(p)&&p>0&&(this.subscriptionTtlTimer=setTimeout((function(){return b.onSubscriptionTtlElapsed()}),1e3*p))),"establish"===t&&(v=l.body.estimated_delivery_in_ms,!isNaN(parseFloat(v))&&isFinite(v)&&v>0?setTimeout((function(){return b.verifyPokeDelivery(i,v,n)}),v):f.default.error("Invalid timeout: ".concat(v)),n.filter((function(e){return e.pendingCorrelationId===i})).forEach((function(e){return e.setSubscriptionState("response_in_flight")}))),this.backoff.reset(),e.next=26;break;case 21:e.prev=21,e.t0=e.catch(10),y=u(n);try{for(y.s();!(m=y.n()).done;)g=m.value,this.recordActionFailureOn(g,t)}catch(e){y.e(e)}finally{y.f()}e.t0 instanceof h.TransportUnavailableError?(f.default.debug("Twilsock connection (required for subscription) not ready (c:".concat(i,"); waiting…")),this.backoff.reset()):(f.default.debug("Failed an attempt to ".concat(t," subscriptions (c:").concat(i,"); retrying"),e.t0),this.persist());case 26:case"end":return e.stop()}}),e,this,[[10,21]])}))),function(e,n){return t.apply(this,arguments)})},{key:"verifyPokeDelivery",value:function(e,t,n){var r=this,i=this.latestPokeResponseArrivalTimestampByCorrelationId.get(e),s=i?(new Date).getTime()-i:t;s>=t?(n.filter((function(t){return t.pendingCorrelationId===e})).forEach((function(e){e.updatePending(null,null),e.retryCount++,r.persisted.delete(e.sid)})),this.persist(),this.latestPokeResponseArrivalTimestampByCorrelationId.delete(e)):setTimeout((function(){return r.verifyPokeDelivery(e,t,n)}),t-s)}},{key:"processLocalActions",value:function(e,t){return"cancel"===e?t.filter((function(e){return!e.rejectedWithError})):t}},{key:"recordActionAttemptOn",value:function(e,t,n){if(e.setSubscriptionState("request_in_flight"),"establish"===t)this.persisted.set(e.sid,e),e.updatePending(t,n);else{var r=this.persisted.get(e.sid);r&&r.updatePending(t,n)}}},{key:"recordActionFailureOn",value:function(e,t){e.setSubscriptionState("none"),e.updatePending(null,null),"establish"===t&&this.persisted.delete(e.sid)}},{key:"request",value:function(e,t,n,r){var i=r.map((function(t){return{object_sid:t.sid,object_type:t.type,last_event_id:"establish"===e?t.lastEventId:void 0,index_name:"establish"===e?t.indexName:void 0,query_string:"establish"===e?t.queryString:void 0}})),s=r.filter((function(e){return e.retryCount>0})).length;f.default.debug("Attempting '".concat(e,"' request (c:").concat(t,"):"),i);var a={event_protocol_version:3,action:e,correlation_id:t,retried_requests:s,ttl_in_s:-1,requests:i};return"ttl"===n&&(a.reason=n),this.services.network.post(this.services.config.subscriptionsUri,a)}},{key:"add",value:function(e,t){f.default.debug("Establishing intent to subscribe to ".concat(e));var n=this.subscriptions.get(e);n&&t&&n.lastEventId===t.lastEventId||(this.persisted.delete(e),this.subscriptions.set(e,new p(t)),this.persist())}},{key:"remove",value:function(e){f.default.debug("Establishing intent to unsubscribe from ".concat(e)),this.subscriptions.delete(e)&&this.persist()}},{key:"acceptMessage",value:function(e,t){var n;switch(f.default.trace("Subscriptions received",e),e.correlation_id&&this.latestPokeResponseArrivalTimestampByCorrelationId.set(e.correlation_id,(new Date).getTime()),e.event_type){case"subscription_established":this.applySubscriptionEstablishedMessage(e.event,e.correlation_id);break;case"subscription_canceled":this.applySubscriptionCancelledMessage(e.event,e.correlation_id);break;case"subscription_failed":this.applySubscriptionFailedMessage(e.event,e.correlation_id);break;case(n=e.event_type.match(/^(?:map|list|document|stream|live_query)_/)||{}).input:var r;switch(n[0]){case"map_":r=e.event.map_sid;break;case"list_":r=e.event.list_sid;break;case"document_":r=e.event.document_sid;break;case"stream_":r=e.event.stream_sid;break;case"live_query_":r=e.event.query_id,t=!1,!0===e.strictly_ordered&&(t=!0);break;default:r=void 0}this.applyEventToSubscribedEntity(r,e,t);break;default:f.default.debug("Dropping unknown message type ".concat(e.event_type))}}},{key:"applySubscriptionEstablishedMessage",value:function(e,t){var n=e.object_sid,r=this.persisted.get(e.object_sid);r&&r.pendingCorrelationId===t?"interrupted"===e.replay_status?(f.default.debug("Event Replay for subscription to ".concat(n," (c:").concat(t,") interrupted; continuing eagerly.")),r.updatePending(null,null),this.persisted.delete(r.sid),this.backoff.reset()):"completed"===e.replay_status&&(f.default.debug("Event Replay for subscription to ".concat(n," (c:").concat(t,") completed. Subscription is ready.")),r.complete(e.last_event_id),this.persisted.set(e.object_sid,r),r.setSubscriptionState("established"),this.backoff.reset()):f.default.debug("Late message for ".concat(e.object_sid," (c:").concat(t,") dropped.")),this.persist()}},{key:"applySubscriptionCancelledMessage",value:function(e,t){var n=this.persisted.get(e.object_sid);n&&n.pendingCorrelationId===t?(n.updatePending(null,null),n.setSubscriptionState("none"),this.persisted.delete(e.object_sid)):f.default.debug("Late message for ".concat(e.object_sid," (c:").concat(t,") dropped.")),this.persist()}},{key:"applySubscriptionFailedMessage",value:function(e,t){var n=e.object_sid,r=this.subscriptions.get(n),i=this.persisted.get(n);r&&i?i.pendingCorrelationId===t&&(f.default.error("Failed to subscribe on ".concat(i.sid),e.error),i.markAsFailed(e),i.setSubscriptionState("none")):!r&&i&&(this.persisted.delete(n),i.setSubscriptionState("none")),this.persist()}},{key:"applyEventToSubscribedEntity",value:function(e,t,n){if(e){var r;n=n||(r=this.persisted.get(e))&&r.isEstablished;var i=this.subscriptions.get(e);i?(t.event.type=t.event_type,i.update(t.event,n)):f.default.debug("Message dropped for SID '".concat(e,"', for which there is no subscription."))}}},{key:"onConnectionStateChanged",value:function(e){this.isConnected=e,e&&this.poke("reconnect")}},{key:"onSubscriptionTtlElapsed",value:function(){this.isConnected&&this.poke("ttl")}},{key:"poke",value:function(e){f.default.debug("Triggering event replay for all subscriptions, reason=".concat(e)),this.pendingPokeReason=e,this.subscriptionTtlTimer&&(clearTimeout(this.subscriptionTtlTimer),this.subscriptionTtlTimer=null);var t,n=[],r=u(this.persisted.values());try{for(r.s();!(t=r.n()).done;){var i=t.value;i.reset(),i.rejectedWithError&&n.push(i)}}catch(e){r.e(e)}finally{r.f()}this.persisted.clear();for(var s=0,a=n;s<a.length;s++){var o=a[s];this.persisted.set(o.sid,o)}this.persist()}},{key:"shutdown",value:function(){this.backoff.reset(),this.subscriptions.clear()}}]),e}();t.Subscriptions=v},2140:function(e,t,n){"use strict";var r=n(474),i=n(475);Object.defineProperty(t,"__esModule",{value:!0}),t.Router=void 0;var s=n(906),a="com.twilio.rtd.cds.document",o="com.twilio.rtd.cds.list",u="com.twilio.rtd.cds.map",c="twilio.sync.event",l=function(){function e(t){var n=this;r(this,e),this.config=t.config,this.subscriptions=t.subscriptions,this.notifications=t.notifications,this.notifications.subscribe(c),this.notifications.subscribe(a),this.notifications.subscribe(o),this.notifications.subscribe(u),this.notifications.on("message",(function(e,t){return n.onMessage(e,t)})),this.notifications.on("transportReady",(function(e){return n.onConnectionStateChanged(e)}))}return i(e,[{key:"onMessage",value:function(e,t){switch(s.default.trace("Notification type:",e,"content:",t),e){case a:case o:case u:this.subscriptions.acceptMessage(t,!1);break;case c:this.subscriptions.acceptMessage(t,!0)}}},{key:"subscribe",value:function(e,t){this.subscriptions.add(e,t)}},{key:"unsubscribe",value:function(e){this.subscriptions.remove(e)}},{key:"onConnectionStateChanged",value:function(e){this.subscriptions.onConnectionStateChanged(e)}}]),e}();t.Router=l,t.default=l},2141:function(e,t,n){"use strict";var r=n(474),i=n(475);Object.defineProperty(t,"__esModule",{value:!0}),t.NetworkService=void 0;var s=n(1500),a=n(905),o=n(906),u=n(980),c=n(1021);function l(e){if(e.body&&e.body.message)return e.body.message;switch(e.status){case 429:return"Throttled by server";case 404:return"Not found from server";default:return"Error from server"}}function d(e){return e.body?e.body.code:0}function f(e){return 409===e.status?new a.SyncNetworkError(l(e),e.status,d(e),e.body):e.status?new a.SyncError(l(e),e.status,d(e)):e instanceof c.TransportUnavailableError?e:new a.SyncError(e.message,0,0)}var h=function(){function e(t,n,i){r(this,e),this.clientInfo=t,this.config=n,this.transport=i}return i(e,[{key:"createHeaders",value:function(){return{"Content-Type":"application/json","Twilio-Sync-Client-Info":JSON.stringify(this.clientInfo),"Twilio-Request-Id":"RQ"+s.v4().replace(/-/g,"")}}},{key:"backoffConfig",value:function(){return Object.assign({min:4e3,max:6e4,maxAttemptsTime:9e4,randomness:.2},this.config.backoffConfig)}},{key:"executeWithRetry",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise((function(r,i){var s=[502,503,504];n&&s.push(429);var a=new u.Retrier(t.backoffConfig());a.on("attempt",(function(){e().then((function(e){return a.succeeded(e)})).catch((function(e){if(s.includes(e.status)){var t=parseInt(e.headers?e.headers["Retry-After"]:null);a.failed(f(e),isNaN(t)?null:1e3*t)}else"Twilsock disconnected"===e.message?a.failed(f(e)):(a.removeAllListeners(),a.cancel(),i(f(e)))}))})),a.on("succeeded",(function(e){r(e)})),a.on("cancelled",(function(e){return i(f(e))})),a.on("failed",(function(e){return i(f(e))})),a.start()}))}},{key:"get",value:function(e){var t=this,n=this.createHeaders();return o.default.debug("GET",e,"ID:",n["Twilio-Request-Id"]),this.executeWithRetry((function(){return t.transport.get(e,n,t.config.productId)}),!0)}},{key:"post",value:function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=this.createHeaders();return null!=n&&(s["If-Match"]=n),o.default.debug("POST",e,"ID:",s["Twilio-Request-Id"]),this.executeWithRetry((function(){return r.transport.post(e,s,t,r.config.productId)}),i)}},{key:"put",value:function(e,t,n){var r=this,i=this.createHeaders();return null!=n&&(i["If-Match"]=n),o.default.debug("PUT",e,"ID:",i["Twilio-Request-Id"]),this.executeWithRetry((function(){return r.transport.put(e,i,t,r.config.productId)}),!1)}},{key:"delete",value:function(e){var t=this,n=this.createHeaders();return o.default.debug("DELETE",e,"ID:",n["Twilio-Request-Id"]),this.executeWithRetry((function(){return t.transport.delete(e,n,t.config.productId)}),!1)}}]),e}();t.NetworkService=h},2142:function(e,t,n){var r,i,s=n(1501),a=n(1502),o=0,u=0;e.exports=function(e,t,n){var c=t&&n||0,l=t||[],d=(e=e||{}).node||r,f=void 0!==e.clockseq?e.clockseq:i;if(null==d||null==f){var h=s();null==d&&(d=r=[1|h[0],h[1],h[2],h[3],h[4],h[5]]),null==f&&(f=i=16383&(h[6]<<8|h[7]))}var p=void 0!==e.msecs?e.msecs:(new Date).getTime(),v=void 0!==e.nsecs?e.nsecs:u+1,y=p-o+(v-u)/1e4;if(y<0&&void 0===e.clockseq&&(f=f+1&16383),(y<0||p>o)&&void 0===e.nsecs&&(v=0),v>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");o=p,u=v,i=f;var m=(1e4*(268435455&(p+=122192928e5))+v)%4294967296;l[c++]=m>>>24&255,l[c++]=m>>>16&255,l[c++]=m>>>8&255,l[c++]=255&m;var g=p/4294967296*1e4&268435455;l[c++]=g>>>8&255,l[c++]=255&g,l[c++]=g>>>24&15|16,l[c++]=g>>>16&255,l[c++]=f>>>8|128,l[c++]=255&f;for(var b=0;b<6;++b)l[c+b]=d[b];return t||a(l)}},2143:function(e,t,n){var r=n(1501),i=n(1502);e.exports=function(e,t,n){var s=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||r)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var o=0;o<16;++o)t[s+o]=a[o];return t||i(a)}},2144:function(e,t,n){"use strict";var r=n(3),i=n(474),s=n(475);function a(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw s}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object.defineProperty(t,"__esModule",{value:!0}),t.TreeMap=void 0;var u=function(){function e(t,n){i(this,e),this.balanceFactor=0,this.key=t,this.value=n,this.parent=null,this.left=null,this.right=null}return s(e,[{key:"update",value:function(e){this.value=e}},{key:"replace",value:function(e,t){e&&(this.left===t?this.left=t:this.right===t&&(this.right=t))}},{key:"isRoot",get:function(){return null===this.parent}},{key:"isLeaf",get:function(){return null===this.left&&null===this.right}},{key:"isLeftChild",get:function(){return this.parent.left===this}}]),e}(),c=function(){function e(t,n){i(this,e),this.isLessThan=t||function(e,t){return e<t},this.isEqual=n||function(e,t){return e===t},this.root=null,this.count=null}return s(e,[{key:"clear",value:function(){this.root=null,this.count=0}},{key:"set",value:function(e,t){var n=this.getNode(e);n?n.update(t):this.insert(e,t)}},{key:"insert",value:function(e,t){var n=new u(e,t);if(this.count++,this.root){for(var r=this.root;;)if(this.isLessThan(e,r.key)){if(!r.left){r.left=n;break}r=r.left}else{if(!r.right){r.right=n;break}r=r.right}for(n.parent=r,r=n;r.parent;){var i=r.parent,s=i.balanceFactor;if(r.isLeftChild?i.balanceFactor++:i.balanceFactor--,Math.abs(i.balanceFactor)<Math.abs(s))break;if(i.balanceFactor<-1||i.balanceFactor>1){this.rebalance(i);break}r=i}}else this.root=n}},{key:"get",value:function(e){for(var t=this.root;t;){if(this.isEqual(e,t.key))return t.value;t=this.isLessThan(e,t.key)?t.left:t.right}return null}},{key:"delete",value:function(e){var t=this.getNode(e);if(!t||t.key!==e)return null;var n=t.parent,r=t.left,i=t.right;if(!!r!=!!i){var s=r||i;n||s?n&&!s?this.root=s:(n.replace(t,null),this.rebalance(n)):this.root=null}else{for(var a=t.left;a.right;)a=a.right;if(t.left===a)t.isRoot?(this.root=a,a.parent=null):(t.isLeftChild?t.parent.left=a:t.parent.right=a,a.parent=t.parent),a.right=t.right,a.right.parent=a,a.balanceFactor=t.balanceFactor,t={parent:a,isLeftChild:!0};else{var o=a.parent,u=a.left;o.right=u,u&&(u.parent=o),t.isRoot?(this.root=a,a.parent=null):(t.isLeftChild?t.parent.left=a:t.parent.right=a,a.parent=t.parent),a.right=t.right,a.right.parent=a,a.left=t.left,a.left.parent=a,a.balanceFactor=t.balanceFactor,t={parent:o,isLeftChild:!1}}}for(this.count--;t.parent;){var c=t.parent,l=c.balanceFactor;if(t.isLeftChild?c.balanceFactor-=1:c.balanceFactor+=1,Math.abs(c.balanceFactor)>Math.abs(l)){if(!(c.balanceFactor<-1||c.balanceFactor>1))break;if(this.rebalance(c),0!==c.parent.balanceFactor)break;t=c.parent}else t=c}return null}},{key:"getNode",value:function(e){for(var t=this.root;t;){if(this.isEqual(e,t.key))return t;t=this.isLessThan(e,t.key)?t.left:t.right}return null}},{key:"rebalance",value:function(e){e.balanceFactor<0?e.right.balanceFactor>0?(this.rotateRight(e.right),this.rotateLeft(e)):this.rotateLeft(e):e.balanceFactor>0&&(e.left.balanceFactor<0?(this.rotateLeft(e.left),this.rotateRight(e)):this.rotateRight(e))}},{key:"rotateLeft",value:function(e){var t=e.right;e.right=t.left,null!==t.left&&(t.left.parent=e),t.parent=e.parent,null===t.parent?this.root=t:e.isLeftChild?t.parent.left=t:t.parent.right=t,t.left=e,e.parent=t,e.balanceFactor=e.balanceFactor+1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor+1-Math.max(e.balanceFactor,0)}},{key:"rotateRight",value:function(e){var t=e.left;e.left=t.right,null!==t.right&&(t.right.parent=e),t.parent=e.parent,null===t.parent?this.root=t:e.isLeftChild?t.parent.left=t:t.parent.right=t,t.right=e,e.parent=t,e.balanceFactor=e.balanceFactor-1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor-1-Math.max(e.balanceFactor,0)}},{key:Symbol.iterator,value:r.mark((function e(){var t,n,i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=a(this.getIterator()),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return i=n.value,e.next=7,i;case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))},{key:"getIterator",value:r.mark((function e(){var t,n,i,s=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=s.length>0&&void 0!==s[0]?s[0]:null,n=this.root;case 2:if(!n){e.next=8;break}if(!this.isEqual(t,n.key)&&(null!==t||n.left)){e.next=5;break}return e.abrupt("break",8);case 5:n=this.isLessThan(t,n.key)||null===t?n.left:n.right,e.next=2;break;case 8:if(n){e.next=10;break}return e.abrupt("return",null);case 10:i=!0;case 11:if(!i){e.next=29;break}return e.next=14,[n.key,n.value];case 14:if(i=!1,!n.right){e.next=21;break}for(n=n.right;n.left;)n=n.left;i=!0,e.next=27;break;case 21:if(!n.parent){e.next=26;break}i=n.parent.left===n,n=n.parent,e.next=27;break;case 26:return e.abrupt("break",37);case 27:e.next=35;break;case 29:if(!n.parent){e.next=34;break}i=n.parent.left===n,n=n.parent,e.next=35;break;case 34:return e.abrupt("break",37);case 35:e.next=11;break;case 37:return e.abrupt("return",null);case 38:case"end":return e.stop()}}),e,this)}))},{key:"getReverseIterator",value:r.mark((function e(){var t,n,i,s=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=s.length>0&&void 0!==s[0]?s[0]:null,n=this.root;case 2:if(!n){e.next=8;break}if(!this.isEqual(t,n.key)&&(null!==t||n.right)){e.next=5;break}return e.abrupt("break",8);case 5:n=this.isLessThan(t,n.key)&&null!==t?n.left:n.right,e.next=2;break;case 8:if(n){e.next=10;break}return e.abrupt("return",null);case 10:i=!0;case 11:if(!i){e.next=29;break}return e.next=14,[n.key,n.value];case 14:if(i=!1,!n.left){e.next=21;break}for(n=n.left;n.right;)n=n.right;i=!0,e.next=27;break;case 21:if(!n.parent){e.next=26;break}i=n.parent.right===n,n=n.parent,e.next=27;break;case 26:return e.abrupt("break",37);case 27:e.next=35;break;case 29:if(!n.parent){e.next=34;break}i=n.parent.right===n,n=n.parent,e.next=35;break;case 34:return e.abrupt("break",37);case 35:e.next=11;break;case 37:return e.abrupt("return",null);case 38:case"end":return e.stop()}}),e,this)}))},{key:"size",get:function(){return this.count}}]),e}();t.TreeMap=c},2145:function(e,t,n){"use strict";var r=n(474);Object.defineProperty(t,"__esModule",{value:!0}),t.ClientInfo=void 0;var i=n(1241),s=function e(t){r(this,e),this.sdk="js",this.sdkVer=t,this.os=i.os.family,this.osVer=i.os.version,this.pl=i.name,this.plVer=i.version};t.ClientInfo=s,t.default=s},2146:function(e,t,n){"use strict";var r=n(474),i=n(475);Object.defineProperty(t,"__esModule",{value:!0}),t.EntitiesCache=void 0;var s=function(){function e(){r(this,e),this.names=new Map,this.entities=new Map}return i(e,[{key:"store",value:function(e){var t=this.entities.get(e.sid);return t||(this.entities.set(e.sid,e),e.uniqueName&&this.names.set(e.type+"::"+e.uniqueName,e.sid),e)}},{key:"getResolved",value:function(e,t){var n=this.names.get(t+"::"+e);return n?this.entities.get(n):null}},{key:"get",value:function(e,t){return this.entities.get(e)||this.getResolved(e,t)||null}},{key:"remove",value:function(e){var t=this.entities.get(e);t&&(this.entities.delete(e),t.uniqueName&&this.names.delete(t.type+"::"+t.uniqueName))}}]),e}();t.EntitiesCache=s},2147:function(e,t,n){"use strict";var r=n(474),i=n(475);Object.defineProperty(t,"__esModule",{value:!0}),t.SessionStorage=void 0;var s=function(){function e(t,n){r(this,e),this.config=t,this.storageId=null;try{this.storage=n||sessionStorage}catch(e){}}return i(e,[{key:"storageKey",value:function(e,t){return"".concat(this.storageId,"::").concat(e,"::").concat(t)}},{key:"updateStorageId",value:function(e){this.storageId=e}},{key:"store",value:function(e,t,n){return this.isReady?this._store(this.storageKey(e,t),n):null}},{key:"read",value:function(e,t){return this.isReady?this._read(this.storageKey(e,t)):null}},{key:"remove",value:function(e,t,n){if(!this.isReady)return null;try{this.storage.removeItem(this.storageKey(e,t)),n&&this.storage.removeItem(this.storageKey(e,n))}catch(e){}}},{key:"update",value:function(e,t,n,r){if(!this.isReady)return null;this._apply(this.storageKey(e,t),r),n&&this._apply(this.storageKey(e,n),r)}},{key:"_store",value:function(e,t){try{this.storage.setItem(e,JSON.stringify(t))}catch(e){}}},{key:"_read",value:function(e){try{var t=this.storage.getItem(e);if(t)return JSON.parse(t)}catch(e){}return null}},{key:"_apply",value:function(e,t){var n=this._read(e);if(!n)return!1;this._store(e,Object.assign(n,t))}},{key:"isReady",get:function(){return this.config.sessionStorageEnabled&&!!this.storageId}}]),e}();t.SessionStorage=s},2148:function(e,t,n){"use strict";var r=n(981),i=n(939),s=n(3),a=n(800),o=n(474),u=n(475),c=n(783),l=n(781),d=n(784);Object.defineProperty(t,"__esModule",{value:!0}),t.SyncStreamImpl=t.SyncStream=void 0;var f=n(1023),h=n(1022),p=n(1024),v=function(e){function t(e,n,r){var i;return o(this,t),(i=c(this,l(t).call(this,e,r))).descriptor=n,i}var n,r,i;return d(t,e),u(t,[{key:"publishMessage",value:(i=a(s.mark((function e(t){var n,r,i,a;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={data:t},e.next=3,this.services.network.post(this.links.messages,n);case 3:return r=e.sent,i=r.body,a=this._handleMessagePublished(i.sid,t,!1),e.abrupt("return",a);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"setTtl",value:(r=a(s.mark((function e(t){var n,r;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h.validateMandatoryTtl(t),e.prev=1,n={ttl:t},e.next=5,this.services.network.post(this.uri,n);case 5:r=e.sent,this.descriptor.date_expires=r.body.date_expires,e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(1),404===e.t0.status&&this.onRemoved(!1),e.t0;case 13:case"end":return e.stop()}}),e,this,[[1,9]])}))),function(e){return r.apply(this,arguments)})},{key:"removeStream",value:(n=a(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"_update",value:function(e){switch(e.type){case"stream_message_published":this._handleMessagePublished(e.message_sid,e.message_data,!0);break;case"stream_removed":this.onRemoved(!1)}}},{key:"_handleMessagePublished",value:function(e,t,n){var r={sid:e,value:t};return this.broadcastEventToListeners("messagePublished",{message:r,isLocal:!n}),r}},{key:"onRemoved",value:function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e})}},{key:"uri",get:function(){return this.descriptor.url}},{key:"links",get:function(){return this.descriptor.links}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"stream"}},{key:"lastEventId",get:function(){return null}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}}],[{key:"type",get:function(){return"stream"}}]),t}(f.SyncEntity);t.SyncStreamImpl=v;var y=function(e){function t(e){var n;return o(this,t),(n=c(this,l(t).call(this))).syncStreamImpl=e,n.syncStreamImpl.attach(i(i(n))),n}var n,f,h;return d(t,e),u(t,[{key:"publishMessage",value:(h=a(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncStreamImpl.publishMessage(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"setTtl",value:(f=a(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncStreamImpl.setTtl(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"removeStream",value:(n=a(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncStreamImpl.removeStream());case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"close",value:function(){r(l(t.prototype),"close",this).call(this),this.syncStreamImpl.detach(this.listenerUuid)}},{key:"uri",get:function(){return this.syncStreamImpl.uri}},{key:"links",get:function(){return this.syncStreamImpl.links}},{key:"dateExpires",get:function(){return this.syncStreamImpl.dateExpires}},{key:"type",get:function(){return v.type}},{key:"lastEventId",get:function(){return null}},{key:"sid",get:function(){return this.syncStreamImpl.sid}},{key:"uniqueName",get:function(){return this.syncStreamImpl.uniqueName}}],[{key:"type",get:function(){return v.type}}]),t}(p.default);t.SyncStream=y,t.default=y},2149:function(e){e.exports={name:"twilio-sync",version:"0.13.0",description:"Twilio Sync client library",main:"lib/index.js",types:"./lib/index.d.ts",author:"Twilio",license:"MIT",dependencies:{"twilio-notifications":"^0.5.11",twilsock:"^0.6.1",loglevel:"^1.6.3","operation-retrier":"^3.0.0",platform:"^1.3.6",uuid:"^3.3.2"},devDependencies:{"@types/chai":"^4.1.7","@types/chai-as-promised":"7.1.0","@types/chai-string":"^1.4.1","@types/mocha":"^5.2.7","@types/node":"^12.0.4","@types/sinon":"^7.0.12","@types/sinon-chai":"^3.2.2","async-test-tools":"^1.0.7","babel-core":"^6.26.0","babel-plugin-transform-builtin-extend":"^1.1.2","babel-plugin-transform-runtime":"^6.23.0","babel-preset-env":"^1.6.1","babel-runtime":"^6.26.0",babelify:"^8.0.0",browserify:"^16.2.3",chai:"^4.2.0","chai-as-promised":"^7.1.1","chai-string":"^1.5.0",cheerio:"^1.0.0-rc.2","cross-env":"^5.2.0",del:"^4.1.1","fancy-log":"^1.3.3",fs:"0.0.2",gulp:"^4.0.2","gulp-babel":"^7.0.1","gulp-derequire":"^2.1.0","gulp-if":"^2.0.2","gulp-insert":"^0.5.0","gulp-rename":"^1.4.0","gulp-sourcemaps":"^2.6.5","gulp-tap":"^1.0.1","gulp-tslint":"^8.1.4","gulp-typescript":"^5.0.1","gulp-uglify-es":"^1.0.4","ink-docstrap":"^1.3.2",jsdoc:"~3.5.5",jsonwebtoken:"^8.5.1",karma:"^4.1.0","karma-browserify":"^6.0.0","karma-browserstack-launcher":"^1.5.1","karma-mocha":"^1.3.0","karma-mocha-reporter":"^2.2.5",mocha:"^6.1.4",nyc:"^14.1.1",path:"^0.12.7",sinon:"^7.3.2","sinon-chai":"^3.3.0","source-map-explorer":"^1.8.0","ts-node":"^8.2.0",tslint:"^5.17.0",twilio:"^3.31.1",typescript:"^3.5.1","uglify-es":"^3.3.10","uglify-save-license":"^0.4.1",underscore:"^1.9.1","vinyl-buffer":"^1.0.1","vinyl-source-stream":"^2.0.0",watchify:"^3.11.1"},browserify:{transform:["babelify"]},engines:{node:">=8"}}},2150:function(e,t,n){"use strict";var r=n(2151);e.exports=r},2151:function(e,t,n){"use strict";var r=n(3),i=n(800),s=n(474),a=n(475);Object.defineProperty(t,"__esModule",{value:!0});var o=n(1510),u=n(1511),c=n(2152);t.Media=c.Media,t.McsMedia=c.Media;var l=n(2153),d=n(2156),f=o.Logger.scope(""),h=n(2157).version,p="A valid Twilio token should be provided",v=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(s(this,e),this.options=r,this.options.logLevel=this.options.logLevel||"silent",this.config=new u.Configuration(t,n,this.options),!t)throw new Error(p);f.setLevel(this.options.logLevel),this.options.transport=this.options.transport||new l.Transport,this.transport=this.options.transport,this.network=new d.Network(this.config,this.transport)}var t,n,o;return a(e,[{key:"updateToken",value:function(e){if(f.info("updateToken"),!e)throw new Error(p);this.config.updateToken(e)}},{key:"get",value:(o=i(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.network.get("".concat(this.config.baseUrl,"/").concat(t));case 2:return n=e.sent,e.abrupt("return",new c.Media(this.config,this.network,n.body));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"post",value:(n=i(r.mark((function e(t,n){var i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.network.post(this.config.baseUrl,n,t);case 2:return i=e.sent,e.abrupt("return",new c.Media(this.config,this.network,i.body));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"postFormData",value:(t=i(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.network.post(this.config.baseUrl,t);case 2:return n=e.sent,e.abrupt("return",new c.Media(this.config,this.network,n.body));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();t.Client=v,t.McsClient=v,v.version=h,t.default=v},2152:function(e,t,n){"use strict";var r=n(3),i=n(800),s=n(474),a=n(475);Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(t,n,r){s(this,e),this.config=t,this.network=n,this._update(r)}var t;return a(e,[{key:"getContentUrl",value:(t=i(r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.network.get("".concat(this.config.baseUrl,"/").concat(this.sid));case 2:return t=e.sent,this._update(t.body),e.abrupt("return",Promise.resolve(this.state.contentDirectUrl));case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_update",value:function(e){this.state={sid:e.sid,serviceSid:e.service_sid,channelSid:e.channel_sid,messageSid:e.message_sid,dateCreated:e.date_created?new Date(e.date_created):null,dateUpdated:e.date_updated?new Date(e.date_updated):null,size:e.size,contentType:e.content_type,url:e.url,contentUrl:e.links.content,contentDirectUrl:e.links.content_direct_temporary,filename:e.filename?e.filename:null}}},{key:"sid",get:function(){return this.state.sid}},{key:"serviceSid",get:function(){return this.state.serviceSid}},{key:"dateCreated",get:function(){return this.state.dateCreated}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"contentType",get:function(){return this.state.contentType}},{key:"size",get:function(){return this.state.size}},{key:"fileName",get:function(){return this.state.filename}}]),e}();t.Media=o},2153:function(e,t,n){"use strict";(function(e){var r=n(474),i=n(475);Object.defineProperty(t,"__esModule",{value:!0});var s=n(2154),a=e.XMLHttpRequest||n(2155).XMLHttpRequest;var o=function(){function e(){r(this,e)}return i(e,[{key:"get",value:function(t,n){return e.request("GET",t,n)}},{key:"post",value:function(t,n,r){return e.request("POST",t,n,r)}}],[{key:"request",value:function(e,t,n,r){return new Promise((function(i,o){var u=new a;for(var c in u.open(e,t,!0),u.onreadystatechange=function(){if(4===u.readyState){var e,t=(e=u.getAllResponseHeaders())?e.split("\r\n").map((function(e){return e.split(": ")})).filter((function(e){return 2===e.length&&e[1].length>0})).reduce((function(e,t){return e[t[0]]=t[1],e}),{}):{},n=function(e){var t=e.getResponseHeader("Content-Type");if(!t||0!==t.indexOf("application/json")||0===e.responseText.length)return e.responseText;try{return JSON.parse(e.responseText)}catch(t){return e.responseText}}(u);if(200<=u.status&&u.status<300)i({status:u.status,headers:t,body:n});else{var r,a=u.statusText&&u.statusText.code?u.statusText.code:"NONE";r="string"==typeof n?n&&1===n.split("\n",2).length?n:"":JSON.stringify(n);var c="".concat(u.status,": [").concat(a,"] ").concat(r);o(new s.TransportError(c,u.status,n,a,t))}}},n)u.setRequestHeader(c,n[c]),"Content-Type"===c&&"application/json"===n[c]&&(r=JSON.stringify(r));u.send(r)}))}}]),e}();t.Transport=o}).call(this,n(54))},2154:function(e,t,n){"use strict";var r=n(474),i=n(783),s=n(781),a=n(784),o=n(1240);Object.defineProperty(t,"__esModule",{value:!0});var u=function(e){function t(e,n,a,o,u){var c;return r(this,t),(c=i(this,s(t).call(this,e))).code=n,c.body=a,c.status=o,c.headers=u,c}return a(t,e),t}(o(Error));t.TransportError=u},2156:function(e,t,n){"use strict";var r=n(3),i=n(800),s=n(474),a=n(475);Object.defineProperty(t,"__esModule",{value:!0});var o=n(980),u=n(1510),c=n(1511),l=u.Logger.scope("Network"),d=function(){function e(t,n){s(this,e),this.config=t,this.transport=n}var t,n;return a(e,[{key:"backoffConfig",value:function(){return Object.assign(c.Configuration.backoffConfigDefault,this.config.backoffConfigOverride)}},{key:"retryWhenThrottled",value:function(){return void 0!==this.config.retryWhenThrottledOverride?this.config.retryWhenThrottledOverride:void 0!==c.Configuration.retryWhenThrottledDefault&&c.Configuration.retryWhenThrottledDefault}},{key:"executeWithRetry",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise((function(r,i){var s=[502,503,504];n&&s.push(429);var a=new o.Retrier(t.backoffConfig());a.on("attempt",(function(){e().then((function(e){return a.succeeded(e)})).catch((function(e){s.indexOf(e.status)>-1||"Twilsock disconnected"===e.message?a.failed(e):(a.removeAllListeners(),a.cancel(),i(e))}))})),a.on("succeeded",(function(e){r(e)})),a.on("cancelled",(function(e){return i(e)})),a.on("failed",(function(e){return i(e)})),a.start()}))}},{key:"get",value:(n=i(r.mark((function e(t){var n,i,s=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={"X-Twilio-Token":this.config.token},l.trace("sending GET request to ",t," headers ",n),e.next=4,this.executeWithRetry((function(){return s.transport.get(t,n)}),this.retryWhenThrottled());case 4:return i=e.sent,l.trace("response",i),e.abrupt("return",i);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"post",value:(t=i(r.mark((function e(t,n,i){var s,a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={"X-Twilio-Token":this.config.token},"undefined"!=typeof FormData&&n instanceof FormData||!i||Object.assign(s,{"Content-Type":i}),l.trace("sending POST request to ",t," headers ",s),e.prev=3,e.next=6,this.transport.post(t,s,n);case 6:a=e.sent,e.next=17;break;case 9:if(e.prev=9,e.t0=e.catch(3),!(e.t0 instanceof TypeError)){e.next=16;break}throw l.trace("got error in post response",e.t0),new TypeError("Posting FormData supported only with browser engine's FormData");case 16:throw e.t0;case 17:return l.trace("response",a),e.abrupt("return",a);case 19:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(e,n,r){return t.apply(this,arguments)})}]),e}();t.Network=d},2157:function(e){e.exports={name:"twilio-mcs-client",version:"0.3.3",description:"Twilio Media Content Service client library",main:"lib/index.js",types:"./lib/client.d.ts",author:"Twilio",license:"MIT",scripts:{},dependencies:{loglevel:"^1.6.4","operation-retrier":"^3.0.1",xmlhttprequest:"^1.8.0"},devDependencies:{"@types/chai":"^4.2.2","@types/chai-as-promised":"^7.1.2","@types/chai-datetime":"0.0.33","@types/chai-string":"^1.4.2","@types/core-js":"^2.5.2","@types/mocha":"^5.2.7","@types/node":"^12.7.4","@types/sinon":"^7.0.13","@types/sinon-chai":"^3.2.3",async:"^3.1.0","async-test-tools":"^1.0.7","babel-core":"^6.26.0","babel-plugin-transform-builtin-extend":"^1.1.2","babel-plugin-transform-runtime":"^6.23.0","babel-preset-env":"^1.6.1","babel-runtime":"^6.26.0",babelify:"^8.0.0",browserify:"^16.0.0",chai:"^4.2.0","chai-as-promised":"^7.1.1","chai-datetime":"^1.5.0","chai-string":"^1.5.0",cheerio:"^1.0.0-rc.2","cross-env":"^5.2.1",del:"^5.1.0",dotenv:"^8.1.0",express:"^4.17.1",gulp:"^4.0.2","gulp-babel":"^7.0.1","gulp-derequire":"^2.1.0","gulp-if":"^3.0.0","gulp-insert":"^0.5.0","gulp-mocha":"^7.0.1","gulp-rename":"^1.4.0","gulp-sourcemaps":"^2.6.5","gulp-tap":"^2.0.0","gulp-tslint":"^8.1.4","gulp-typescript":"^5.0.1","gulp-uglify-es":"^1.0.0","ink-docstrap":"^1.3.2","isomorphic-form-data":"^2.0.0",jsdoc:"~3.5.5","jsdoc-strip-async-await":"^0.1.0",mocha:"^6.2.0",ngrok:"^3.2.5",nyc:"^14.1.1",sinon:"^7.4.2","sinon-chai":"^3.3.0","source-map-explorer":"^2.0.1","ts-node":"^8.3.0",tslint:"^5.19.0",twilio:"^3.34.0",typescript:"^3.6.2","uglify-save-license":"^0.4.1","vinyl-buffer":"^1.0.1","vinyl-source-stream":"^2.0.0"},browserify:{transform:["babelify"]},browser:{xmlhttprequest:!1},engines:{node:">=6"}}},2158:function(e,t,n){"use strict";var r=c(n(814)),i=c(n(815)),s=c(n(816)),a=c(n(877)),o=c(n(790)),u=c(n(787));function c(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Session=void 0;var l=n(2159),d=n(1241),f=n(2162),h=n(838),p=n(1514),v=n(1515),y=n(2167),m=n(1516).version,g=h.Logger.scope("Session"),b=function e(){(0,u.default)(this,e)};var k=function(){function e(t,n){(0,u.default)(this,e);var r="undefined"!=typeof navigator?d.parse(navigator.userAgent):d;this.services=t,this.config=n,this.sessionInfo=new v.Deferred,this.currentContext={},this.pendingCommands=new a.default,this.sessionStreamPromise=null,this.endpointPlatform=["JS",m,r.os,r.name,r.version].join("|")}var t,n,c,h,k,w;return(0,o.default)(e,[{key:"handleContextUpdate",value:function(e){var t;(g.info("Session context updated"),g.debug("new session context:",e),this.currentContext=e,t=e,["identity","userInfo","links","myChannels","channels"].some((function(e){return!t.hasOwnProperty(e)})))||(g.info("new session context accepted"),this.sessionInfo.set(e))}},{key:"initialize",value:function(){var e=this,t={type:"IpMsgSession",apiVersion:"3",endpointPlatform:this.endpointPlatform};return this.sessionStreamPromise=this.services.syncClient.list({purpose:"com.twilio.rtd.ipmsg",context:t}).then((function(t){return g.info("Session created",t.sid),t.on("itemAdded",(function(t){return e.processCommandResponse(t.item)})),t.on("itemUpdated",(function(t){return e.processCommandResponse(t.item)})),t.on("contextUpdated",(function(t){return e.handleContextUpdate(t.context)})),t})).catch((function(e){throw g.error("Failed to create session",e),e})),this.sessionStreamPromise}},{key:"addCommand",value:function(e,t){return this.processCommand(e,t)}},{key:"processCommand",value:function(e,t){var n=this,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=new b;return i.request=t,i.request.action=e,i.commandId=l.v4(),g.info("Adding command: ",e,i.commandId),g.debug("command arguments:",t,r),new s.default((function(s,a){n.sessionStreamPromise.then((function(e){return n.pendingCommands.set(i.commandId,{resolve:s,reject:a,commandId:i.commandId,request:i.request}),e.push(i)})).then((function(){return g.debug("Command accepted by server",i.commandId)})).catch((function(o){n.pendingCommands.delete(i.commandId),g.error("Failed to add a command to the session",o),o.code!=f.ResponseCodes.ACCESS_FORBIDDEN_FOR_IDENTITY&&o.code!==f.ResponseCodes.LIST_NOT_FOUND||!r?a(new Error("Can't add command: "+o.message)):(g.info("recreating session..."),n.initialize(),s(n.processCommand(e,t,!1)))}))}))}},{key:"processCommandResponse",value:function(e){if(e.value.hasOwnProperty("response")&&e.value.hasOwnProperty("commandId")&&this.pendingCommands.has(e.value.commandId)){var t=e.value,n=e.value.commandId;if(t.response.status===f.ResponseCodes.HTTP_200_OK){g.debug("Command succeeded: ",t);var r=this.pendingCommands.get(n).resolve;this.pendingCommands.delete(n),r(t.response)}else{g.error("Command failed: ",t);var i=this.pendingCommands.get(n).reject;this.pendingCommands.delete(n),i(new p.SessionError(t.response.statusText,t.response.status))}}}},{key:"getSessionContext",value:function(){return this.sessionStreamPromise.then((function(e){return e.getContext()}))}},{key:"getSessionLinks",value:(w=(0,i.default)(r.default.mark((function e(){var t;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sessionInfo.promise;case 2:return t=e.sent,e.abrupt("return",{publicChannelsUrl:this.config.baseUrl+t.links.publicChannelsUrl,myChannelsUrl:this.config.baseUrl+t.links.myChannelsUrl,typingUrl:this.config.baseUrl+t.links.typingUrl,syncListUrl:this.config.baseUrl+t.links.syncListUrl,usersUrl:this.config.baseUrl+t.links.usersUrl,mediaServiceUrl:t.links.mediaServiceUrl});case 4:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)})},{key:"getChannelsId",value:(k=(0,i.default)(r.default.mark((function e(){var t;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sessionInfo.promise;case 2:return t=e.sent,e.abrupt("return",t.channels);case 4:case"end":return e.stop()}}),e,this)}))),function(){return k.apply(this,arguments)})},{key:"getMyChannelsId",value:(h=(0,i.default)(r.default.mark((function e(){var t;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sessionInfo.promise;case 2:return t=e.sent,e.abrupt("return",t.myChannels);case 4:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"getMaxUserInfosToSubscribe",value:(c=(0,i.default)(r.default.mark((function e(){var t;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sessionInfo.promise;case 2:return t=e.sent,e.abrupt("return",this.config.userInfosToSubscribeOverride||t.userInfosToSubscribe||this.config.userInfosToSubscribeDefault);case 4:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"getUsersData",value:function(){return this.sessionInfo.promise.then((function(e){return{user:e.userInfo,identity:e.identity}}))}},{key:"getConsumptionReportInterval",value:(n=(0,i.default)(r.default.mark((function e(){var t,n;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSessionContext();case 2:return t=e.sent,n=this.config.consumptionReportIntervalOverride||t.consumptionReportInterval||this.config.consumptionReportIntervalDefault,e.prev=4,e.abrupt("return",y.toSeconds(y.parse(n)));case 8:return e.prev=8,e.t0=e.catch(4),g.error("Failed to parse consumption report interval",n,"using default value",this.config.consumptionReportIntervalDefault),e.abrupt("return",y.toSeconds(y.parse(this.config.consumptionReportIntervalDefault)));case 12:case"end":return e.stop()}}),e,this,[[4,8]])}))),function(){return n.apply(this,arguments)})},{key:"getHttpCacheInterval",value:(t=(0,i.default)(r.default.mark((function e(){var t,n;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSessionContext();case 2:return t=e.sent,n=this.config.httpCacheIntervalOverride||t.httpCacheInterval||this.config.httpCacheIntervalDefault,e.prev=4,e.abrupt("return",y.toSeconds(y.parse(n)));case 8:return e.prev=8,e.t0=e.catch(4),g.error("Failed to parse cache interval",n,"using default value",this.config.httpCacheIntervalDefault),e.abrupt("return",y.toSeconds(y.parse(this.config.httpCacheIntervalDefault)));case 12:case"end":return e.stop()}}),e,this,[[4,8]])}))),function(){return t.apply(this,arguments)})},{key:"identity",get:function(){return this.sessionInfo.current.identity}},{key:"reachabilityEnabled",get:function(){return this.currentContext.reachabilityEnabled}}]),e}();t.Session=k},2159:function(e,t,n){var r=n(2160),i=n(2161),s=i;s.v1=r,s.v4=i,e.exports=s},2160:function(e,t,n){var r,i,s=n(1512),a=n(1513),o=0,u=0;e.exports=function(e,t,n){var c=t&&n||0,l=t||[],d=(e=e||{}).node||r,f=void 0!==e.clockseq?e.clockseq:i;if(null==d||null==f){var h=s();null==d&&(d=r=[1|h[0],h[1],h[2],h[3],h[4],h[5]]),null==f&&(f=i=16383&(h[6]<<8|h[7]))}var p=void 0!==e.msecs?e.msecs:(new Date).getTime(),v=void 0!==e.nsecs?e.nsecs:u+1,y=p-o+(v-u)/1e4;if(y<0&&void 0===e.clockseq&&(f=f+1&16383),(y<0||p>o)&&void 0===e.nsecs&&(v=0),v>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");o=p,u=v,i=f;var m=(1e4*(268435455&(p+=122192928e5))+v)%4294967296;l[c++]=m>>>24&255,l[c++]=m>>>16&255,l[c++]=m>>>8&255,l[c++]=255&m;var g=p/4294967296*1e4&268435455;l[c++]=g>>>8&255,l[c++]=255&g,l[c++]=g>>>24&15|16,l[c++]=g>>>16&255,l[c++]=f>>>8|128,l[c++]=255&f;for(var b=0;b<6;++b)l[c+b]=d[b];return t||a(l)}},2161:function(e,t,n){var r=n(1512),i=n(1513);e.exports=function(e,t,n){var s=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||r)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var o=0;o<16;++o)t[s+o]=a[o];return t||i(a)}},2162:function(e,t,n){"use strict";var r,i=n(787),s=(r=i)&&r.__esModule?r:{default:r};Object.defineProperty(t,"__esModule",{value:!0}),t.ResponseCodes=void 0;var a=function e(){(0,s.default)(this,e)};t.ResponseCodes=a,a.HTTP_200_OK=200,a.HTTP_400_BAD_REQUEST=400,a.HTTP_404_NOT_FOUND=404,a.ACCESS_FORBIDDEN_FOR_IDENTITY=54007,a.LIST_NOT_FOUND=54150},2163:function(e,t,n){e.exports={default:n(2164),__esModule:!0}},2164:function(e,t,n){n(2165),e.exports=n(795).Reflect.construct},2165:function(e,t,n){var r=n(813),i=n(1137),s=n(920),a=n(849),o=n(825),u=n(986),c=n(2166),l=(n(824).Reflect||{}).construct,d=u((function(){function e(){}return!(l((function(){}),[],e)instanceof e)})),f=!u((function(){l((function(){}))}));r(r.S+r.F*(d||f),"Reflect",{construct:function(e,t){s(e),a(t);var n=arguments.length<3?e:s(arguments[2]);if(f&&!d)return l(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var r=[null];return r.push.apply(r,t),new(c.apply(e,r))}var u=n.prototype,h=i(o(u)?u:Object.prototype),p=Function.apply.call(e,h,t);return o(p)?p:h}})},2166:function(e,t,n){"use strict";var r=n(920),i=n(825),s=n(1481),a=[].slice,o={},u=function(e,t,n){if(!(t in o)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";o[t]=Function("F,a","return new F("+r.join(",")+")")}return o[t](e,n)};e.exports=Function.bind||function(e){var t=r(this),n=a.call(arguments,1),o=function r(){var i=n.concat(a.call(arguments));return this instanceof r?u(t,i.length,i):s(t,i,e)};return i(t.prototype)&&(o.prototype=t.prototype),o}},2167:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=["weeks","years","months","days","hours","minutes","seconds"],i=Object.freeze({years:0,months:0,weeks:0,days:0,hours:0,minutes:0,seconds:0}),s=t.pattern=new RegExp("P(?:(\\d+(?:[\\.,]\\d+)?W)|(\\d+(?:[\\.,]\\d+)?Y)?(\\d+(?:[\\.,]\\d+)?M)?(\\d+(?:[\\.,]\\d+)?D)?(?:T(\\d+(?:[\\.,]\\d+)?H)?(\\d+(?:[\\.,]\\d+)?M)?(\\d+(?:[\\.,]\\d+)?S)?)?)"),a=t.parse=function(e){return e.match(s).slice(1).reduce((function(e,t,n){return e[r[n]]=parseFloat(t)||0,e}),{})},o=t.end=function(e,t){e=Object.assign({},i,e);var n=t?t.getTime():Date.now(),r=new Date(n);return r.setFullYear(r.getFullYear()+e.years),r.setMonth(r.getMonth()+e.months),r.setDate(r.getDate()+e.days),r.setHours(r.getHours()+e.hours),r.setMinutes(r.getMinutes()+e.minutes),r.setMilliseconds(r.getMilliseconds()+1e3*e.seconds),r.setDate(r.getDate()+7*e.weeks),r},u=t.toSeconds=function(e,t){e=Object.assign({},i,e);var n=t?t.getTime():Date.now(),r=new Date(n);return(o(e,r).getTime()-r.getTime())/1e3};t.default={end:o,toSeconds:u,pattern:s,parse:a}},2168:function(e,t,n){"use strict";var r=p(n(816)),i=p(n(814)),s=p(n(938)),a=p(n(815)),o=p(n(1517)),u=p(n(877)),c=p(n(856)),l=p(n(787)),d=p(n(790)),f=p(n(857)),h=p(n(858));function p(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Channels=t.Channel=void 0;var v=n(324),y=n(838),m=n(2174);Object.defineProperty(t,"Channel",{enumerable:!0,get:function(){return m.Channel}});var g=n(1515),b=n(839),k=y.Logger.scope("Channels"),w=function(e){function t(e){(0,l.default)(this,t);var n=(0,f.default)(this,(t.__proto__||(0,c.default)(t)).call(this));return n.services=e,n.channels=new u.default,n.thumbstones=new o.default,n.syncListFetched=!1,n.syncListRead=new g.Deferred,n}var n;return(0,h.default)(t,e),(0,d.default)(t,[{key:"getMap",value:function(){var e=this;return this.services.session.getMyChannelsId().then((function(t){return e.services.syncClient.map({id:t,mode:"open_existing"})}))}},{key:"addChannel",value:(n=(0,a.default)(i.default.mark((function e(t){var n,r,a,o,u,c;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0,n=void 0===t.attributes?{}:t.attributes,e.next=4,this.services.session.addCommand("createChannel",{friendlyName:t.friendlyName,uniqueName:t.uniqueName,type:t.isPrivate?"private":"public",attributes:(0,s.default)(n)});case 4:if(r=e.sent,a="channelSid"in r?r.channelSid:null,o="channel"in r?r.channel:null,!(u=this.channels.get(a))){e.next=12;break}return e.next=11,u._subscribe();case 11:return e.abrupt("return",u);case 12:return c=new m.Channel(this.services,{channel:o,entityName:null,uniqueName:null,attributes:null,createdBy:null,friendlyName:null,lastConsumedMessageIndex:null,type:t.isPrivate?"private":"public",dateCreated:null,dateUpdated:null},a),this.channels.set(c.sid,c),this.registerForEvents(c),e.next=17,c._subscribe();case 17:return this.emit("channelAdded",c),e.abrupt("return",c);case 19:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"fetchChannels",value:function(){var e,t=this;this.getMap().then((e=(0,a.default)(i.default.mark((function e(n){var s,a;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.on("itemAdded",(function(e){k.debug("itemAdded: "+e.item.key),t.upsertChannel("sync",e.item.key,e.item.value)})),n.on("itemRemoved",(function(e){k.debug("itemRemoved: "+e.key);var n=e.key;t.syncListFetched||t.thumbstones.add(n);var r=t.channels.get(n);r&&("joined"!==r.status&&"invited"!==r.status||(r._setStatus("notParticipating","sync"),t.emit("channelLeft",r)),r.isPrivate&&(t.channels.delete(n),t.emit("channelRemoved",r),r.emit("removed",r)))})),n.on("itemUpdated",(function(e){k.debug("itemUpdated: "+e.item.key),t.upsertChannel("sync",e.item.key,e.item.value)})),s=[],e.next=6,t.services.syncList.getPage();case 6:(a=e.sent).items.forEach((function(e){s.push(t.upsertChannel("synclist",e.channel_sid,e))}));case 9:if(!a.hasNextPage){e.next=16;break}return e.next=12,a.nextPage();case 12:(a=e.sent).items.forEach((function(e){s.push(t.upsertChannel("synclist",e.channel_sid,e))})),e.next=9;break;case 16:return t.syncListRead.set(!0),e.abrupt("return",r.default.all(s));case 18:case"end":return e.stop()}}),e,t)}))),function(t){return e.apply(this,arguments)})).then((function(){t.syncListFetched=!0,t.thumbstones.clear(),k.debug("Channels list fetched")})).then((function(){return t})).catch((function(e){throw"disconnected"!=t.services.syncClient.connectionState&&k.error("Failed to get channels list",e),k.debug("ERROR: Failed to get channels list",e),e}))}},{key:"_wrapPaginator",value:function(e,t){var n=this;return t(e.items).then((function(r){return{items:r,hasNextPage:e.hasNextPage,hasPrevPage:e.hasPrevPage,nextPage:function(){return e.nextPage().then((function(e){return n._wrapPaginator(e,t)}))},prevPage:function(){return e.prevPage().then((function(e){return n._wrapPaginator(e,t)}))}}}))}},{key:"getChannels",value:function(e){var t=this;return this.getMap().then((function(t){return t.getItems(e)})).then((function(e){return t._wrapPaginator(e,(function(e){return r.default.all(e.map((function(e){return t.upsertChannel("sync",e.key,e.value)})))}))}))}},{key:"getChannel",value:function(e){var t=this;return this.getMap().then((function(t){return t.getItems({key:e})})).then((function(e){return e.items.map((function(e){return t.upsertChannel("sync",e.key,e.value)}))})).then((function(e){return e.length>0?e[0]:null}))}},{key:"pushChannel",value:function(e){var t=e.sid,n={entityName:null,lastConsumedMessageIndex:e.lastConsumedMessageIndex,type:e.type,status:e.status,friendlyName:e.friendlyName,dateUpdated:e.dateUpdated,dateCreated:e.dateCreated,uniqueName:e.uniqueName,createdBy:e.createdBy,attributes:e.attributes,channel:e.channel,notificationLevel:e.notificationLevel,sid:t};return this.upsertChannel("chat",t,n)}},{key:"upsertChannel",value:function(e,t,n){var r=this;k.trace("upsertChannel(sid="+t+", data=",n);var i=this.channels.get(t);if(i){if(k.trace("upsertChannel: channel "+t+" is known and it's status is known from source "+i._statusSource()+" and update came from source "+e,i),void 0===i._statusSource()||e===i._statusSource()||"synclist"===e&&"sync"!==i._statusSource()||"sync"===e)if("joined"===n.status&&"joined"!==i.status){i._setStatus("joined",e);var s={};void 0!==n.notificationLevel&&(s.notificationLevel=n.notificationLevel),void 0!==n.lastConsumedMessageIndex&&(s.lastConsumedMessageIndex=n.lastConsumedMessageIndex),b.isDeepEqual(s,{})||i._update(s),i._subscribe().then((function(){r.emit("channelJoined",i)}))}else if("invited"===n.status&&"invited"!==i.status){i._setStatus("invited",e);var a={};void 0!==n.notificationLevel&&(a.notificationLevel=n.notificationLevel),void 0!==n.lastConsumedMessageIndex&&(a.lastConsumedMessageIndex=n.lastConsumedMessageIndex),b.isDeepEqual(a,{})||i._update(a),i._subscribe().then((function(){r.emit("channelInvited",i)}))}else"notParticipating"!==n.status||"invited"!==i.status&&"joined"!==i.status?"notParticipating"===n.status&&"private"===n.type?i._subscribe():i._update(n):(i._setStatus("notParticipating",e),i._update(n),i._subscribe().then((function(){r.emit("channelLeft",i)})));else k.trace("upsertChannel: channel is known from sync and came from chat, ignoring",{sid:t,data:n.status,channel:i.status});return i._subscribe().then((function(){return i}))}if("chat"!==e&&"synclist"!==e||!this.thumbstones.has(t))return k.trace("upsertChannel: creating local channel object with sid "+t,n),i=new m.Channel(this.services,n,t),this.channels.set(t,i),i._subscribe().then((function(){return r.registerForEvents(i),r.emit("channelAdded",i),"joined"===n.status?(i._setStatus("joined",e),r.emit("channelJoined",i)):"invited"===n.status&&(i._setStatus("invited",e),r.emit("channelInvited",i)),i}));k.trace("upsertChannel: channel is deleted and came again from chat, ignoring",t)}},{key:"onChannelRemoved",value:function(e){var t=this.channels.get(e);t&&(this.channels.delete(e),this.emit("channelRemoved",t))}},{key:"registerForEvents",value:function(e){var t=this;e.on("removed",(function(){return t.onChannelRemoved(e.sid)})),e.on("updated",(function(e){return t.emit("channelUpdated",e)})),e.on("memberJoined",this.emit.bind(this,"memberJoined")),e.on("memberLeft",this.emit.bind(this,"memberLeft")),e.on("memberUpdated",(function(e){return t.emit("memberUpdated",e)})),e.on("messageAdded",this.emit.bind(this,"messageAdded")),e.on("messageUpdated",(function(e){return t.emit("messageUpdated",e)})),e.on("messageRemoved",this.emit.bind(this,"messageRemoved")),e.on("typingStarted",this.emit.bind(this,"typingStarted")),e.on("typingEnded",this.emit.bind(this,"typingEnded"))}}]),t}(v.EventEmitter);t.Channels=w},2169:function(e,t,n){n(1205),n(957),n(1003),n(2170),n(2171),n(2172),n(2173),e.exports=n(795).Set},2170:function(e,t,n){"use strict";var r=n(1472),i=n(979);e.exports=n(1231)("Set",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(e){return r.def(i(this,"Set"),e=0===e?0:e,e)}},r)},2171:function(e,t,n){var r=n(813);r(r.P+r.R,"Set",{toJSON:n(1476)("Set")})},2172:function(e,t,n){n(1477)("Set")},2173:function(e,t,n){n(1478)("Set")},2174:function(e,t,n){"use strict";var r=x(n(2175)),i=x(n(1113)),s=x(n(2178)),a=x(n(1517)),o=x(n(814)),u=x(n(816)),c=x(n(815)),l=x(n(877)),d=x(n(938)),f=x(n(1236)),h=x(n(856)),p=x(n(787)),v=x(n(790)),y=x(n(857)),m=x(n(858)),g=x(n(1017)),b=x(n(1002)),k=x(n(935)),w=x(n(1018));function x(e){return e&&e.__esModule?e:{default:e}}var _=function(e,t,n,r){var i,s=arguments.length,a=s<3?t:null===r?r=(0,w.default)(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,k.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&(0,b.default)(t,n,a),a},S=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":(0,k.default)(Reflect))&&"function"==typeof g.default)return(0,g.default)(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.Channel=void 0;var C=n(324),T=n(838),E=n(2179),I=n(1518),M=n(2180),P=n(839),R=n(1020),O=T.Logger.scope("Channel"),N={lastMessage:"lastMessage",attributes:"attributes",createdBy:"createdBy",dateCreated:"dateCreated",dateUpdated:"dateUpdated",friendlyName:"friendlyName",lastConsumedMessageIndex:"lastConsumedMessageIndex",notificationLevel:"notificationLevel",sid:"sid",status:"status",type:"type",uniqueName:"uniqueName",state:"state"};function U(e){try{return new Date(e)}catch(e){return null}}var j=function(e){function t(e,n,r){(0,p.default)(this,t);var i=(0,y.default)(this,(t.__proto__||(0,h.default)(t)).call(this)),s=n.attributes||{},a=n.createdBy,o=U(n.dateCreated),u=U(n.dateUpdated),c=n.friendlyName||null,v=(0,f.default)(n.lastConsumedMessageIndex)?n.lastConsumedMessageIndex:null,m=n.uniqueName||null;try{(0,d.default)(s)}catch(e){throw new Error("Attributes must be a valid JSON object.")}return i.services=e,i.sid=r,i.entityName=n.channel,i.channelState={uniqueName:m,status:"notParticipating",type:n.type,attributes:s,createdBy:a,dateCreated:o,dateUpdated:u,friendlyName:c,lastConsumedMessageIndex:v},n.notificationLevel&&(i.channelState.notificationLevel=n.notificationLevel),i.members=new l.default,i.membersEntity=new E.Members(i,i.services,i.members),i.membersEntity.on("memberJoined",i.emit.bind(i,"memberJoined")),i.membersEntity.on("memberLeft",i.emit.bind(i,"memberLeft")),i.membersEntity.on("memberUpdated",(function(e){return i.emit("memberUpdated",e)})),i.messagesEntity=new M.Messages(i,e),i.messagesEntity.on("messageAdded",(function(e){return i._onMessageAdded(e)})),i.messagesEntity.on("messageUpdated",(function(e){return i.emit("messageUpdated",e)})),i.messagesEntity.on("messageRemoved",i.emit.bind(i,"messageRemoved")),i}var n,g,b,k,w,x,_,S,C,T,R,j,A,D,L,F,q,B,W,z,H,J,G,K,V,Q,$;return(0,m.default)(t,e),(0,v.default)(t,[{key:"_subscribe",value:function(){var e=this;return this.entityPromise?this.entityPromise:this.entityPromise=this.entityPromise||this.services.syncClient.document({id:this.entityName,mode:"open_existing"}).then((function(t){return e.entity=t,e.entity.on("updated",(function(t){e._update(t.value)})),e.entity.on("removed",(function(){return e.emit("removed",e)})),e._update(e.entity.value),t})).catch((function(t){throw e.entity=null,e.entityPromise=null,"disconnected"!=e.services.syncClient.connectionState&&O.error("Failed to get channel object",t),O.debug("ERROR: Failed to get channel object",t),t}))}},{key:"_subscribeStreams",value:($=(0,c.default)(o.default.mark((function e(){var t,n;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._subscribe();case 3:return O.trace("_subscribeStreams, this.entity.value=",this.entity.value),t=this.entity.value.messages,n=this.entity.value.roster,e.next=8,u.default.all([this.messagesEntity.subscribe(t),this.membersEntity.subscribe(n)]);case 8:e.next=15;break;case 10:throw e.prev=10,e.t0=e.catch(0),"disconnected"!==this.services.syncClient.connectionState&&O.error("Failed to subscribe on channel objects",this.sid,e.t0),O.debug("ERROR: Failed to subscribe on channel objects",this.sid,e.t0),e.t0;case 15:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(){return $.apply(this,arguments)})},{key:"_unsubscribe",value:(Q=(0,c.default)(o.default.mark((function e(){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isPrivate||!this.entity){e.next=5;break}return e.next=3,this.entity.close();case 3:this.entity=null,this.entityPromise=null;case 5:return e.abrupt("return",u.default.all([this.membersEntity.unsubscribe(),this.messagesEntity.unsubscribe()]));case 6:case"end":return e.stop()}}),e,this)}))),function(){return Q.apply(this,arguments)})},{key:"_setStatus",value:function(e,t){var n=this;this.statusSource=t,this.channelState.status!==e&&(this.channelState.status=e,"joined"===e?this._subscribeStreams().catch((function(t){if(O.debug("ERROR while setting channel status "+e,t),"disconnected"!==n.services.syncClient.connectionState)throw t})):"invited"===e?this._subscribe().catch((function(t){if(O.debug("ERROR while setting channel status "+e,t),"disconnected"!==n.services.syncClient.connectionState)throw t})):this.entityPromise&&this._unsubscribe().catch((function(t){if(O.debug("ERROR while setting channel status "+e,t),"disconnected"!==n.services.syncClient.connectionState)throw t})))}},{key:"_statusSource",value:function(){return this.statusSource}},{key:"_update",value:function(e){var n,o,u,c,l;O.trace("_update",e),t.preprocessUpdate(e,this.sid);var d=new a.default,f=!0,h=!1,p=void 0;try{for(var v,y=(0,i.default)((0,r.default)(e));!(f=(v=y.next()).done);f=!0){var m=v.value,g=N[m];if(g)switch(g){case N.status:if(!e.status||"unknown"===e.status||this.channelState.status===e.status)break;this.channelState.status=e.status,d.add(g);break;case N.attributes:if(P.isDeepEqual(this.channelState.attributes,e.attributes))break;this.channelState.attributes=e.attributes,d.add(g);break;case N.lastConsumedMessageIndex:if(void 0===e.lastConsumedMessageIndex||e.lastConsumedMessageIndex===this.channelState.lastConsumedMessageIndex)break;this.channelState.lastConsumedMessageIndex=e.lastConsumedMessageIndex,d.add(g);break;case N.lastMessage:if(this.channelState.lastMessage&&!e.lastMessage){delete this.channelState.lastMessage,d.add(g);break}this.channelState.lastMessage=this.channelState.lastMessage||{},void 0!==(null===(n=e.lastMessage)||void 0===n?void 0:n.index)&&e.lastMessage.index!==this.channelState.lastMessage.index&&(this.channelState.lastMessage.index=e.lastMessage.index,d.add(g)),void 0!==(null===(o=e.lastMessage)||void 0===o?void 0:o.timestamp)&&(null===(c=null===(u=this.channelState.lastMessage)||void 0===u?void 0:u.dateCreated)||void 0===c?void 0:c.getTime())!==e.lastMessage.timestamp.getTime()&&(this.channelState.lastMessage.dateCreated=e.lastMessage.timestamp,d.add(g)),P.isDeepEqual(this.channelState.lastMessage,{})&&delete this.channelState.lastMessage;break;case N.state:var b=e.state||void 0;if(void 0!==b&&(b.dateUpdated=new Date(b.dateUpdated)),P.isDeepEqual(this.channelState.state,b))break;this.channelState.state=b,d.add(g);break;default:var k=e[m]instanceof Date,w=k&&(null===(l=this.channelState[g])||void 0===l?void 0:l.getTime())===e[m].getTime(),x=!k&&this[g]===e[m];if(w||x)break;this.channelState[g]=e[m],d.add(g)}}}catch(e){h=!0,p=e}finally{try{!f&&y.return&&y.return()}finally{if(h)throw p}}d.size>0&&this.emit("updated",{channel:this,updateReasons:[].concat((0,s.default)(d))})}},{key:"_onMessageAdded",value:function(e){var t=!0,n=!1,r=void 0;try{for(var s,a=(0,i.default)(this.members.values());!(t=(s=a.next()).done);t=!0){var o=s.value;if(o.identity===e.author){o._endTyping();break}}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}this.emit("messageAdded",e)}},{key:"add",value:(V=(0,c.default)(o.default.mark((function e(t){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.membersEntity.add(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return V.apply(this,arguments)})},{key:"advanceLastConsumedMessageIndex",value:(K=(0,c.default)(o.default.mark((function e(t){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.abrupt("return",this.services.consumptionHorizon.advanceLastConsumedMessageIndexForChannel(this.sid,t,this.lastConsumedMessageIndex));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return K.apply(this,arguments)})},{key:"decline",value:(G=(0,c.default)(o.default.mark((function e(){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("declineInvitation",{channelSid:this.sid});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(){return G.apply(this,arguments)})},{key:"delete",value:(J=(0,c.default)(o.default.mark((function e(){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("destroyChannel",{channelSid:this.sid});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(){return J.apply(this,arguments)})},{key:"getAttributes",value:(H=(0,c.default)(o.default.mark((function e(){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribe();case 2:return e.abrupt("return",this.attributes);case 3:case"end":return e.stop()}}),e,this)}))),function(){return H.apply(this,arguments)})},{key:"getMessages",value:(z=(0,c.default)(o.default.mark((function e(t,n,r){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.abrupt("return",this.messagesEntity.getMessages(t,n,r));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return z.apply(this,arguments)})},{key:"getMembers",value:(W=(0,c.default)(o.default.mark((function e(){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.abrupt("return",this.membersEntity.getMembers());case 3:case"end":return e.stop()}}),e,this)}))),function(){return W.apply(this,arguments)})},{key:"getMembersCount",value:(B=(0,c.default)(o.default.mark((function e(){var t,n,r;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.getSessionLinks();case 2:return t=e.sent,n=new P.UriBuilder(t.publicChannelsUrl).path(this.sid).build(),e.next=6,this.services.network.get(n);case 6:return r=e.sent,e.abrupt("return",r.body.members_count);case 8:case"end":return e.stop()}}),e,this)}))),function(){return B.apply(this,arguments)})},{key:"getMemberBySid",value:(q=(0,c.default)(o.default.mark((function e(t){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.membersEntity.getMemberBySid(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return q.apply(this,arguments)})},{key:"getMemberByIdentity",value:(F=(0,c.default)(o.default.mark((function e(t){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.membersEntity.getMemberByIdentity(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return F.apply(this,arguments)})},{key:"getMessagesCount",value:(L=(0,c.default)(o.default.mark((function e(){var t,n,r;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.getSessionLinks();case 2:return t=e.sent,n=new P.UriBuilder(t.publicChannelsUrl).path(this.sid).build(),e.next=6,this.services.network.get(n);case 6:return r=e.sent,e.abrupt("return",r.body.messages_count);case 8:case"end":return e.stop()}}),e,this)}))),function(){return L.apply(this,arguments)})},{key:"getUnconsumedMessagesCount",value:(D=(0,c.default)(o.default.mark((function e(){var t,n,r;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.getSessionLinks();case 2:return t=e.sent,n=new P.UriBuilder(t.myChannelsUrl).arg("ChannelSid",this.sid).build(),e.next=6,this.services.network.get(n);case 6:if(!(r=e.sent).body.channels.length||r.body.channels[0].channel_sid!=this.sid){e.next=11;break}if(void 0===r.body.channels[0].unread_messages_count||null==r.body.channels[0].unread_messages_count){e.next=10;break}return e.abrupt("return",r.body.channels[0].unread_messages_count);case 10:return e.abrupt("return",null);case 11:throw new Error("Channel is not in user channels list");case 12:case"end":return e.stop()}}),e,this)}))),function(){return D.apply(this,arguments)})},{key:"invite",value:(A=(0,c.default)(o.default.mark((function e(t){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.membersEntity.invite(t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return A.apply(this,arguments)})},{key:"join",value:(j=(0,c.default)(o.default.mark((function e(){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("joinChannelV2",{channelSid:this.sid});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(){return j.apply(this,arguments)})},{key:"leave",value:(R=(0,c.default)(o.default.mark((function e(){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("joined"!==this.channelState.status){e.next=3;break}return e.next=3,this.services.session.addCommand("leaveChannel",{channelSid:this.sid});case 3:return e.abrupt("return",this);case 4:case"end":return e.stop()}}),e,this)}))),function(){return R.apply(this,arguments)})},{key:"removeMember",value:(T=(0,c.default)(o.default.mark((function e(t){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t instanceof I.Member)){e.next=4;break}return e.next=3,this.membersEntity.removeBySid(t.sid);case 3:return e.abrupt("return");case 4:return e.next=6,this.membersEntity.removeByIdentity(t);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return T.apply(this,arguments)})},{key:"sendMessage",value:(C=(0,c.default)(o.default.mark((function e(t,n){var r,i;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t&&null!==t){e.next=5;break}return e.next=3,this.messagesEntity.send(t,n);case 3:return r=e.sent,e.abrupt("return",P.parseToNumber(r.messageId));case 5:return e.next=7,this.messagesEntity.sendMedia(t,n);case 7:return i=e.sent,e.abrupt("return",P.parseToNumber(i.messageId));case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return C.apply(this,arguments)})},{key:"setAllMessagesConsumed",value:(S=(0,c.default)(o.default.mark((function e(){var t;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.next=4,this.getMessages(1);case 4:if(!((t=e.sent).items.length>0)){e.next=7;break}return e.abrupt("return",this.advanceLastConsumedMessageIndex(t.items[0].index));case 7:return e.abrupt("return",u.default.resolve(0));case 8:case"end":return e.stop()}}),e,this)}))),function(){return S.apply(this,arguments)})},{key:"setNoMessagesConsumed",value:(_=(0,c.default)(o.default.mark((function e(){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.abrupt("return",this.services.consumptionHorizon.updateLastConsumedMessageIndexForChannel(this.sid,null));case 3:case"end":return e.stop()}}),e,this)}))),function(){return _.apply(this,arguments)})},{key:"setUserNotificationLevel",value:(x=(0,c.default)(o.default.mark((function e(t){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("editNotificationLevel",{channelSid:this.sid,notificationLevel:t});case 2:case"end":return e.stop()}}),e,this)}))),function(e){return x.apply(this,arguments)})},{key:"typing",value:function(){return this.services.typingIndicator.send(this.sid)}},{key:"updateAttributes",value:(w=(0,c.default)(o.default.mark((function e(t){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("editAttributes",{channelSid:this.sid,attributes:(0,d.default)(t)});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return w.apply(this,arguments)})},{key:"updateFriendlyName",value:(k=(0,c.default)(o.default.mark((function e(t){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.channelState.friendlyName===t){e.next=3;break}return e.next=3,this.services.session.addCommand("editFriendlyName",{channelSid:this.sid,friendlyName:t});case 3:return e.abrupt("return",this);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return k.apply(this,arguments)})},{key:"updateLastConsumedMessageIndex",value:(b=(0,c.default)(o.default.mark((function e(t){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.abrupt("return",this.services.consumptionHorizon.updateLastConsumedMessageIndexForChannel(this.sid,t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)})},{key:"updateUniqueName",value:(g=(0,c.default)(o.default.mark((function e(t){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.channelState.uniqueName===t){e.next=4;break}return t||(t=""),e.next=4,this.services.session.addCommand("editUniqueName",{channelSid:this.sid,uniqueName:t});case 4:return e.abrupt("return",this);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"getUserDescriptors",value:(n=(0,c.default)(o.default.mark((function e(){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.users.getChannelUserDescriptors(this.sid));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"status",get:function(){return this.channelState.status}},{key:"type",get:function(){return this.channelState.type}},{key:"uniqueName",get:function(){return this.channelState.uniqueName}},{key:"isPrivate",get:function(){return"private"===this.channelState.type}},{key:"friendlyName",get:function(){return this.channelState.friendlyName}},{key:"dateUpdated",get:function(){return this.channelState.dateUpdated}},{key:"dateCreated",get:function(){return this.channelState.dateCreated}},{key:"createdBy",get:function(){return this.channelState.createdBy}},{key:"attributes",get:function(){return this.channelState.attributes}},{key:"lastConsumedMessageIndex",get:function(){return this.channelState.lastConsumedMessageIndex}},{key:"lastMessage",get:function(){return this.channelState.lastMessage}},{key:"notificationLevel",get:function(){return this.channelState.notificationLevel}},{key:"state",get:function(){return this.channelState.state}}],[{key:"preprocessUpdate",value:function(e,t){try{"string"==typeof e.attributes?e.attributes=JSON.parse(e.attributes):e.attributes&&(0,d.default)(e.attributes)}catch(n){O.warn("Retrieved malformed attributes from the server for channel: "+t),e.attributes={}}try{e.dateCreated&&(e.dateCreated=new Date(e.dateCreated))}catch(n){O.warn("Retrieved malformed dateCreated from the server for channel: "+t),delete e.dateCreated}try{e.dateUpdated&&(e.dateUpdated=new Date(e.dateUpdated))}catch(n){O.warn("Retrieved malformed dateUpdated from the server for channel: "+t),delete e.dateUpdated}try{e.lastMessage&&e.lastMessage.timestamp&&(e.lastMessage.timestamp=new Date(e.lastMessage.timestamp))}catch(n){O.warn("Retrieved malformed lastMessage.timestamp from the server for channel: "+t),delete e.lastMessage.timestamp}}}]),t}(C.EventEmitter);_([R.asyncTypeCheck(R.nonEmptyString),S("design:type",Function),S("design:paramtypes",[String]),S("design:returntype",u.default)],j.prototype,"add",null),_([R.asyncTypeCheck(R.nonNegativeInteger),S("design:type",Function),S("design:paramtypes",[Number]),S("design:returntype",u.default)],j.prototype,"advanceLastConsumedMessageIndex",null),_([R.asyncTypeCheck(["undefined",R.nonNegativeInteger],["undefined",R.nonNegativeInteger],["undefined",R.literal("backwards","forward")]),S("design:type",Function),S("design:paramtypes",[Number,Number,String]),S("design:returntype",u.default)],j.prototype,"getMessages",null),_([R.asyncTypeCheck(R.nonEmptyString),S("design:type",Function),S("design:paramtypes",[String]),S("design:returntype",u.default)],j.prototype,"getMemberBySid",null),_([R.asyncTypeCheck(R.nonEmptyString),S("design:type",Function),S("design:paramtypes",[String]),S("design:returntype",u.default)],j.prototype,"getMemberByIdentity",null),_([R.asyncTypeCheck(R.nonEmptyString),S("design:type",Function),S("design:paramtypes",[String]),S("design:returntype",u.default)],j.prototype,"invite",null),_([R.asyncTypeCheck([R.nonEmptyString,I.Member]),S("design:type",Function),S("design:paramtypes",[Object]),S("design:returntype",u.default)],j.prototype,"removeMember",null),_([R.asyncTypeCheck(["string",R.literal(null),R.custom((function(e){return[e instanceof FormData,"an instance of FormData"]})),R.custom((function(e){var t="valid media options";if("object"!==(void 0===e?"undefined":(0,k.default)(e))||null===e||Array.isArray(e))return[!1,t+" (should be a pure object)"];if(!("string"==typeof e.contentType&&e.contentType.length>0))return[!1,t+" (mediaOptions.contentType should be a non-empty string)","malformed media options (mediaOptions.contentType is "+R.stringifyReceivedType(e.contentType)+")"];var n="string"==typeof e.media&&e.media.length>0||e.media instanceof Uint8Array||e.media instanceof ArrayBuffer;return"function"==typeof Blob&&(n=n||e.media instanceof Blob),n?[!0]:[!1,t+" (mediaOptions.media should be a non-empty string, an instance of Buffer or an instance of Blob)","malformed media options (mediaOptions.media is "+R.stringifyReceivedType(e.media)+")"]}))],["undefined","string","number","boolean","object",R.literal(null)]),S("design:type",Function),S("design:paramtypes",[Object,Object]),S("design:returntype",u.default)],j.prototype,"sendMessage",null),_([R.asyncTypeCheck(R.literal("default","muted")),S("design:type",Function),S("design:paramtypes",[String]),S("design:returntype",u.default)],j.prototype,"setUserNotificationLevel",null),_([R.asyncTypeCheck(["string","number","boolean","object",R.literal(null)]),S("design:type",Function),S("design:paramtypes",[Object]),S("design:returntype",u.default)],j.prototype,"updateAttributes",null),_([R.asyncTypeCheck(["string",R.literal(null)]),S("design:type",Function),S("design:paramtypes",[String]),S("design:returntype",u.default)],j.prototype,"updateFriendlyName",null),_([R.asyncTypeCheck([R.literal(null),R.nonNegativeInteger]),S("design:type",Function),S("design:paramtypes",[Number]),S("design:returntype",u.default)],j.prototype,"updateLastConsumedMessageIndex",null),_([R.asyncTypeCheck(["string",R.literal(null)]),S("design:type",Function),S("design:paramtypes",[String]),S("design:returntype",u.default)],j.prototype,"updateUniqueName",null),t.Channel=j},2175:function(e,t,n){e.exports={default:n(2176),__esModule:!0}},2176:function(e,t,n){n(2177),e.exports=n(795).Object.keys},2177:function(e,t,n){var r=n(1001),i=n(1202);n(1418)("keys",(function(){return function(e){return i(r(e))}}))},2178:function(e,t,n){"use strict";t.__esModule=!0;var r,i=n(1234),s=(r=i)&&r.__esModule?r:{default:r};t.default=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return(0,s.default)(e)}},2179:function(e,t,n){"use strict";var r=d(n(816)),i=d(n(814)),s=d(n(815)),a=d(n(856)),o=d(n(787)),u=d(n(790)),c=d(n(857)),l=d(n(858));function d(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Members=void 0;var f=n(324),h=n(1518),p=n(838).Logger.scope("Members"),v=function(e){function t(e,n,r){(0,o.default)(this,t);var i=(0,c.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return i.services=n,i.channel=e,i.members=r,i}var n,d,f,v;return(0,l.default)(t,e),(0,u.default)(t,[{key:"unsubscribe",value:(v=(0,s.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.rosterEntityPromise){e.next=6;break}return e.next=3,this.rosterEntityPromise;case 3:e.sent.close(),this.rosterEntityPromise=null;case 6:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"subscribe",value:function(e){var t=this;return this.rosterEntityPromise=this.rosterEntityPromise||this.services.syncClient.map({id:e,mode:"open_existing"}).then((function(e){e.on("itemAdded",(function(e){p.debug(t.channel.sid+" itemAdded: "+e.item.key),t.upsertMember(e.item.key,e.item.value).then((function(e){t.emit("memberJoined",e)}))})),e.on("itemRemoved",(function(e){p.debug(t.channel.sid+" itemRemoved: "+e.key);var n=e.key;if(t.members.has(n)){var r=t.members.get(n);t.members.delete(n),t.emit("memberLeft",r)}})),e.on("itemUpdated",(function(e){p.debug(t.channel.sid+" itemUpdated: "+e.item.key),t.upsertMember(e.item.key,e.item.value)}));var n=[],i=t;return e.getItems().then((function e(t){return t.items.forEach((function(e){n.push(i.upsertMember(e.key,e.value))})),t.hasNextPage?t.nextPage().then(e):null})).then((function(){return r.default.all(n)})).then((function(){return e}))})).catch((function(e){throw t.rosterEntityPromise=null,"disconnected"!=t.services.syncClient.connectionState&&p.error("Failed to get roster object for channel",t.channel.sid,e),p.debug("ERROR: Failed to get roster object for channel",t.channel.sid,e),e}))}},{key:"upsertMember",value:(f=(0,s.default)(i.default.mark((function e(t,n){var r,s=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=this.members.get(t))){e.next=3;break}return e.abrupt("return",r._update(n));case 3:return r=new h.Member(this.services,this.channel,n,t),this.members.set(t,r),r.on("updated",(function(e){return s.emit("memberUpdated",e)})),e.abrupt("return",r);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return f.apply(this,arguments)})},{key:"getMembers",value:function(){var e=this;return this.rosterEntityPromise.then((function(){var t=[];return e.members.forEach((function(e){return t.push(e)})),t}))}},{key:"getMemberBySid",value:(d=(0,s.default)(i.default.mark((function e(t){var n=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.rosterEntityPromise.then((function(){var e=n.members.get(t);if(!e)throw new Error("Member with SID "+t+" was not found");return e})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"getMemberByIdentity",value:(n=(0,s.default)(i.default.mark((function e(t){var n,r=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,e.abrupt("return",this.rosterEntityPromise.then((function(){if(r.members.forEach((function(e){e.identity===t&&(n=e)})),!n)throw new Error("Member with identity "+t+" was not found");return n})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"add",value:function(e){return this.services.session.addCommand("addMemberV2",{channelSid:this.channel.sid,username:e})}},{key:"invite",value:function(e){return this.services.session.addCommand("inviteMember",{channelSid:this.channel.sid,username:e})}},{key:"removeByIdentity",value:function(e){return this.services.session.addCommand("removeMember",{channelSid:this.channel.sid,username:e})}},{key:"removeBySid",value:function(e){return this.services.session.addCommand("removeMember",{channelSid:this.channel.sid,memberSid:e})}}]),t}(f.EventEmitter);t.Members=v},2180:function(e,t,n){"use strict";var r=h(n(816)),i=h(n(938)),s=h(n(814)),a=h(n(815)),o=h(n(877)),u=h(n(856)),c=h(n(787)),l=h(n(790)),d=h(n(857)),f=h(n(858));function h(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Messages=void 0;var p=n(324),v=n(838),y=n(2181),m=v.Logger.scope("Messages"),g=function(e){function t(e,n){(0,c.default)(this,t);var r=(0,d.default)(this,(t.__proto__||(0,u.default)(t)).call(this));return r.channel=e,r.services=n,r.messagesByIndex=new o.default,r.messagesListPromise=null,r}var n,h,p;return(0,f.default)(t,e),(0,l.default)(t,[{key:"subscribe",value:function(e){var t=this;return this.messagesListPromise=this.messagesListPromise||this.services.syncClient.list({id:e,mode:"open_existing"}).then((function(e){return e.on("itemAdded",(function(e){m.debug(t.channel.sid+" itemAdded: "+e.item.index);var n=new y.Message(t.channel,t.services,e.item.index,e.item.value);t.messagesByIndex.has(n.index)?m.debug("Message arrived, but already known and ignored",t.channel.sid,n.index):(t.messagesByIndex.set(n.index,n),n.on("updated",(function(e){return t.emit("messageUpdated",e)})),t.emit("messageAdded",n))})),e.on("itemRemoved",(function(e){m.debug(t.channel.sid+" itemRemoved: "+e.index);var n=e.index;if(t.messagesByIndex.has(n)){var r=t.messagesByIndex.get(n);t.messagesByIndex.delete(r.index),r.removeAllListeners("updated"),t.emit("messageRemoved",r)}})),e.on("itemUpdated",(function(e){m.debug(t.channel.sid+" itemUpdated: "+e.item.index);var n=t.messagesByIndex.get(e.item.index);n&&n._update(e.item.value)})),e})).catch((function(e){throw t.messagesListPromise=null,"disconnected"!=t.services.syncClient.connectionState&&m.error("Failed to get messages object for channel",t.channel.sid,e),m.debug("ERROR: Failed to get messages object for channel",t.channel.sid,e),e}))}},{key:"unsubscribe",value:(p=(0,a.default)(s.default.mark((function e(){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.messagesListPromise){e.next=6;break}return e.next=3,this.messagesListPromise;case 3:e.sent.close(),this.messagesListPromise=null;case 6:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"send",value:(h=(0,a.default)(s.default.mark((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m.debug("Sending text message",t,n),e.abrupt("return",this.services.session.addCommand("sendMessage",{channelSid:this.channel.sid,text:t,attributes:(0,i.default)(n)}));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"sendMedia",value:(n=(0,a.default)(s.default.mark((function e(t){var n,r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(m.debug("Sending media message",t,a),n=void 0,!("undefined"!=typeof FormData&&t instanceof FormData)){e.next=9;break}return m.debug("Sending media message as FormData",t,a),e.next=6,this.services.mcsClient.postFormData(t);case 6:n=e.sent,e.next=16;break;case 9:if(m.debug("Sending media message as SendMediaOptions",t,a),(r=t).contentType&&r.media){e.next=13;break}throw new Error("Media content <Channel#SendMediaOptions> must contain non-empty contentType and media");case 13:return e.next=15,this.services.mcsClient.post(r.contentType,r.media);case 15:n=e.sent;case 16:return e.abrupt("return",this.services.session.addCommand("sendMediaMessage",{channelSid:this.channel.sid,mediaSid:n.sid,attributes:(0,i.default)(a)}));case 17:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getMessages",value:function(e,t,n){return t=void 0!==t?t:"end",n=n||"backwards",this._getMessages(e,t,n)}},{key:"wrapPaginator",value:function(e,t,n){var r=this,i="desc"===e,s=function(){return t.nextPage().then((function(t){return r.wrapPaginator(e,t,n)}))},a=function(){return t.prevPage().then((function(t){return r.wrapPaginator(e,t,n)}))};return n(t.items).then((function(e){return{items:e.sort((function(e,t){return e.index-t.index})),hasPrevPage:i?t.hasNextPage:t.hasPrevPage,hasNextPage:i?t.hasPrevPage:t.hasNextPage,prevPage:i?s:a,nextPage:i?a:s}}))}},{key:"_upsertMessage",value:function(e,t){var n=this,r=this.messagesByIndex.get(e);if(r)return r;var i=new y.Message(this.channel,this.services,e,t);return this.messagesByIndex.set(i.index,i),i.on("updated",(function(e){return n.emit("messageUpdated",e)})),i}},{key:"_getMessages",value:function(e,t,n){var i=this;t=void 0!==t?t:"end",e=e||30;var s="backwards"===n?"desc":"asc";return this.messagesListPromise.then((function(n){return n.getItems({from:"end"!==t?t:void 0,pageSize:e,order:s})})).then((function(e){return i.wrapPaginator(s,e,(function(e){return r.default.all(e.map((function(e){return i._upsertMessage(e.index,e.value)})))}))}))}}]),t}(p.EventEmitter);t.Messages=g},2181:function(e,t,n){"use strict";var r=y(n(816)),i=y(n(938)),s=y(n(814)),a=y(n(815)),o=y(n(856)),u=y(n(787)),c=y(n(790)),l=y(n(857)),d=y(n(858)),f=y(n(1017)),h=y(n(1002)),p=y(n(935)),v=y(n(1018));function y(e){return e&&e.__esModule?e:{default:e}}var m=function(e,t,n,r){var i,s=arguments.length,a=s<3?t:null===r?r=(0,v.default)(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":(0,p.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&(0,h.default)(t,n,a),a},g=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":(0,p.default)(Reflect))&&"function"==typeof f.default)return(0,f.default)(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.Message=void 0;var b=n(324),k=n(839),w=n(838),x=n(2182),_=n(1020),S=w.Logger.scope("Message"),C=function(e){function t(e,n,r,i){(0,u.default)(this,t);var s=(0,l.default)(this,(t.__proto__||(0,o.default)(t)).call(this));return s.channel=e,s.services=n,s.state={sid:i.sid,index:r,author:null==i.author?null:i.author,body:i.text,timestamp:i.timestamp?new Date(i.timestamp):null,dateUpdated:i.dateUpdated?new Date(i.dateUpdated):null,lastUpdatedBy:i.lastUpdatedBy?i.lastUpdatedBy:null,attributes:k.parseAttributes(i.attributes,"Got malformed attributes for the message "+i.sid,S),type:i.type?i.type:"text",media:i.type&&"media"===i.type&&i.media?new x.Media(i.media,s.services):null,memberSid:null==i.memberSid?null:i.memberSid},s}var n,r,f,h;return(0,d.default)(t,e),(0,c.default)(t,[{key:"_update",value:function(e){var t=[];!e.text&&"string"!=typeof e.text||e.text===this.state.body||(this.state.body=e.text,t.push("body")),e.lastUpdatedBy&&e.lastUpdatedBy!==this.state.lastUpdatedBy&&(this.state.lastUpdatedBy=e.lastUpdatedBy,t.push("lastUpdatedBy")),e.author&&e.author!==this.state.author&&(this.state.author=e.author,t.push("author")),e.dateUpdated&&new Date(e.dateUpdated).getTime()!==(this.state.dateUpdated&&this.state.dateUpdated.getTime())&&(this.state.dateUpdated=new Date(e.dateUpdated),t.push("dateUpdated")),e.timestamp&&new Date(e.timestamp).getTime()!==(this.state.timestamp&&this.state.timestamp.getTime())&&(this.state.timestamp=new Date(e.timestamp),t.push("dateCreated"));var n=k.parseAttributes(e.attributes,"Got malformed attributes for the message "+this.sid,S);k.isDeepEqual(this.state.attributes,n)||(this.state.attributes=n,t.push("attributes")),t.length>0&&this.emit("updated",{message:this,updateReasons:t})}},{key:"getMember",value:(h=(0,a.default)(s.default.mark((function e(){var t,n,r=this;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=null,!this.state.memberSid){e.next=5;break}return e.next=4,this.channel.getMemberBySid(this.memberSid).catch((function(){return S.debug('Member with sid "'+r.memberSid+'" not found for message '+r.sid),null}));case 4:t=e.sent;case 5:if(t||!this.state.author){e.next=9;break}return e.next=8,this.channel.getMemberByIdentity(this.state.author).catch((function(){return S.debug('Member with identity "'+r.author+'" not found for message '+r.sid),null}));case 8:t=e.sent;case 9:if(!t){e.next=11;break}return e.abrupt("return",t);case 11:throw n="Member with ",this.state.memberSid&&(n+="SID '"+this.state.memberSid+"' "),this.state.author&&(this.state.memberSid&&(n+="or "),n+="identity '"+this.state.author+"' "),"Member with "===n&&(n="Member "),n+="was not found",new Error(n);case 17:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"remove",value:(f=(0,a.default)(s.default.mark((function e(){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("deleteMessage",{channelSid:this.channel.sid,messageIdx:this.index.toString()});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"updateBody",value:(r=(0,a.default)(s.default.mark((function e(t){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("editMessage",{channelSid:this.channel.sid,messageIdx:this.index.toString(),text:t});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"updateAttributes",value:(n=(0,a.default)(s.default.mark((function e(t){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("editMessageAttributes",{channelSid:this.channel.sid,messageIdx:this.index,attributes:(0,i.default)(t)});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"sid",get:function(){return this.state.sid}},{key:"author",get:function(){return this.state.author}},{key:"body",get:function(){return"media"===this.type?null:this.state.body}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"index",get:function(){return this.state.index}},{key:"lastUpdatedBy",get:function(){return this.state.lastUpdatedBy}},{key:"dateCreated",get:function(){return this.state.timestamp}},{key:"attributes",get:function(){return this.state.attributes}},{key:"type",get:function(){return this.state.type}},{key:"media",get:function(){return this.state.media}},{key:"memberSid",get:function(){return this.state.memberSid}}]),t}(b.EventEmitter);m([_.asyncTypeCheck("string"),g("design:type",Function),g("design:paramtypes",[String]),g("design:returntype",r.default)],C.prototype,"updateBody",null),m([_.asyncTypeCheck(["string","number","boolean","object",_.literal(null)]),g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype",r.default)],C.prototype,"updateAttributes",null),t.Message=C},2182:function(e,t,n){"use strict";var r=o(n(814)),i=o(n(815)),s=o(n(787)),a=o(n(790));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Media=void 0;var u=function(){function e(t,n){(0,s.default)(this,e),this.mcsMedia=null,this.services=n,this.state={sid:t.sid,filename:t.filename,contentType:t.contentType,size:t.size}}var t;return(0,a.default)(e,[{key:"getContentTemporaryUrl",value:(t=(0,i.default)(r.default.mark((function e(){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mcsMedia){e.next=8;break}if(!this.services.mcsClient){e.next=7;break}return e.next=4,this.services.mcsClient.get(this.state.sid);case 4:this.mcsMedia=e.sent,e.next=8;break;case 7:throw new Error("Media Content Service is unavailable");case 8:return e.abrupt("return",this.mcsMedia.getContentUrl());case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"sid",get:function(){return this.state.sid}},{key:"filename",get:function(){return this.state.filename}},{key:"contentType",get:function(){return this.state.contentType}},{key:"size",get:function(){return this.state.size}}]),e}();t.Media=u},2183:function(e,t,n){"use strict";var r=d(n(814)),i=d(n(815)),s=d(n(877)),a=d(n(856)),o=d(n(787)),u=d(n(790)),c=d(n(857)),l=d(n(858));function d(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Users=void 0;var f=n(324),h=n(1485),p=n(2184),v=function(e){function t(e){(0,o.default)(this,t);var n=(0,c.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return n.services=e,n.fifoStack=[],n.fifoStackMaxLength=100,n.myself=new h.User(null,null,n.services),n.myself.on("updated",(function(e){return n.emit("userUpdated",e)})),n.myself.on("userSubscribed",(function(){return n.emit("userSubscribed",n.myself)})),n.myself.on("userUnsubscribed",(function(){n.emit("userUnsubscribed",n.myself),n.myself._ensureFetched()})),n.services=e,n.subscribedUsers=new s.default,n.userDescriptorsPromise=n.services.session.getSessionLinks().then((function(e){return n.userDescriptors=new p.UserDescriptors({users:n,network:n.services.network},e.usersUrl),n.userDescriptors})),n.services.session.getMaxUserInfosToSubscribe().then((function(e){n.fifoStackMaxLength=e})),n.services.session.getUsersData().then((function(e){return n.myself.identity=e.identity,n.myself.entityName=e.user,n.myself._ensureFetched()})),n}var n,d,f,v;return(0,l.default)(t,e),(0,u.default)(t,[{key:"handleUnsubscribeUser",value:function(e){this.subscribedUsers.has(e.identity)&&this.subscribedUsers.delete(e.identity);var t=-1;this.fifoStack.find((function(n,r){return n==e.identity&&(t=r,!0)}))&&this.fifoStack.splice(t,1),this.emit("userUnsubscribed",e)}},{key:"handleSubscribeUser",value:function(e){this.subscribedUsers.has(e.identity)||(this.fifoStack.length>=this.fifoStackMaxLength&&this.subscribedUsers.get(this.fifoStack.shift()).unsubscribe(),this.fifoStack.push(e.identity),this.subscribedUsers.set(e.identity,e),this.emit("userSubscribed",e))}},{key:"getUser",value:(v=(0,i.default)(r.default.mark((function e(t){var n,i,s=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.getUsersData();case 2:return e.next=4,this.myself._ensureFetched();case 4:if(t!=this.myself.identity){e.next=6;break}return e.abrupt("return",this.myself);case 6:if(n=this.subscribedUsers.get(t)){e.next=19;break}if(a){e.next=13;break}return e.next=11,this.getUserDescriptor(t);case 11:i=e.sent,a=i._getDescriptor().sync_unique_name;case 13:return(n=new h.User(t,a,this.services)).on("updated",(function(e){return s.emit("userUpdated",e)})),n.on("userSubscribed",(function(){return s.handleSubscribeUser(n)})),n.on("userUnsubscribed",(function(){return s.handleUnsubscribeUser(n)})),e.next=19,n._ensureFetched();case 19:return e.abrupt("return",n);case 20:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"getUserDescriptor",value:(f=(0,i.default)(r.default.mark((function e(t){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.userDescriptorsPromise;case 2:return e.abrupt("return",this.userDescriptors.getUserDescriptor(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"getChannelUserDescriptors",value:(d=(0,i.default)(r.default.mark((function e(t){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.userDescriptorsPromise;case 2:return e.abrupt("return",this.userDescriptors.getChannelUserDescriptors(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"getSubscribedUsers",value:(n=(0,i.default)(r.default.mark((function e(){var t;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.getUsersData();case 2:return e.next=4,this.myself._ensureFetched();case 4:return t=[this.myself],this.subscribedUsers.forEach((function(e){return t.push(e)})),e.abrupt("return",t);case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})}]),t}(f.EventEmitter);t.Users=v},2184:function(e,t,n){"use strict";var r=o(n(814)),i=o(n(815)),s=o(n(787)),a=o(n(790));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.UserDescriptors=void 0;var u=n(839),c=n(1117),l=n(2185),d=function(){function e(t,n){(0,s.default)(this,e),this.services=t,this.url=n}var t,n;return(0,a.default)(e,[{key:"getUserDescriptor",value:(n=(0,i.default)(r.default.mark((function e(t){var n,i;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new u.UriBuilder(this.url).path(t).build(),e.next=3,this.services.network.get(n);case 3:return i=e.sent,e.abrupt("return",new l.UserDescriptor(this.services,i.body));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getChannelUserDescriptors",value:(t=(0,i.default)(r.default.mark((function e(t){var n,i,s=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new u.UriBuilder(this.url).arg("ChannelSid",t).arg("PageToken",a.pageToken).build(),e.next=3,this.services.network.get(n);case 3:return i=e.sent,e.abrupt("return",new c.RestPaginator(i.body.users.map((function(e){return new l.UserDescriptor(s.services,e)})),(function(e){return s.getChannelUserDescriptors(t,{pageToken:e})}),i.body.meta.prev_token,i.body.meta.next_token));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();t.UserDescriptors=d},2185:function(e,t,n){"use strict";var r=s(n(787)),i=s(n(790));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.UserDescriptor=void 0;var a=n(838),o=n(839),u=a.Logger.scope("UserDescriptor"),c=function(){function e(t,n){(0,r.default)(this,e),this.services=t,this.descriptor=n,this.identity=n.identity,this.friendlyName=n.friendly_name,this.attributes=o.parseAttributes(n.attributes,"Failed to parse user attributes",u),this.online=n.is_online,this.notifiable=n.is_notifiable}return(0,i.default)(e,[{key:"subscribe",value:function(){return this.services.users.getUser(this.identity,this.descriptor.sync_unique_name)}},{key:"_getDescriptor",value:function(){return this.descriptor}}]),e}();t.UserDescriptor=c},2186:function(e,t,n){"use strict";var r=o(n(816)),i=o(n(877)),s=o(n(787)),a=o(n(790));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.TypingIndicator=void 0;var u=n(838),c=n(1489),l=u.Logger.scope("TypingIndicator"),d=function(){function e(t,n,r){(0,s.default)(this,e),this.config=t,this.services=n,this.getChannel=r,this.serviceTypingTimeout=null,this.sentUpdates=new i.default}return(0,a.default)(e,[{key:"initialize",value:function(){var e=this;this.services.notificationClient.subscribe(c.NotificationTypes.TYPING_INDICATOR,"twilsock"),this.services.notificationClient.on("message",(function(t,n){t===c.NotificationTypes.TYPING_INDICATOR&&e.handleRemoteTyping(n)}))}},{key:"handleRemoteTyping",value:function(e){var t=this;l.trace("Got new typing indicator ",e),this.getChannel(e.channel_sid).then((function(n){n&&n.members.forEach((function(n){if(n.identity===e.identity){var r=t.config.typingIndicatorTimeoutOverride+1e3||1e3*e.typing_timeout;n._startTyping(r)}}))})).catch((function(e){throw l.error(e),e}))}},{key:"send",value:function(e){var t=this.sentUpdates.get(e);return t&&t>Date.now()-this.typingTimeout?r.default.resolve():(this.sentUpdates.set(e,Date.now()),this._send(e))}},{key:"_send",value:function(e){var t=this;l.trace("Sending typing indicator");var n=this.config.typingIndicatorUri,r="ChannelSid="+e;return this.services.transport.post(n,{"Content-Type":"application/x-www-form-urlencoded"},r,this.config.productId).then((function(e){e.body.hasOwnProperty("typing_timeout")&&(t.serviceTypingTimeout=1e3*e.body.typing_timeout)})).catch((function(e){throw l.error("Failed to send typing indicator:",e),e}))}},{key:"typingTimeout",get:function(){return this.config.typingIndicatorTimeoutOverride||this.serviceTypingTimeout||this.config.typingIndicatorTimeoutDefault}}]),e}();t.TypingIndicator=d},2187:function(e,t,n){"use strict";var r=o(n(816)),i=o(n(877)),s=o(n(790)),a=o(n(787));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ConsumptionHorizon=void 0;var u=n(1514),c=function(){function e(t){(0,a.default)(this,e),this.services=t,this.consumptionHorizonRequests=new i.default,this.consumptionHorizonUpdateTimer=null}return(0,s.default)(e,[{key:"getReportInterval",value:function(){return this.services.session.getConsumptionReportInterval().then((function(e){return 1e3*e}))}},{key:"delayedSendConsumptionHorizon",value:function(e){var t=this;null===this.consumptionHorizonUpdateTimer&&(this.sendConsumptionReport(!0),this.consumptionHorizonUpdateTimer=setTimeout((function(){t.sendConsumptionReport(!1)}),e))}},{key:"sendConsumptionReport",value:function(e){var t=this,n=[],r=new i.default;this.consumptionHorizonRequests.forEach((function(e,t){n.push(e.entry),r.set(t,e.promises)})),n.length>0&&this.services.session.addCommand("consumptionReportV2",{report:n}).then((function(e){return t.processConsumptionReportResponse(e,r)})).catch((function(e){return t.processConsumptionReportError(e,r)})),e||(this.consumptionHorizonUpdateTimer=null),this.consumptionHorizonRequests.clear()}},{key:"processConsumptionReportResponse",value:function(e,t){e&&e.report&&Array.isArray(e.report)&&e.report.length>0&&e.report.forEach((function(e){var n=e;if(t.has(n.channelSid)){var r=null;void 0!==n.unreadMessagesCount&&null!=n.unreadMessagesCount&&(r=n.unreadMessagesCount),t.get(n.channelSid).forEach((function(e){return e.resolve(r)})),t.delete(n.channelSid)}})),this.processConsumptionReportError(new u.SessionError("Error while setting LastConsumedMessageIndex",null),t)}},{key:"processConsumptionReportError",value:function(e,t){t.forEach((function(t){return t.forEach((function(t){return t.reject(e)}))}))}},{key:"updateLastConsumedMessageIndexForChannel",value:function(e,t){var n=this;return new r.default((function(r,i){n.addPendingConsumptionHorizonRequest(e,{channelSid:e,messageIdx:t},{resolve:r,reject:i}),n.getReportInterval().then((function(e){return n.delayedSendConsumptionHorizon(e)}))}))}},{key:"advanceLastConsumedMessageIndexForChannel",value:function(e,t,n){var i=this,s=this.consumptionHorizonRequests.get(e);return new r.default((function(r,a){s&&s.entry?s.entry.messageIdx>=t?i.addPendingConsumptionHorizonRequest(e,s.entry,{resolve:r,reject:a}):i.addPendingConsumptionHorizonRequest(e,{channelSid:e,messageIdx:t},{resolve:r,reject:a}):null!==n&&t<n?i.addPendingConsumptionHorizonRequest(e,{channelSid:e,messageIdx:n},{resolve:r,reject:a}):i.addPendingConsumptionHorizonRequest(e,{channelSid:e,messageIdx:t},{resolve:r,reject:a}),i.getReportInterval().then((function(e){return i.delayedSendConsumptionHorizon(e)}))}))}},{key:"addPendingConsumptionHorizonRequest",value:function(e,t,n){if(this.consumptionHorizonRequests.has(e)){var r=this.consumptionHorizonRequests.get(e);r.entry=t,r.promises.push(n)}else this.consumptionHorizonRequests.set(e,{entry:t,promises:[n]})}}]),e}();t.ConsumptionHorizon=c},2188:function(e,t,n){"use strict";var r=o(n(814)),i=o(n(815)),s=o(n(787)),a=o(n(790));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.UserChannels=void 0;var u=n(839),c=n(1117),l=n(1488),d=function(){function e(t,n,r){(0,s.default)(this,e),this.client=t,this.services=n,this.url=r}var t;return(0,a.default)(e,[{key:"getChannels",value:(t=(0,i.default)(r.default.mark((function e(){var t,n,i=this,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new u.UriBuilder(this.url).arg("PageToken",s.pageToken).build(),e.next=3,this.services.network.get(t);case 3:return n=e.sent,e.abrupt("return",new c.RestPaginator(n.body.channels.map((function(e){return new l.ChannelDescriptor(i.client,e)})),(function(e){return i.getChannels({pageToken:e})}),n.body.meta.previous_token,n.body.meta.next_token));case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();t.UserChannels=d},2189:function(e,t,n){"use strict";var r,i=n(787),s=(r=i)&&r.__esModule?r:{default:r};Object.defineProperty(t,"__esModule",{value:!0}),t.PushNotification=void 0;t.PushNotification=function e(t){(0,s.default)(this,e),this.title=t.title||null,this.body=t.body||null,this.sound=t.sound||null,this.badge=t.badge||null,this.action=t.action||null,this.type=t.type||null,this.data=t.data||{}}},781:function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},783:function(e,t,n){var r=n(2097),i=n(939);e.exports=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?i(e):t}},784:function(e,t,n){var r=n(1237);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}},800:function(e,t){function n(e,t,n,r,i,s,a){try{var o=e[s](a),u=o.value}catch(e){return void n(e)}o.done?t(u):Promise.resolve(u).then(r,i)}e.exports=function(e){return function(){var t=this,r=arguments;return new Promise((function(i,s){var a=e.apply(t,r);function o(e){n(a,i,s,o,u,"next",e)}function u(e){n(a,i,s,o,u,"throw",e)}o(void 0)}))}}},814:function(e,t,n){e.exports=n(2068)},815:function(e,t,n){"use strict";t.__esModule=!0;var r,i=n(816),s=(r=i)&&r.__esModule?r:{default:r};t.default=function(e){return function(){var t=e.apply(this,arguments);return new s.default((function(e,n){return function r(i,a){try{var o=t[i](a),u=o.value}catch(e){return void n(e)}if(!o.done)return s.default.resolve(u).then((function(e){r("next",e)}),(function(e){r("throw",e)}));e(u)}("next")}))}}},816:function(e,t,n){e.exports={default:n(2070),__esModule:!0}},838:function(e,t,n){"use strict";var r=a(n(787)),i=a(n(790)),s=a(n(1234));function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){return[(new Date).toISOString()+" Chat "+e+":"].concat((0,s.default)(t))}Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;var u=n(1019).getLogger("twilio-chat"),c=function(){function e(t){(0,r.default)(this,e),this.prefix="",this.prefix=null!=t&&t.length>0?t+" ":""}return(0,i.default)(e,[{key:"setLevel",value:function(e){u.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];u.trace.apply(null,o(this.prefix+"T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];u.debug.apply(null,o(this.prefix+"D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];u.info.apply(null,o(this.prefix+"I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];u.warn.apply(null,o(this.prefix+"W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];u.error.apply(null,o(this.prefix+"E",t))}}],[{key:"scope",value:function(t){return new e(t)}},{key:"setLevel",value:function(e){u.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];u.trace.apply(null,o("T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];u.debug.apply(null,o("D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];u.info.apply(null,o("I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];u.warn.apply(null,o("W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];u.error.apply(null,o("E",t))}}]),e}();t.Logger=c},839:function(e,t,n){"use strict";var r=a(n(787)),i=a(n(790)),s=a(n(938));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.parseAttributes=t.parseTime=t.parseToNumber=t.UriBuilder=t.deepClone=t.isDeepEqual=void 0;var o=n(2088);t.isDeepEqual=function(e,t){return 0===o.createPatch(e,t).length},t.deepClone=function(e){return JSON.parse((0,s.default)(e))},t.parseToNumber=function(e){return void 0===e||isNaN(Number(e))?null:Number(e)},t.parseTime=function(e){try{return new Date(e)}catch(e){return null}},t.parseAttributes=function(e,t,n){var r={};if(e)try{r=JSON.parse(e)}catch(e){n.warn(t,e)}return r};var u=function(){function e(t){(0,r.default)(this,e),this.base=t.replace(/\/$/,""),this.args=[],this.paths=[]}return(0,i.default)(e,[{key:"arg",value:function(e,t){return void 0!==t&&this.args.push(encodeURIComponent(e)+"="+encodeURIComponent(t)),this}},{key:"path",value:function(e){return this.paths.push(encodeURIComponent(e)),this}},{key:"build",value:function(){var e=this.base;return this.paths.length&&(e+="/"+this.paths.join("/")),this.args.length&&(e+="?"+this.args.join("&")),e}}]),e}();t.UriBuilder=u},877:function(e,t,n){e.exports={default:n(2061),__esModule:!0}},878:function(e,t,n){"use strict";var r=n(474),i=n(783),s=n(781),a=n(784),o=n(1240);Object.defineProperty(t,"__esModule",{value:!0});var u=function(e){function t(e){return r(this,t),i(this,s(t).call(this,e))}return a(t,e),t}(o(Error));t.TwilsockError=u},904:function(e,t,n){"use strict";var r=n(474),i=n(475);Object.defineProperty(t,"__esModule",{value:!0});var s=n(1019).getLogger("twilsock");function a(e,t){return["".concat((new Date).toISOString()," Twilsock ").concat(e,":")].concat(Array.from(t))}var o=function(){function e(t){r(this,e),this.prefix="",this.prefix=null!=t&&t.length>0?" "+t+":":""}return i(e,[{key:"setLevel",value:function(e){s.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];s.debug.apply(null,a("T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];s.debug.apply(null,a("D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];s.info.apply(null,a("I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];s.warn.apply(null,a("W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];s.error.apply(null,a("E",t))}}],[{key:"setLevel",value:function(e){s.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];s.trace.apply(null,a("T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];s.debug.apply(null,a("D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];s.info.apply(null,a("I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];s.warn.apply(null,a("W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];s.error.apply(null,a("E",t))}}]),e}();t.Logger=o;var u=new o("");t.log=u},905:function(e,t,n){"use strict";var r=n(474),i=n(783),s=n(781),a=n(784),o=n(1240);Object.defineProperty(t,"__esModule",{value:!0}),t.SyncNetworkError=t.SyncError=void 0;var u=function(e){function t(e){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return r(this,t),(n=i(this,s(t).call(this))).name=n.constructor.name,n.message="".concat(e," (status: ").concat(a,", code: ").concat(o,")"),n.status=a,n.code=o,n}return a(t,e),t}(o(Error));t.SyncError=u;var c=function(e){function t(e){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,u=arguments.length>3?arguments[3]:void 0;return r(this,t),(n=i(this,s(t).call(this,e,a,o))).body=u,n}return a(t,e),t}(u);t.SyncNetworkError=c,t.default=u},906:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1019).getLogger("twilio-sync");function i(e,t){return["".concat((new Date).toISOString()," Sync ").concat(e,":")].concat(Array.from(t))}t.default={setLevel:function(e){r.setLevel(e)},trace:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r.trace.apply(null,i("T",t))},debug:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r.debug.apply(null,i("D",t))},info:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r.info.apply(null,i("I",t))},warn:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r.warn.apply(null,i("W",t))},error:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r.error.apply(null,i("E",t))}}},938:function(e,t,n){e.exports={default:n(2087),__esModule:!0}},939:function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},940:function(e,t,n){"use strict";var r=n(474);Object.defineProperty(t,"__esModule",{value:!0});var i=n(1239);t.AbstractMessage=function e(t){r(this,e),this.id=t||"TM".concat(i.v4())}},978:function(e,t,n){var r=n(901),i=n(1473),s=n(1474),a=n(849),o=n(1203),u=n(1229),c={},l={};(t=e.exports=function(e,t,n,d,f){var h,p,v,y,m=f?function(){return e}:u(e),g=r(n,d,t?2:1),b=0;if("function"!=typeof m)throw TypeError(e+" is not iterable!");if(s(m)){for(h=o(e.length);h>b;b++)if((y=t?g(a(p=e[b])[0],p[1]):g(e[b]))===c||y===l)return y}else for(v=m.call(e);!(p=v.next()).done;)if((y=i(v,g,p.value,t))===c||y===l)return y}).BREAK=c,t.RETURN=l},979:function(e,t,n){var r=n(825);e.exports=function(e,t){if(!r(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},980:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2096);t.Retrier=r.Retrier;var i=n(2098);t.Backoff=i.Backoff,t.default=r.Retrier},981:function(e,t,n){n(781);var r=n(2102);function i(t,n,s){return"undefined"!=typeof Reflect&&Reflect.get?e.exports=i=Reflect.get:e.exports=i=function(e,t,n){var i=r(e,t);if(i){var s=Object.getOwnPropertyDescriptor(i,t);return s.get?s.get.call(n):s.value}},i(t,n,s||t)}e.exports=i},984:function(e,t,n){"use strict";var r=Object.prototype.hasOwnProperty,i="~";function s(){}function a(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,n,r,s){if("function"!=typeof n)throw new TypeError("The listener must be a function");var o=new a(n,r||e,s),u=i?i+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],o]:e._events[u].push(o):(e._events[u]=o,e._eventsCount++),e}function u(e,t){0==--e._eventsCount?e._events=new s:delete e._events[t]}function c(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(i=!1)),c.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)r.call(e,t)&&n.push(i?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},c.prototype.listeners=function(e){var t=i?i+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,s=n.length,a=new Array(s);r<s;r++)a[r]=n[r].fn;return a},c.prototype.listenerCount=function(e){var t=i?i+e:e,n=this._events[t];return n?n.fn?1:n.length:0},c.prototype.emit=function(e,t,n,r,s,a){var o=i?i+e:e;if(!this._events[o])return!1;var u,c,l=this._events[o],d=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,r),!0;case 5:return l.fn.call(l.context,t,n,r,s),!0;case 6:return l.fn.call(l.context,t,n,r,s,a),!0}for(c=1,u=new Array(d-1);c<d;c++)u[c-1]=arguments[c];l.fn.apply(l.context,u)}else{var f,h=l.length;for(c=0;c<h;c++)switch(l[c].once&&this.removeListener(e,l[c].fn,void 0,!0),d){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,t);break;case 3:l[c].fn.call(l[c].context,t,n);break;case 4:l[c].fn.call(l[c].context,t,n,r);break;default:if(!u)for(f=1,u=new Array(d-1);f<d;f++)u[f-1]=arguments[f];l[c].fn.apply(l[c].context,u)}}return!0},c.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},c.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},c.prototype.removeListener=function(e,t,n,r){var s=i?i+e:e;if(!this._events[s])return this;if(!t)return u(this,s),this;var a=this._events[s];if(a.fn)a.fn!==t||r&&!a.once||n&&a.context!==n||u(this,s);else{for(var o=0,c=[],l=a.length;o<l;o++)(a[o].fn!==t||r&&!a[o].once||n&&a[o].context!==n)&&c.push(a[o]);c.length?this._events[s]=1===c.length?c[0]:c:u(this,s)}return this},c.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&u(this,t)):(this._events=new s,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=i,c.EventEmitter=c,e.exports=c}}]);
//# sourceMappingURL=110.066160ff.chunk.js.map